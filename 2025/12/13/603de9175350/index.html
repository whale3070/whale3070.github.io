

  <!DOCTYPE html>
  <html lang="en" data-default-color-scheme=&#34;dark&#34; >
  <style>
    .text1
    {
    text-shadow: 0px 0px 2px #f2f3f2;
    }
    </style>

  

<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/null">
  <link rel="icon" type="image/png" href="/null">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  <title>university.alchemy4 - whale3070&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.7","typing":{"enable":false,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.0.0"></head>


    <body>
      <header style="height: 70vh;">
        <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>InfoSec learning</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          
        
      </ul>
    </div>
  </div>
</nav>

          <div class="banner" id="banner" false
            style="background: url('/img/default.png') no-repeat center center;
              background-size: cover;">
              <div class="full-bg-img">
                <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
                  <div class="page-header text-center fade-in-up">
                    <span class="h2 text1" id="subtitle" title="university.alchemy4">
                      
                        university.alchemy4
                      
                    </span>
        
                    
                      <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2025-12-13 07:28" pubdate>
        December 13, 2025 am
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.8k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      36
       分钟
    </span>
  

  
  
</div>

                    
                  </div>
                    
                  </div>
                  
                </div>
              </div>
          </div>
      </header>

      <main>
        
          

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">university.alchemy4</h1>
            
            <div class="markdown-body">
              <h1 id="Calldata"><a href="#Calldata" class="headerlink" title="Calldata"></a><strong>Calldata</strong></h1><p>当我们想与智能合约进行通信时，我们从外部拥有账户（Externally Owned Account，EOA）发送一个交易。在这个交易中，有一个数据属性，通常被称为“calldata”。这种调用数据格式对于调用 Solidity 函数来说，无论是来自 EOA 的交易，还是一个合约之间的消息调用，都是相同的。</p>
<p>这个格式大致如下。假设你想调用一个 <code>approve</code> 方法，接受一个 <code>uint</code> 参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs solidity">function approve(uint val) external;<br></code></pre></div></td></tr></table></figure>

<p>我们可以通过对该函数的签名进行哈希处理（使用 <code>keccak256</code>），然后取哈希值的前 4 个字节来定位这个函数。对于 <code>approve</code> 方法来说，哈希值是 <code>keccak256(&quot;approve(uint256)&quot;)</code>。该哈希值的前 4 个字节是 <code>0xb759f954</code>。这就是我们的 calldata 的第一部分！</p>
<p>接下来，我们需要确定我们要批准多少数量。假设我们要批准的值是 15，那么它的十六进制表示是 <code>0xf</code>。我们需要将这个值填充为 256 位，或者说 64 个十六进制字符。结果的值将是：</p>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs">000000000000000000000000000000000000000000000000000000000000000f<br></code></pre></div></td></tr></table></figure>

<p>如果我们将这个值与函数签名结合起来，我们的 calldata 将是：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs x86asm"><span class="hljs-number">0xb759f954000000000000000000000000000000000000000000000000000000000000000f</span><br></code></pre></div></td></tr></table></figure>

<p>无论是来自 EOA 的交易，还是合约之间的消息调用，这都会是我们发送 15 给 <code>approve</code> 函数的 calldata。</p>
<p>准备好开始处理 calldata 了吗？让我们开始吧！</p>
<h1 id="接口-Interfaces"><a href="#接口-Interfaces" class="headerlink" title="接口 (Interfaces)"></a><strong>接口 (Interfaces)</strong></h1><p>使一个合约与另一个合约交互的最简单方式是定义目标合约。接口就是为了这个目的而存在的。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs solidity">interface IToken &#123;<br>    function getBalance(address user) external;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>我们可以使用这个接口与实现了 <code>getBalance</code> 方法的代币合约进行正确的通信：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs solidity">// tokenAddress: 我们想要与之通信的合约地址<br>// userAddress: 我们想要查询余额的地址<br>uint balance = IToken(tokenAddress).getBalance(userAddress);<br></code></pre></div></td></tr></table></figure>

<p>在幕后，Solidity 正在创建一个消息调用，该调用为 <code>getBalance</code> 调用编码了 calldata。</p>
<h1 id="你的目标：警告英雄"><a href="#你的目标：警告英雄" class="headerlink" title="你的目标：警告英雄"></a><strong>你的目标：警告英雄</strong></h1><p>使用 <code>IHero</code> 接口和传入 <code>sendAlert</code> 的英雄地址，从 Sidekick 合约中向英雄发送警报。</p>
<p>答案：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml"><span class="hljs-comment">// SPDX-License-Identifier: MIT</span><br>pragma solidity ^<span class="hljs-number">0.8</span>.<span class="hljs-number">20</span>;<br><br>interface IHero &#123;<br>    <span class="hljs-keyword">function</span> alert<span class="hljs-literal">()</span> <span class="hljs-keyword">external</span>;<br>&#125;<br><br>contract Sidekick &#123;<br>    <span class="hljs-keyword">function</span> send<span class="hljs-constructor">Alert(<span class="hljs-params">address</span> <span class="hljs-params">hero</span>)</span> <span class="hljs-keyword">external</span> &#123;<br>        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> alert the hero using the IHero interface</span><br>        <span class="hljs-constructor">IHero(<span class="hljs-params">hero</span>)</span>.alert<span class="hljs-literal">()</span>;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h1 id="为什么Ihero接口可以传入hero地址，那能不能传入balance余额"><a href="#为什么Ihero接口可以传入hero地址，那能不能传入balance余额" class="headerlink" title="为什么Ihero接口可以传入hero地址，那能不能传入balance余额"></a>为什么Ihero接口可以传入hero地址，那能不能传入balance余额</h1><p>要理解这个问题，核心是分清<strong>接口的作用</strong>和<strong>数据类型的本质</strong>：<code>IHero</code> 接口是用来和「实现该接口的合约地址」交互的，而 <code>balance</code> 是地址的<strong>属性值</strong>（不是合约地址本身），二者不能混为一谈。下面分两部分详细解释：</p>
<h3 id="一、为什么-IHero-接口可以传入-hero-地址？"><a href="#一、为什么-IHero-接口可以传入-hero-地址？" class="headerlink" title="一、为什么 IHero 接口可以传入 hero 地址？"></a>一、为什么 <code>IHero</code> 接口可以传入 <code>hero</code> 地址？</h3><p><code>IHero(hero)</code> 本质是「<strong>类型转换</strong>」，不是「传入参数」，核心逻辑是：</p>
<ol>
<li><strong>接口的本质</strong>：<code>IHero</code> 接口是一个「函数签名规范」，它定义了“只要某个合约实现了 <code>alert()</code> 函数，就可以被当作 <code>IHero</code> 类型来调用”。</li>
<li><strong>地址的作用</strong>：<code>hero</code> 是一个 <code>address</code> 类型的值，代表一个合约的部署地址（这个合约恰好实现了 <code>IHero</code> 接口的 <code>alert()</code> 函数）。</li>
<li><strong>类型转换的意义</strong>：<code>IHero(hero)</code> 告诉 Solidity 编译器：“把这个 <code>hero</code> 地址对应的合约，当作实现了 <code>IHero</code> 接口的合约来处理，我要调用它的 <code>alert()</code> 函数”。</li>
</ol>
<p>简单说：接口是「操作规范」，地址是「操作目标」，接口 + 地址 = 明确“对哪个合约执行哪些规范内的操作”。</p>
<h3 id="二、能不能把-balance-余额传入-IHero-接口？——-不能（核心原因）"><a href="#二、能不能把-balance-余额传入-IHero-接口？——-不能（核心原因）" class="headerlink" title="二、能不能把 balance 余额传入 IHero 接口？—— 不能（核心原因）"></a>二、能不能把 <code>balance</code> 余额传入 <code>IHero</code> 接口？—— 不能（核心原因）</h3><p><code>balance</code> 是 <code>address</code> 类型的<strong>只读属性</strong>（比如 <code>address(this).balance</code>、<code>hero.balance</code>），它的类型是 <code>uint256</code>（数字），而 <code>IHero</code> 接口只能和 <code>address</code> 类型（合约地址）绑定，二者的本质和用途完全不同：</p>
<table>
<thead>
<tr>
<th>特征</th>
<th><code>hero</code> 地址（<code>address</code>）</th>
<th><code>balance</code> 余额（<code>uint256</code>）</th>
</tr>
</thead>
<tbody><tr>
<td>数据类型</td>
<td>地址类型（标识合约/账户的身份）</td>
<td>无符号整数（纯数值）</td>
</tr>
<tr>
<td>作用</td>
<td>定位要交互的合约/账户</td>
<td>表示地址下的ETH余额</td>
</tr>
<tr>
<td>能否绑定到 <code>IHero</code></td>
<td>能（接口需和地址绑定才能调用函数）</td>
<td>不能（接口只认地址，不认数字）</td>
</tr>
</tbody></table>
<h4 id="错误示例（直观理解）："><a href="#错误示例（直观理解）：" class="headerlink" title="错误示例（直观理解）："></a>错误示例（直观理解）：</h4><p>如果强行把 <code>balance</code> 传给 <code>IHero</code>，编译器会直接报错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs solidity">function sendAlert(address hero) external &#123;<br>    // 获取hero地址的余额（uint256类型）<br>    uint256 heroBalance = hero.balance;<br>    // 错误！IHero() 要求传入address类型，但heroBalance是uint256<br>    IHero(heroBalance).alert(); <br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>报错原因：<code>IHero()</code> 括号内必须传入 <code>address</code> 类型的值，而 <code>balance</code> 是 <code>uint256</code>，类型不匹配，编译器无法将一个数字解析为合约地址。</p>
<h3 id="三、如果想操作-balance-余额，该怎么做？"><a href="#三、如果想操作-balance-余额，该怎么做？" class="headerlink" title="三、如果想操作 balance 余额，该怎么做？"></a>三、如果想操作 <code>balance</code> 余额，该怎么做？</h3><p>虽然不能把 <code>balance</code> 传入 <code>IHero</code> 接口，但可以<strong>基于 <code>hero</code> 地址获取/操作其余额</strong>，比如：</p>
<ol>
<li><strong>读取 <code>hero</code> 地址的余额</strong>：直接通过 <code>address</code> 类型的 <code>balance</code> 属性获取（无需接口）；</li>
<li><strong>向 <code>hero</code> 地址转账（修改余额）</strong>：将地址转为 <code>payable</code> 后调用 <code>transfer</code>/<code>send</code>/<code>call</code>（也无需 <code>IHero</code> 接口）。</li>
</ol>
<h4 id="正确示例（结合接口-余额操作）："><a href="#正确示例（结合接口-余额操作）：" class="headerlink" title="正确示例（结合接口+余额操作）："></a>正确示例（结合接口+余额操作）：</h4><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs solidity">// SPDX-License-Identifier: MIT<br>pragma solidity ^0.8.20;<br><br>interface IHero &#123;<br>    function alert() external;<br>&#125;<br><br>contract Sidekick &#123;<br>    function sendAlertAndCheckBalance(address hero) external &#123;<br>        // 1. 先通过IHero接口调用hero合约的alert()函数（核心需求）<br>        IHero(hero).alert();<br><br>        // 2. 再获取hero地址的余额（uint256类型）<br>        uint256 heroBalance = hero.balance;<br>        // 比如：打印余额（测试用）<br>        emit HeroBalance(hero, heroBalance);<br><br>        // 3. 若需向hero地址转账（修改余额），需转为payable<br>        if (heroBalance &lt; 1 ether) &#123;<br>            payable(hero).transfer(1 ether); // 给hero转1ETH<br>        &#125;<br>    &#125;<br><br>    // 事件：用于打印hero的余额（方便测试）<br>    event HeroBalance(address indexed hero, uint256 balance);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h3 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h3><ol>
<li><code>IHero</code> 接口的核心是「调用指定地址合约的 <code>alert()</code> 函数」，因此必须传入 <code>address</code> 类型的 <code>hero</code> 合约地址；</li>
<li><code>balance</code> 是地址的<strong>数值属性</strong>（<code>uint256</code>），不是地址本身，无法传入 <code>IHero()</code> 进行接口绑定；</li>
<li>操作余额的正确方式：基于 <code>hero</code> 地址（<code>address</code>）直接读取/修改，和 <code>IHero</code> 接口是“并行操作”，而非“传入关系”。</li>
</ol>
<p>简单记：接口绑「地址」，余额是地址的「属性值」，二者是“对象”和“对象的属性”的关系，不能互相替代。</p>
<h1 id="Your-Goal-Alert-Hero-Manually-你的目标：手动提醒英雄"><a href="#Your-Goal-Alert-Hero-Manually-你的目标：手动提醒英雄" class="headerlink" title="Your Goal: Alert Hero, Manually 你的目标：手动提醒英雄"></a>Your Goal: Alert Hero, Manually 你的目标：手动提醒英雄</h1><p>Alert the Hero, manually this time!<br>这次手动通知英雄！</p>
<p>Fill in the function signature for the Hero’s alert function. Notice that we are taking the first 4 bytes of the hash of this function and passing it in as calldata to the hero.<br>填写英雄的alert函数的函数签名。注意，我们要取这个函数哈希值的前4个字节，并将其作为calldata传递给英雄。</p>
<p>答案：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml"><span class="hljs-comment">// SPDX-License-Identifier: MIT</span><br>pragma solidity ^<span class="hljs-number">0.8</span>.<span class="hljs-number">20</span>;<br><br>contract Sidekick &#123;<br>    <span class="hljs-keyword">function</span> send<span class="hljs-constructor">Alert(<span class="hljs-params">address</span> <span class="hljs-params">hero</span>)</span> <span class="hljs-keyword">external</span> &#123;<br>        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> fill in the function signature in the &quot;&quot;</span><br>        bytes4 signature = bytes4(keccak256(<span class="hljs-string">&quot;alert()&quot;</span>));<br><br>        (<span class="hljs-built_in">bool</span> success, ) = hero.call(abi.encode<span class="hljs-constructor">Packed(<span class="hljs-params">signature</span>)</span>);<br><br>        require(success);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h1 id="Your-Goal-Alert-the-Hero-with-Arguments"><a href="#Your-Goal-Alert-the-Hero-with-Arguments" class="headerlink" title="Your Goal: Alert the Hero with Arguments"></a>Your Goal: Alert the Hero with Arguments</h1><p>你的目标：用论据提醒英雄<br>Alert the Hero by calling alert and passing the number of enemies and whether or not they are armed<br>通过调用alert并传入enemies的数量以及他们是否armed，来向Hero发出警报。</p>
<p>答案：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml"><span class="hljs-comment">// SPDX-License-Identifier: MIT</span><br>pragma solidity ^<span class="hljs-number">0.8</span>.<span class="hljs-number">20</span>;<br><br>contract Sidekick &#123;<br>    <span class="hljs-comment">// sendAlert 函数根据传入的参数生成 calldata</span><br>    <span class="hljs-keyword">function</span> send<span class="hljs-constructor">Alert(<span class="hljs-params">address</span> <span class="hljs-params">hero</span>, <span class="hljs-params">uint</span> <span class="hljs-params">enemies</span>, <span class="hljs-params">bool</span> <span class="hljs-params">armed</span>)</span> <span class="hljs-keyword">external</span> &#123;<br>        <span class="hljs-comment">// 使用传入的 enemies 和 armed 参数构造 calldata</span><br>        <span class="hljs-built_in">bytes</span> memory payload = abi.encode<span class="hljs-constructor">WithSignature(<span class="hljs-string">&quot;alert(uint256,bool)&quot;</span>, <span class="hljs-params">enemies</span>, <span class="hljs-params">armed</span>)</span>;<br>        <br>        <span class="hljs-comment">// 调用 hero 合约的 alert 函数</span><br>        (<span class="hljs-built_in">bool</span> success, ) = hero.call(payload);<br>        require(success, <span class="hljs-string">&quot;Alert failed&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h1 id="之前的报错"><a href="#之前的报错" class="headerlink" title="之前的报错"></a>之前的报错</h1><p>错误答案：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml"><span class="hljs-comment">// SPDX-License-Identifier: MIT </span><br>pragma solidity ^<span class="hljs-number">0.8</span>.<span class="hljs-number">20</span>; <br>contract Sidekick &#123; <br>	<span class="hljs-keyword">function</span> send<span class="hljs-constructor">Alert(<span class="hljs-params">address</span> <span class="hljs-params">hero</span>, <span class="hljs-params">uint</span> <span class="hljs-params">enemies</span>, <span class="hljs-params">bool</span> <span class="hljs-params">armed</span>)</span> <span class="hljs-keyword">external</span> &#123; <br>		<span class="hljs-built_in">bytes</span> memory payload = abi.encode<span class="hljs-constructor">WithSignature(<span class="hljs-string">&quot;alert(uint256,bool)&quot;</span>,5,<span class="hljs-params">true</span>)</span>; <br>		(<span class="hljs-built_in">bool</span> success1, ) = hero.call(payload); <br>	&#125; <br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>从你提供的错误信息来看，<code>testAlert2()</code> 测试没有通过，错误表明传递给 <code>hero</code> 合约的敌人数量和敌人是否武装的值与预期不匹配：</p>
<ul>
<li><strong>错误 1:</strong> <code>it should have let the hero know there are 2 enemies</code> — 你传递的敌人数量是 5，但应该是 2。</li>
<li><strong>错误 2:</strong> <code>it should have let the hero know the enemies are not armed</code> — 你传递的敌人是否武装是 <code>true</code>，但应该是 <code>false</code>。</li>
</ul>
<p>这意味着你的 <code>sendAlert</code> 函数只发送了固定的值 <code>5</code> 和 <code>true</code>，没有根据测试要求传递正确的动态值。</p>
<h3 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h3><p>你需要调整 <code>Sidekick</code> 合约中的 <code>sendAlert</code> 函数，使其能够根据传入的 <code>enemies</code> 和 <code>armed</code> 参数来动态生成 calldata，并将这些值传递给 <code>hero</code> 合约。这样，<code>testAlert2()</code> 测试就会传递正确的敌人数量和武装状态。</p>
<h3 id="修改后的代码："><a href="#修改后的代码：" class="headerlink" title="修改后的代码："></a>修改后的代码：</h3><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs solidity">// SPDX-License-Identifier: MIT<br>pragma solidity ^0.8.20;<br><br>contract Sidekick &#123;<br>    // sendAlert 函数根据传入的参数生成 calldata<br>    function sendAlert(address hero, uint enemies, bool armed) external &#123;<br>        // 使用传入的 enemies 和 armed 参数构造 calldata<br>        bytes memory payload = abi.encodeWithSignature(&quot;alert(uint256,bool)&quot;, enemies, armed);<br>        <br>        // 调用 hero 合约的 alert 函数<br>        (bool success, ) = hero.call(payload);<br>        require(success, &quot;Alert failed&quot;);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h3 id="解释："><a href="#解释：" class="headerlink" title="解释："></a>解释：</h3><ul>
<li>在原来的代码中，<code>sendAlert</code> 函数总是传递固定的 <code>5</code> 和 <code>true</code>。但我们需要动态传递 <code>enemies</code> 和 <code>armed</code> 参数，因此我们使用 <code>abi.encodeWithSignature</code> 来根据传入的参数构造正确的 calldata。</li>
<li>通过 <code>hero.call(payload)</code> 调用 <code>hero</code> 合约的 <code>alert</code> 函数，传递动态的 <code>enemies</code> 和 <code>armed</code> 参数。</li>
</ul>
<h3 id="进一步说明："><a href="#进一步说明：" class="headerlink" title="进一步说明："></a>进一步说明：</h3><ul>
<li><strong><code>abi.encodeWithSignature(&quot;alert(uint256,bool)&quot;, enemies, armed)</code></strong>: 这里我们构造了一个 calldata，用于调用 <code>alert(uint256,bool)</code> 函数。我们用传入的 <code>enemies</code> 和 <code>armed</code> 参数来替代原来的固定值 <code>5</code> 和 <code>true</code>，确保每次调用时传递正确的值。</li>
<li><strong><code>(bool success, ) = hero.call(payload)</code></strong>: 使用 <code>call</code> 机制调用目标合约的 <code>alert</code> 函数，并传递正确的 calldata。</li>
</ul>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><p>通过上述修改，<code>Sidekick</code> 合约的 <code>sendAlert</code> 函数将根据输入动态生成正确的 calldata，并传递给 <code>hero</code> 合约。这样，<code>testAlert2()</code> 测试将能够通过，传递正确的敌人数量和敌人是否武装的状态。</p>
<h1 id="Your-Goal-Pass-Calldata-你的目标：传递调用数据"><a href="#Your-Goal-Pass-Calldata-你的目标：传递调用数据" class="headerlink" title="Your Goal: Pass Calldata 你的目标：传递调用数据"></a>Your Goal: Pass Calldata 你的目标：传递调用数据</h1><p>The Sidekick needs to be able to relay any calldata along to the Hero. Update the relay function to take the data and send it to the Hero as calldata.<br>Sidekick需要能够将任何调用数据转发给Hero。更新relay函数以接收data并将其作为调用数据发送给Hero。</p>
<p>答案：</p>
<figure class="highlight armasm"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs armasm"><span class="hljs-comment">// SPDX-License-Identifier: MIT</span><br><span class="hljs-symbol">pragma</span> solidity ^<span class="hljs-number">0</span>.<span class="hljs-number">8</span>.<span class="hljs-number">20</span><span class="hljs-comment">;</span><br><br><span class="hljs-symbol">contract</span> Sidekick &#123;<br>    <span class="hljs-meta">function</span> relay(address hero, bytes memory <span class="hljs-meta">data</span>) external &#123;<br>        <span class="hljs-comment">// send all of the data as calldata to the hero</span><br>        (bool success, ) = hero.call(<span class="hljs-meta">data</span>)<span class="hljs-comment">;</span><br>        <span class="hljs-meta">require</span>(success, <span class="hljs-string">&quot;Relay failed&quot;</span>)<span class="hljs-comment">;</span><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h1 id="Your-Goal-Trigger-the-fallback-你的目标：传递调用数据"><a href="#Your-Goal-Trigger-the-fallback-你的目标：传递调用数据" class="headerlink" title="Your Goal: Trigger the fallback 你的目标：传递调用数据"></a>Your Goal: Trigger the fallback 你的目标：传递调用数据</h1><p><strong>回退函数 (Fallback Function)</strong></p>
<p>当数据发送到合约时，如果数据与合约中任何函数的“标识符”不匹配（即函数签名的前 4 个字节的哈希值），合约的回退函数（fallback function）将被触发。这意味着，如果你向合约发送一个随机的 4 字节值，它很可能不会匹配任何函数，如果合约中存在回退函数，就会触发回退函数。</p>
<p>同样的，如果你发送的数据字节数少于或多于 4 字节！只要这前 4 字节与某个函数标识符不匹配，回退函数就会被触发。</p>
<p>题目：<br>In the makeContact method, send some calldata to the Hero contract that will trigger its fallback function.<br>Sidekick需要能够将任何调用数据转发给Hero。更新relay函数以接收data并将其作为调用数据发送给Hero。</p>
<p>答案：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml"><span class="hljs-comment">// SPDX-License-Identifier: MIT</span><br>pragma solidity ^<span class="hljs-number">0.8</span>.<span class="hljs-number">20</span>;<br><br>contract Sidekick &#123;<br>    <span class="hljs-keyword">function</span> make<span class="hljs-constructor">Contact(<span class="hljs-params">address</span> <span class="hljs-params">hero</span>)</span> <span class="hljs-keyword">external</span> &#123;<br>        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> trigger the hero&#x27;s fallback function!</span><br>        (<span class="hljs-built_in">bool</span> success, ) = hero.call(<span class="hljs-string">&quot;data&quot;</span>);<br>        require(success, <span class="hljs-string">&quot;Relay failed&quot;</span>);<br>    &#125;<br>    fallback<span class="hljs-literal">()</span> <span class="hljs-keyword">external</span> payable &#123;<br>        <span class="hljs-comment">// 这里可以处理触发回退函数的逻辑</span><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>


            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Web3/">Web3</a>
                    
                  </div>
                
              </div>
              
                
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/12/13/f457a26d7c05/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">别再卷低端岗了！“人才过剩”骗局下，这3类岗位正在抢人</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/12/11/fca5d7967d77/">
                        <span class="hidden-mobile">CertiK最大的Web3安全公司</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


            

                
                  <a id="scroll-top-button" href="#" role="button">
                    <i class="iconfont icon-arrowup" aria-hidden="true"></i>
                  </a>
                  

                    
                      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
                        

                          
      </main>

      <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://whale3070.github.io/" target="_blank" rel="nofollow noopener"><span>Whale3070</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>






  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



    </body>

  </html>