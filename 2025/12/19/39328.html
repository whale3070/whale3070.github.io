

  <!DOCTYPE html>
  <html lang="zh-CN" data-default-color-scheme=&#34;dark&#34; >
  <style>
    .text1
    {
    text-shadow: 0px 0px 2px #f2f3f2;
    }
    </style>

  <script>
    // 强制内网 IP 识别为安全上下文
    if (window.location.hostname !== 'localhost' && window.location.protocol === 'http:') {
        // 尝试手动映射 crypto 属性
        if (!window.crypto.subtle && window.crypto.webkitSubtle) {
            window.crypto.subtle = window.crypto.webkitSubtle;
        }
    }
    
    // 终极补丁：如果还是没有 subtle，则创建一个占位符避免报错
    // 提示：这通常能解决加载报错，但如果插件强依赖原生加密，建议执行下面的“降级”预判
    if (!window.isSecureContext) {
        console.warn('当前环境非安全上下文，正在尝试兼容内网加密解密...');
    }
</script>


<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/null">
  <link rel="icon" type="image/png" href="/null">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  <title>Damn Vulnerable DeFi（八） - whale3070&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.4.0/styles/github-gist.min.css" />
    
  

  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"192.168.126.129","root":"/","version":"1.8.7","typing":{"enable":false,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":false,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 7.3.0"></head>


    <body>
      <header style="height: 70vh;">
        <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>InfoSec learning</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/search/">
                <i class="iconfont icon-search"></i>
                搜索
              </a>
            </li>
          
        
        
        
          
        
      </ul>
    </div>
  </div>
</nav>

          <div class="banner" id="banner" false
            style="background: url('/img/default.png') no-repeat center center;
              background-size: cover;">
              <div class="full-bg-img">
                <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
                  <div class="page-header text-center fade-in-up">
                    <span class="h2 text1" id="subtitle" title="Damn Vulnerable DeFi（八）">
                      
                        Damn Vulnerable DeFi（八）
                      
                    </span>
        
                    
                      <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2025-12-19 03:31" pubdate>
        2025年12月19日 凌晨
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      7.4k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      87
       分钟
    </span>
  

  
  
</div>

                    
                  </div>
                    
                  </div>
                  
                </div>
              </div>
          </div>
      </header>

      <main>
        
          

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" data-pagefind-body>
            <!-- SEO header -->
            <h1 style="display: none">Damn Vulnerable DeFi（八）</h1>
            
            <div class="markdown-body">
              <p>今天的任务是： 1. 用mermaid画出Truster、Naive Receiver、Unstoppable的漏洞利用示意图。<br>2. 熟悉EVM原理<br>3. 花半小时看登链社区的安全审计相关文章，拓展知识面<br>看《关于审计技术和工具 101事》 <a target="_blank" rel="noopener" href="https://learnblockchain.cn/article/5163">https://learnblockchain.cn/article/5163</a></p>
<h1 id="mermaid使用哪种图来表示漏洞利用示例图？"><a href="#mermaid使用哪种图来表示漏洞利用示例图？" class="headerlink" title="mermaid使用哪种图来表示漏洞利用示例图？"></a>mermaid使用哪种图来表示漏洞利用示例图？</h1><p>mermaid上面有流程图，时序图，类图，状态图等等数十种。<br>哪一种用来画漏洞利用示例图？</p>
<p>你想知道在Mermaid的数十种图表类型中，哪一种最适合绘制<strong>漏洞利用示例图</strong>——核心结论是：没有绝对唯一的答案，但要根据漏洞利用的<strong>核心逻辑场景</strong>选择适配的图表类型，其中<strong>流程图（Flowchart）</strong> 是基础且通用的选择，部分场景搭配<strong>时序图（Sequence Diagram）</strong> 或<strong>状态图（State Diagram）</strong> 效果更佳。</p>
<p>结合你的安全背景（渗透测试、漏洞挖掘）和审美优势，下面按“适用场景+示例代码+使用建议”拆解，帮你精准匹配：</p>
<h3 id="一、核心推荐：流程图（Flowchart）——-90-漏洞利用场景首选"><a href="#一、核心推荐：流程图（Flowchart）——-90-漏洞利用场景首选" class="headerlink" title="一、核心推荐：流程图（Flowchart）—— 90%漏洞利用场景首选"></a>一、核心推荐：流程图（Flowchart）—— 90%漏洞利用场景首选</h3><h4 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h4><p>✅ 漏洞利用的<strong>步骤逻辑</strong>（比如“如何一步步利用某EVM Opcode漏洞盗币”）、✅ 攻击链路拆解、✅ 漏洞利用的条件&#x2F;分支（比如“成功利用&#x2F;利用失败&#x2F;触发防御”）。<br>这是最贴合漏洞利用“操作流程”的图表类型，也是你之前画漏洞生命周期的基础，能完美结合你的艺术化隐喻（比如油画笔触、色彩）。</p>
<h4 id="示例：EVM-CALL指令漏洞利用流程图（艺术化-技术结合）"><a href="#示例：EVM-CALL指令漏洞利用流程图（艺术化-技术结合）" class="headerlink" title="示例：EVM CALL指令漏洞利用流程图（艺术化+技术结合）"></a>示例：EVM CALL指令漏洞利用流程图（艺术化+技术结合）</h4><pre><code class=" mermaid">graph LR
    A[&quot;🎯 漏洞发现&lt;br/&gt;（审计发现CALL指令未校验权限）&quot;]:::discover --&gt; B[&quot;📝 构造攻击合约&lt;br/&gt;（写入恶意CALL调用逻辑）&quot;]:::construct
    B --&gt; C[&quot;🔧 部署攻击合约&lt;br/&gt;（部署到EVM链上）&quot;]:::deploy
    C --&gt; D[&quot;🚀 触发漏洞&lt;br/&gt;（调用目标合约的CALL指令）&quot;]:::trigger
    D --&gt; E&#123;&quot;📊 执行结果&quot;&#125;:::judge
    E --&gt;|✅ 权限绕过| F[&quot;💰 盗取资产&lt;br/&gt;（调用转账函数转移资金）&quot;]:::exploit
    E --&gt;|❌ 触发防御| G[&quot;🛡️ 利用失败&lt;br/&gt;（Gas耗尽/权限拦截）&quot;]:::fail
    E --&gt;|⚠️ 部分成功| H[&quot;📈 仅读取数据&lt;br/&gt;（未盗资产但获取敏感信息）&quot;]:::partial
    
    %% 油画风配色（低饱和莫兰迪色系）
    classDef discover fill:#E8D5C4,stroke:#A18276,stroke-width:2px
    classDef construct fill:#C8E4B2,stroke:#739072,stroke-width:2px
    classDef deploy fill:#BFD7EA,stroke:#4F709C,stroke-width:2px
    classDef trigger fill:#F2D8D8,stroke:#A7727D,stroke-width:2px
    classDef judge fill:#F5E8C7,stroke:#C08261,stroke-width:2px
    classDef exploit fill:#FFE5E5,stroke:#D7443E,stroke-width:2px
    classDef fail fill:#E0E9FF,stroke:#4A7298,stroke-width:2px
    classDef partial fill:#FFF4D2,stroke:#F0A868,stroke-width:2px
</code></pre>

<h3 id="二、补充选择1：时序图（Sequence-Diagram）——-多角色交互类漏洞"><a href="#二、补充选择1：时序图（Sequence-Diagram）——-多角色交互类漏洞" class="headerlink" title="二、补充选择1：时序图（Sequence Diagram）—— 多角色交互类漏洞"></a>二、补充选择1：时序图（Sequence Diagram）—— 多角色交互类漏洞</h3><h4 id="适用场景-1"><a href="#适用场景-1" class="headerlink" title="适用场景"></a>适用场景</h4><p>✅ 涉及“攻击者-目标合约-第三方合约&#x2F;预言机”多角色交互的漏洞（比如RWA项目的预言机操控漏洞、跨合约调用漏洞）、✅ 漏洞利用的“时间顺序+角色交互”（比如先调用A合约，再触发B合约的漏洞）。</p>
<h4 id="示例：RWA预言机操控漏洞利用时序图"><a href="#示例：RWA预言机操控漏洞利用时序图" class="headerlink" title="示例：RWA预言机操控漏洞利用时序图"></a>示例：RWA预言机操控漏洞利用时序图</h4><pre><code class=" mermaid">sequenceDiagram
    participant Attacker as 🕵️ 攻击者
    participant MaliciousContract as 🤖 恶意合约
    participant Oracle as 📡 预言机
    participant RWAContract as 🏠 RWA合约
    
    Attacker-&gt;&gt;MaliciousContract: 1. 部署恶意合约
    Attacker-&gt;&gt;MaliciousContract: 2. 调用操纵函数
    MaliciousContract-&gt;&gt;Oracle: 3. 伪造喂价数据（篡改资产价格）
    Oracle--&gt;&gt;MaliciousContract: 4. 返回虚假价格
    MaliciousContract-&gt;&gt;RWAContract: 5. 调用RWA质押函数（用虚假价格）
    RWAContract-&gt;&gt;Oracle: 6. 验证价格（未校验来源）
    Oracle--&gt;&gt;RWAContract: 7. 返回虚假价格
    RWAContract--&gt;&gt;Attacker: 8. 超额发放RWA代币（漏洞利用成功）
</code></pre>

<h3 id="三、补充选择2：状态图（State-Diagram）——-状态切换类漏洞"><a href="#三、补充选择2：状态图（State-Diagram）——-状态切换类漏洞" class="headerlink" title="三、补充选择2：状态图（State Diagram）—— 状态切换类漏洞"></a>三、补充选择2：状态图（State Diagram）—— 状态切换类漏洞</h3><h4 id="适用场景-2"><a href="#适用场景-2" class="headerlink" title="适用场景"></a>适用场景</h4><p>✅ 依赖“合约状态变化”的漏洞（比如重入漏洞、状态变量未更新导致的重复提现、RWA资产状态篡改）、✅ 展示“正常状态→漏洞触发→异常状态”的流转（比如钱包从“安全”→“被攻击”→“资产被盗”）。</p>
<h4 id="示例：重入漏洞状态流转图"><a href="#示例：重入漏洞状态流转图" class="headerlink" title="示例：重入漏洞状态流转图"></a>示例：重入漏洞状态流转图</h4><pre><code class=" mermaid">stateDiagram-v2
    [*] --&gt; Normal: 合约初始状态
    Normal --&gt; Withdrawing: 用户调用提现函数
    Withdrawing --&gt; Reentering: 触发重入（回调恶意合约）
    Reentering --&gt; Exploited: 重复提现资产
    Exploited --&gt; Compromised: 合约资产耗尽
    Withdrawing --&gt; Normal: 提现完成（无漏洞）
    Compromised --&gt; [*]: 合约失效
    
    %% 样式优化
    state Normal &#123;
        note right: 资产充足&lt;br/&gt;状态变量未锁定
    &#125;
    state Exploited &#123;
        note right: 状态变量未及时更新&lt;br/&gt;多次提现成功
    &#125;
</code></pre>

<h3 id="四、其他类型：仅特定场景使用"><a href="#四、其他类型：仅特定场景使用" class="headerlink" title="四、其他类型：仅特定场景使用"></a>四、其他类型：仅特定场景使用</h3><p>| Mermaid图表类型 | 适用漏洞场景 | 使用建议 |<br>| 类图（Class Diagram） | 分析合约继承&#x2F;接口设计漏洞（比如继承权限漏洞） | 仅审计合约架构时用，不适合画“利用流程” |<br>| 饼图&#x2F;柱状图 | 漏洞利用成功率统计、影响范围分析 | 作为辅助图表，搭配流程图展示数据 |<br>| 思维导图（Mindmap） | 漏洞利用思路拆解（比如“EVM漏洞→Opcode→CALL→权限绕过”） | 前期梳理思路用，不适合展示完整利用流程 |</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ol>
<li><strong>核心选择</strong>：90%的漏洞利用示例图优先用<strong>流程图（Flowchart）</strong>，适配绝大多数“步骤化”的利用逻辑，且最易结合你的油画审美做艺术化改造；</li>
<li><strong>场景补充</strong>：涉及多角色交互用<strong>时序图</strong>，涉及状态切换用<strong>状态图</strong>，其他类型仅作为辅助；</li>
<li><strong>差异化技巧</strong>：在图表中加入油画式隐喻（比如用“调色盘”代表堆栈、“笔触”代表Opcode）、低饱和莫兰迪配色，让技术图表既有专业性又有记忆点，这是你区别于其他安全人员的核心优势。</li>
</ol>
<p>如果需要针对某类具体漏洞（比如RWA审计中常见的预言机漏洞、权限漏洞）设计专属的Mermaid示例图，我可以帮你定制！</p>
<h1 id="我用什么方法熟悉EVM原理？"><a href="#我用什么方法熟悉EVM原理？" class="headerlink" title="我用什么方法熟悉EVM原理？"></a>我用什么方法熟悉EVM原理？</h1><p>你想系统掌握EVM（以太坊虚拟机）原理，核心思路是<strong>从“可视化理解”到“动手实操”</strong> ——先建立直观认知，再拆解核心机制，最后通过实战验证，结合你擅长的可视化（Mermaid&#x2F;油画审美）和安全背景（漏洞挖掘），能让学习过程更高效、不枯燥。</p>
<p>下面是一套专为你设计的「分层学习法」，兼顾原理理解和实战落地，完全适配你的技术背景：</p>
<h3 id="一、第一步：可视化建立EVM整体认知（1-2周）"><a href="#一、第一步：可视化建立EVM整体认知（1-2周）" class="headerlink" title="一、第一步：可视化建立EVM整体认知（1-2周）"></a>一、第一步：可视化建立EVM整体认知（1-2周）</h3><p>先不用钻细节，用你擅长的“视觉化思维”画出EVM的核心逻辑，把抽象概念转化为你能理解的“画布结构”：</p>
<h4 id="1-用Mermaid画EVM核心架构图（艺术化-技术结合）"><a href="#1-用Mermaid画EVM核心架构图（艺术化-技术结合）" class="headerlink" title="1. 用Mermaid画EVM核心架构图（艺术化+技术结合）"></a>1. 用Mermaid画EVM核心架构图（艺术化+技术结合）</h4><p>结合你之前设计漏洞生命周期的思路，用Mermaid把EVM拆解成“组件+流程”，加入油画式的隐喻命名，比如：</p>
<pre><code class=" mermaid">graph TD
    A[&quot;🎨 外部触发层&lt;br/&gt;（交易/合约调用=画笔落笔）&quot;] --&gt; B[&quot;⚙️ EVM核心执行层&lt;br/&gt;（字节码执行=颜料调和）&quot;]
    B --&gt; C[&quot;📦 状态存储层&lt;br/&gt;（账户/存储=画布肌理）&quot;]
    B --&gt; D[&quot;🧮 计算资源层&lt;br/&gt;（Gas计费=调色用量）&quot;]
    B --&gt; E[&quot;📜 日志输出层&lt;br/&gt;（事件/日志=签名落款）&quot;]
    
    %% EVM内部拆解
    B1[&quot;字节码解析器&lt;br/&gt;（把Solidity转Opcode）&quot;]:::opcode --&gt; B
    B2[&quot;堆栈机&lt;br/&gt;（执行指令的核心容器）&quot;]:::stack --&gt; B
    B3[&quot;内存/存储&lt;br/&gt;（临时/永久数据区）&quot;]:::mem --&gt; B
    B4[&quot;Gas计算器&lt;br/&gt;（每步操作的成本核算）&quot;]:::gas --&gt; B
    
    classDef opcode fill:#E8F4FD,stroke:#4299E1,stroke-width:2px
    classDef stack fill:#FDF2F8,stroke:#9F7AEA,stroke-width:2px
    classDef mem fill:#F5F5F5,stroke:#38B2AC,stroke-width:2px
    classDef gas fill:#F7FAFC,stroke:#ED8936,stroke-width:2px
</code></pre>
<h4 id="2-看可视化教程建立直观认知"><a href="#2-看可视化教程建立直观认知" class="headerlink" title="2. 看可视化教程建立直观认知"></a>2. 看可视化教程建立直观认知</h4><ul>
<li>推荐资源：<ul>
<li>《EVM Illustrated》（图文可视化，把EVM执行过程画成漫画，适配你的审美）；</li>
<li>YouTube《EVM Deep Dive》（动画讲解，看堆栈机、Opcode执行的动态过程）；</li>
</ul>
</li>
<li>核心目标：搞懂“一笔交易从发送到执行完成，在EVM里走了哪些步骤”，比如：<br>交易→RPC节点→打包进区块→EVM解析字节码→执行Opcode→修改账户状态→扣Gas→输出日志。</li>
</ul>
<h3 id="二、第二步：拆解EVM核心机制（2-3周）"><a href="#二、第二步：拆解EVM核心机制（2-3周）" class="headerlink" title="二、第二步：拆解EVM核心机制（2-3周）"></a>二、第二步：拆解EVM核心机制（2-3周）</h3><p>从“整体”到“局部”，聚焦和你安全审计相关的核心模块（毕竟你目标是RWA审计，不用学底层开发）：</p>
<h4 id="1-核心模块拆解（只学审计必备）"><a href="#1-核心模块拆解（只学审计必备）" class="headerlink" title="1. 核心模块拆解（只学审计必备）"></a>1. 核心模块拆解（只学审计必备）</h4><p>| 模块         | 学习重点（审计视角）| 通俗理解（油画隐喻）|<br>| Opcode指令集 | 高频危险指令（CALL&#x2F;DELEGATECALL&#x2F;SSTORE）、权限控制指令 | 不同的画笔笔触，有的笔触（指令）容易画错（出漏洞） |<br>| 堆栈机       | 堆栈操作规则、栈溢出&#x2F;下溢风险                | 调色盘的容量，放太多&#x2F;太少颜料都会出错    |<br>| Gas机制      | Gas限制、无限循环导致的DoS、Gas优化漏洞      | 调色的颜料总量，用完了就画不完（执行中断） |<br>| 账户模型     | EOA账户vs合约账户、存储布局（slot计算）| 画布的不同区域，有的区域（slot）能改，有的不能 |<br>| 存储布局     | 变量如何映射到存储slot、数组&#x2F;结构体的存储规则 | 颜料在画布上的排列方式，排错了就会漏色（读错数据） |</p>
<h4 id="2-动手验证（用工具拆解合约）"><a href="#2-动手验证（用工具拆解合约）" class="headerlink" title="2. 动手验证（用工具拆解合约）"></a>2. 动手验证（用工具拆解合约）</h4><p>用你熟悉的安全工具思维，拆解真实合约的EVM执行过程：</p>
<ul>
<li>工具：Remix（开启“Show Opcode”）、Etherscan（合约页面看Bytecode）、evm.codes（Opcode查询）；</li>
<li>实操步骤：<ol>
<li>写一个简单的Solidity合约（比如转账+权限控制）；</li>
<li>在Remix里编译，查看生成的Bytecode和Opcode；</li>
<li>逐行分析Opcode对应的操作（比如PUSH1、CALL、SSTORE）；</li>
<li>故意写一个漏洞（比如DELEGATECALL权限绕过），看Opcode执行时哪里出了问题。</li>
</ol>
</li>
</ul>
<h3 id="三、第三步：实战落地（3-4周）——-结合安全审计"><a href="#三、第三步：实战落地（3-4周）——-结合安全审计" class="headerlink" title="三、第三步：实战落地（3-4周）—— 结合安全审计"></a>三、第三步：实战落地（3-4周）—— 结合安全审计</h3><p>这是最关键的一步，把EVM原理和你擅长的“漏洞挖掘”结合，直接对接RWA审计需求：</p>
<h4 id="1-针对性练手（审计场景）"><a href="#1-针对性练手（审计场景）" class="headerlink" title="1. 针对性练手（审计场景）"></a>1. 针对性练手（审计场景）</h4><ul>
<li>练手项目：Damn Vulnerable DeFi（DVDF）—— 每个关卡都对应EVM层面的漏洞，比如：<ul>
<li>关卡2（Naive Receiver）：利用CALL指令的Gas参数漏洞；</li>
<li>关卡4（Side Entrance）：利用CALL指令的返回值处理漏洞；</li>
<li>关卡7（Compromised）：利用存储slot读写漏洞；</li>
</ul>
</li>
<li>核心动作：每做一个关卡，都要回答“这个漏洞在EVM层面是怎么发生的？对应的Opcode哪里出了问题？”</li>
</ul>
<h4 id="2-分析RWA合约的EVM特征"><a href="#2-分析RWA合约的EVM特征" class="headerlink" title="2. 分析RWA合约的EVM特征"></a>2. 分析RWA合约的EVM特征</h4><p>找真实的香港RWA项目合约（比如稳定币、房产映射合约），做2件事：</p>
<ol>
<li>拆解其Bytecode，看核心逻辑的Opcode执行流程；</li>
<li>分析存储布局，看资产相关变量存在哪个slot，是否有读写权限漏洞；</li>
<li>用你设计的Mermaid图表，画出“RWA合约漏洞在EVM中的执行路径”（比如预言机喂价漏洞→Opcode层面的CALL指令调用外部合约→数据篡改）。</li>
</ol>
<h3 id="四、学习资源（精准避坑，不浪费时间）"><a href="#四、学习资源（精准避坑，不浪费时间）" class="headerlink" title="四、学习资源（精准避坑，不浪费时间）"></a>四、学习资源（精准避坑，不浪费时间）</h3><p>不用看厚书，聚焦“审计导向”的资源：</p>
<ol>
<li>文档：<ul>
<li>《EVM Mechanics》（官方偏技术，但重点看“Execution Model”和“Gas”章节）；</li>
<li>《Solidity Security Patterns》（结合EVM讲漏洞）；</li>
</ul>
</li>
<li>视频：<ul>
<li>Patrick Collins的《EVM Deep Dive》（适合安全人员，B站有中文字幕）；</li>
<li>慢雾科技的《EVM安全审计实战》（中文，贴合漏洞挖掘）；</li>
</ul>
</li>
<li>工具：<ul>
<li>Remix（Opcode调试）、Foundry（EVM层面的测试）、evm-debugger（断点调试）。</li>
</ul>
</li>
</ol>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><ol>
<li>学习路径：<strong>可视化建框架→拆解核心模块→审计场景实战</strong>，全程结合你的“可视化审美”和“安全漏洞思维”，避免纯理论枯燥；</li>
<li>核心重点：不用学EVM底层开发（比如写虚拟机），只聚焦“Opcode、存储布局、Gas机制、账户模型”这4个审计必备模块；</li>
<li>落地关键：把EVM原理和RWA合约审计结合，比如分析RWA合约的存储slot、危险Opcode调用，这才是你求职香港RWA审计的核心竞争力。</li>
</ol>
<p>如果需要，我可以帮你设计一份「EVM审计核心知识点Mermaid图表」（结合油画隐喻），或者拆解一个真实RWA合约的EVM执行流程，让你直接上手练！</p>
<h1 id="Ethernaut：是OpenZeppelin的一个基于Web3-Solidity的战争游戏，在以太坊虚拟机中进行。每个关卡都是一个智能合约，需要被-“黑-“掉。该游戏是100-开源的，所有关卡都是其他玩家的贡献。如何结合ethernaut来帮助我考过智能合约审计认证（如-CertiK-Academy）"><a href="#Ethernaut：是OpenZeppelin的一个基于Web3-Solidity的战争游戏，在以太坊虚拟机中进行。每个关卡都是一个智能合约，需要被-“黑-“掉。该游戏是100-开源的，所有关卡都是其他玩家的贡献。如何结合ethernaut来帮助我考过智能合约审计认证（如-CertiK-Academy）" class="headerlink" title="Ethernaut：是OpenZeppelin的一个基于Web3&#x2F;Solidity的战争游戏，在以太坊虚拟机中进行。每个关卡都是一个智能合约，需要被 “黑 “掉。该游戏是100%开源的，所有关卡都是其他玩家的贡献。如何结合ethernaut来帮助我考过智能合约审计认证（如 CertiK Academy）"></a>Ethernaut：是OpenZeppelin的一个基于Web3&#x2F;Solidity的战争游戏，在以太坊虚拟机中进行。每个关卡都是一个智能合约，需要被 “黑 “掉。该游戏是100%开源的，所有关卡都是其他玩家的贡献。如何结合ethernaut来帮助我考过智能合约审计认证（如 CertiK Academy）</h1><p>你想通过Ethernaut这个实战性极强的智能合约攻防游戏，系统性地提升技能，从而通过CertiK Academy等智能合约审计认证，这个思路非常精准——因为CertiK认证的核心是考察<strong>漏洞识别、原理理解、修复方案</strong>，而Ethernaut的每一关都对应真实审计中高频出现的漏洞类型，完全可以形成“实战训练→考点对标→认证通关”的闭环。</p>
<p>下面我会帮你梳理「Ethernaut关卡→CertiK认证考点」的对应关系，以及分阶段的学习方法，让你把游戏通关转化为实打实的审计能力，高效备考。</p>
<h3 id="一、先明确核心逻辑：Ethernaut-vs-CertiK认证的匹配度"><a href="#一、先明确核心逻辑：Ethernaut-vs-CertiK认证的匹配度" class="headerlink" title="一、先明确核心逻辑：Ethernaut vs CertiK认证的匹配度"></a>一、先明确核心逻辑：Ethernaut vs CertiK认证的匹配度</h3><p>CertiK Academy的智能合约审计认证（比如CertiK Smart Contract Auditor）核心考察模块包括：</p>
<ol>
<li>基础语法与安全规范（Solidity核心特性、OpenZeppelin最佳实践）</li>
<li>常见漏洞攻防（重入、整数溢出、权限控制、逻辑漏洞等）</li>
<li>审计流程与工具使用（静态分析、手动审计、报告撰写）</li>
<li>实战审计案例（基于真实合约的漏洞挖掘）</li>
</ol>
<p>而Ethernaut的每一关都是对上述考点的“沉浸式实战”，比纯理论学习更易理解和记忆，尤其适合你这种有渗透测试&#x2F;漏洞挖掘基础的人（你的传统安全思维可以直接迁移）。</p>
<h3 id="二、分阶段学习方案：Ethernaut通关-CertiK备考"><a href="#二、分阶段学习方案：Ethernaut通关-CertiK备考" class="headerlink" title="二、分阶段学习方案：Ethernaut通关+CertiK备考"></a>二、分阶段学习方案：Ethernaut通关+CertiK备考</h3><h4 id="阶段1：基础适配（1-2周）——-打通游戏玩法-认证基础考点"><a href="#阶段1：基础适配（1-2周）——-打通游戏玩法-认证基础考点" class="headerlink" title="阶段1：基础适配（1-2周）—— 打通游戏玩法+认证基础考点"></a>阶段1：基础适配（1-2周）—— 打通游戏玩法+认证基础考点</h4><p>先熟悉Ethernaut的操作流程（部署合约、交互、攻击验证），同时对应CertiK的基础考点，建立“漏洞名称→原理→攻击手法”的认知：<br>| Ethernaut基础关卡 | 对应CertiK考点 | 核心学习目标 |<br>| 01-Fallback（回退函数） | Solidity接收ETH机制、权限控制基础 | 理解<code>receive()</code>&#x2F;<code>fallback()</code>的触发条件，掌握“越权接收ETH+修改所有者”的攻击逻辑 |<br>| 02-Fallback（升级版）&#x2F;03-Coinflip | 随机数预测、合约调用逻辑 | 掌握“区块属性（block.number&#x2F;block.timestamp）不可作为随机数”的审计要点 |<br>| 04-Telephone | 合约调用上下文（msg.sender vs tx.origin） | 区分两者的安全风险，记住“禁止用tx.origin做权限控制”的修复原则 |</p>
<p><strong>学习方法</strong>：</p>
<ul>
<li>每通一关，先自己分析漏洞原理，再对照OpenZeppelin的官方解析；</li>
<li>用Mermaid画你擅长的“漏洞生命周期图”（比如Fallback漏洞的“触发→攻击→提权”流程），强化记忆（既发挥你油画&#x2F;可视化优势，又契合审计报告的可视化需求）；</li>
<li>同步刷CertiK Academy的基础题库，把游戏里的实战场景对应到理论考点。</li>
</ul>
<h4 id="阶段2：核心漏洞攻坚（3-4周）——-对标CertiK高频考点"><a href="#阶段2：核心漏洞攻坚（3-4周）——-对标CertiK高频考点" class="headerlink" title="阶段2：核心漏洞攻坚（3-4周）—— 对标CertiK高频考点"></a>阶段2：核心漏洞攻坚（3-4周）—— 对标CertiK高频考点</h4><p>这一阶段聚焦CertiK认证中占分最高的“常见漏洞”模块，Ethernaut的核心关卡几乎全覆盖：<br>| Ethernaut核心关卡 | 对应CertiK核心考点 | 审计实战价值 |<br>| 06-Delegation | 委托调用（delegatecall）漏洞 | 审计中高频出现的“代码执行权限篡改”，掌握delegatecall的使用规范 |<br>| 07-Force | 自毁（selfdestruct）强制转账 | 理解“无接收函数也能被强制打ETH”的风险，审计时需检查合约是否处理此类异常 |<br>| 08-Vault | 私有变量（private）读取 | 记住“private变量可通过链上数据读取”，审计时避免用private存敏感信息 |<br>| 09-King | 重入漏洞（Reentrancy） | CertiK认证的重中之重，掌握ReentrancyGuard防护、Check-Effects-Interactions模式 |<br>| 10-Reentrancy | 重入漏洞进阶（跨合约重入） | 结合你的渗透测试经验，类比“传统安全的越权访问”，理解重入的攻击链 |<br>| 11-Elevator | 接口欺骗&#x2F;逻辑漏洞 | 审计中最易遗漏的“业务逻辑漏洞”，训练“跳出语法看业务”的审计思维 |<br>| 12-Privacy | 数据存储与加密漏洞 | 掌握Solidity中数据布局（slot）的读取方法，审计时检查敏感数据加密方案 |<br>| 15-NaughtCoin | ERC20代币漏洞（授权&#x2F;转账） | RWA审计中高频的代币合约审计，记住ERC20的常见安全坑（如approve重入、转账返回值） |</p>
<p><strong>学习方法</strong>：</p>
<ul>
<li>每攻克一个漏洞，不仅要通关，还要手动编写“修复后的合约代码”（比如给Reentrancy关卡的合约加上OpenZeppelin的ReentrancyGuard）；</li>
<li>模拟CertiK审计考试的场景：拿到关卡合约源码，先按“静态分析→手动审计→漏洞定位→修复建议”的流程写一份简易审计报告（这正是CertiK认证的实操环节）；</li>
<li>针对每个漏洞，总结“审计检查清单”（比如重入漏洞的检查点：①是否用了Check-Effects-Interactions ②是否引入ReentrancyGuard ③转账是否为最后一步）。</li>
</ul>
<h4 id="阶段3：综合实战与认证冲刺（2-3周）——-模拟考试场景"><a href="#阶段3：综合实战与认证冲刺（2-3周）——-模拟考试场景" class="headerlink" title="阶段3：综合实战与认证冲刺（2-3周）—— 模拟考试场景"></a>阶段3：综合实战与认证冲刺（2-3周）—— 模拟考试场景</h4><p>CertiK认证的最后环节是“实战审计案例”，Ethernaut的高阶关卡+自定义关卡正好用来模拟：</p>
<ol>
<li><strong>通关Ethernaut高阶关卡</strong>：比如18-MagicNumber（字节码攻击）、20-Denial（DoS攻击）、21-Shop（价格操纵），这些对应CertiK认证的“进阶漏洞”考点；</li>
<li><strong>复现真实审计场景</strong>：<ul>
<li>用Ethernaut的开源机制，下载其他玩家贡献的RWA相关合约关卡（比如映射现实资产的智能合约），按CertiK的审计标准完整审计；</li>
<li>用你擅长的Mermaid可视化，把审计报告中的“漏洞分布”“修复方案”做成艺术化图表（既符合CertiK对报告可读性的要求，又能体现你的差异化优势）；</li>
</ul>
</li>
<li><strong>模拟考试</strong>：报名CertiK Academy的模拟考试，把Ethernaut的解题思路迁移到考试中，重点关注“漏洞描述的准确性”“修复方案的可行性”（这是认证评分的核心）。</li>
</ol>
<h3 id="三、关键技巧：把你的优势最大化"><a href="#三、关键技巧：把你的优势最大化" class="headerlink" title="三、关键技巧：把你的优势最大化"></a>三、关键技巧：把你的优势最大化</h3><ol>
<li><p><strong>可视化记忆法</strong>：针对每个Ethernaut关卡的漏洞，画一张“漏洞攻防流程图”（用Mermaid+你的油画审美），比如：</p>
<pre><code class=" mermaid">graph LR
A[&quot;🎯 漏洞触发点&lt;br/&gt;(Reentrancy的withdraw函数)&quot;]:::attack --&gt; B[&quot;🔍 攻击路径&lt;br/&gt;(调用恶意合约重入)&quot;]:::path
B --&gt; C[&quot;⚠️ 漏洞危害&lt;br/&gt;(盗走全部ETH)&quot;]:::risk
C --&gt; D[&quot;🛡️ 修复方案&lt;br/&gt;(ReentrancyGuard+Check-Effects)&quot;]:::fix

classDef attack fill:#F8CECC,stroke:#B85450,stroke-width:2px
classDef path fill:#E8D5C4,stroke:#A67C52,stroke-width:2px
classDef risk fill:#FFE6E6,stroke:#FF6B6B,stroke-width:2px
classDef fix fill:#D5E8D4,stroke:#82B366,stroke-width:2px
</code></pre>
<p>这种可视化方式比纯文字笔记更容易记住，也能在CertiK面试&#x2F;实操环节加分。</p>
</li>
<li><p><strong>传统安全思维迁移</strong>：你的渗透测试&#x2F;漏洞挖掘经验是核心优势——把Ethernaut的智能合约漏洞类比为“传统web安全漏洞”（比如重入漏洞&#x3D;CSRF，权限控制漏洞&#x3D;越权访问），用你熟悉的“攻击链分析”思路拆解每一关，降低学习成本。</p>
</li>
<li><p><strong>错题复盘</strong>：把没通关的关卡、CertiK题库做错的题整理成“漏洞手册”，标注“漏洞类型→原理→易错点→修复方案”，考前快速复盘。</p>
</li>
</ol>
<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><ol>
<li>Ethernaut是CertiK认证的“实战训练场”，核心是把每一关的漏洞拆解为“原理→攻击→修复”，对应CertiK的考点；</li>
<li>你的核心优势是「渗透测试思维+可视化审美」：用渗透思路拆解漏洞攻击链，用Mermaid艺术化图表强化记忆，既高效又能体现差异化；</li>
<li>备考节奏：先基础适配，再攻坚核心漏洞，最后模拟审计实战，6-9周可完成从Ethernaut通关到CertiK认证的核心准备。</li>
</ol>
<p>如果需要，我可以帮你整理「Ethernaut全关卡- CertiK考点对照表」和「智能合约审计检查清单（适配CertiK认证）」，直接套用即可。</p>
<h1 id="用mermaid画出Unstoppable攻击原理图"><a href="#用mermaid画出Unstoppable攻击原理图" class="headerlink" title="用mermaid画出Unstoppable攻击原理图"></a>用mermaid画出Unstoppable攻击原理图</h1><p><img src="/2025/12/19/39328/Unstoppable.png"></p>
<h1 id="用mermaid画出Naive-Receiver攻击原理图"><a href="#用mermaid画出Naive-Receiver攻击原理图" class="headerlink" title="用mermaid画出Naive Receiver攻击原理图"></a>用mermaid画出Naive Receiver攻击原理图</h1><p><img src="/2025/12/19/39328/Receiver.png"></p>
<h1 id="用mermaid画出Truster攻击原理图"><a href="#用mermaid画出Truster攻击原理图" class="headerlink" title="用mermaid画出Truster攻击原理图"></a>用mermaid画出Truster攻击原理图</h1><p><img src="/2025/12/19/39328/Truster.png"></p>
<h1 id="我看不懂Damn-Vulnerable-DeFi的Solve-the-challenge的xx-t-sol，我该补充哪方面的知识呢？我对于foundry的理解停留在forge-test"><a href="#我看不懂Damn-Vulnerable-DeFi的Solve-the-challenge的xx-t-sol，我该补充哪方面的知识呢？我对于foundry的理解停留在forge-test" class="headerlink" title="我看不懂Damn Vulnerable DeFi的Solve the challenge的xx.t.sol，我该补充哪方面的知识呢？我对于foundry的理解停留在forge test"></a>我看不懂Damn Vulnerable DeFi的Solve the challenge的xx.t.sol，我该补充哪方面的知识呢？我对于foundry的理解停留在forge test</h1><p>你目前对 Foundry 的理解停留在 <code>forge test</code> 基础命令层面，看不懂 Damn Vulnerable DeFi（DVD）的测试文件（<code>.t.sol</code>），核心是因为缺少<strong>Solidity 合约开发、Foundry 测试框架核心用法、DeFi 核心逻辑</strong>这三类关键知识。我会帮你梳理从入门到能看懂 DVD 测试文件的学习路径，全程贴合新手的认知节奏。</p>
<h3 id="一、先明确核心问题：你看不懂的本质"><a href="#一、先明确核心问题：你看不懂的本质" class="headerlink" title="一、先明确核心问题：你看不懂的本质"></a>一、先明确核心问题：你看不懂的本质</h3><p>DVD 的 <code>.t.sol</code> 不是普通的“跑测试”，而是：</p>
<ol>
<li>用 Foundry 语法<strong>模拟攻击&#x2F;利用漏洞</strong>（核心是 Foundry 作弊码、测试语法）；</li>
<li>操作 DeFi 合约（闪电贷、代币、借贷池等，核心是 Solidity&#x2F;DeFi 基础）；</li>
<li>验证漏洞是否被成功利用（核心是断言、事件监听等测试逻辑）。</li>
</ol>
<p>你需要按“基础→进阶→实战”的顺序补充知识，以下是分阶段的学习重点：</p>
<h2 id="二、第一阶段：补全-Foundry-核心用法（最紧急）"><a href="#二、第一阶段：补全-Foundry-核心用法（最紧急）" class="headerlink" title="二、第一阶段：补全 Foundry 核心用法（最紧急）"></a>二、第一阶段：补全 Foundry 核心用法（最紧急）</h2><p>你只知道 <code>forge test</code>，但 DVD 测试文件大量用到 Foundry 的高级特性，这是看懂 <code>.t.sol</code> 的前提。</p>
<h3 id="1-先掌握-Foundry-测试的核心语法"><a href="#1-先掌握-Foundry-测试的核心语法" class="headerlink" title="1. 先掌握 Foundry 测试的核心语法"></a>1. 先掌握 Foundry 测试的核心语法</h3><p>| 知识点                | 作用（对应 DVD 测试场景）| 学习资源                                                                 |<br>| 测试合约结构          | 理解 <code>.t.sol</code> 中 <code>contract XxxChallenge</code> 如何组织 | Foundry 官方文档：<a target="_blank" rel="noopener" href="https://book.getfoundry.sh/forge/tests">https://book.getfoundry.sh/forge/tests</a>                 |<br>| <code>vm.*</code> 作弊码         | DVD 测试中高频用（模拟账户、时间、事件、转账）| Foundry 作弊码列表：<a target="_blank" rel="noopener" href="https://book.getfoundry.sh/cheatcodes/%EF%BC%88%E5%BF%85%E7%9C%8B%EF%BC%89|">https://book.getfoundry.sh/cheatcodes/（必看）|</a><br>| 事件监听（<code>expectEmit</code>） | 你遇到的 <code>FlashLoanStatus</code> 事件校验就是这个知识点 | <a target="_blank" rel="noopener" href="https://book.getfoundry.sh/forge/tests#expecting-emits">https://book.getfoundry.sh/forge/tests#expecting-emits</a>                  |<br>| 账户模拟（<code>prank</code>&#x2F;<code>startPrank</code>） | 模拟玩家&#x2F;部署者地址操作合约                     | <a target="_blank" rel="noopener" href="https://book.getfoundry.sh/forge/tests#pranking">https://book.getfoundry.sh/forge/tests#pranking</a>                          |<br>| 断言（<code>assert</code>&#x2F;<code>expectRevert</code>） | 验证漏洞是否触发（比如预期交易失败）| <a target="_blank" rel="noopener" href="https://book.getfoundry.sh/forge/tests#assertions">https://book.getfoundry.sh/forge/tests#assertions</a>                        |</p>
<h3 id="2-入门级实操（先跑通基础，再看-DVD）"><a href="#2-入门级实操（先跑通基础，再看-DVD）" class="headerlink" title="2. 入门级实操（先跑通基础，再看 DVD）"></a>2. 入门级实操（先跑通基础，再看 DVD）</h3><p>先写 2-3 个简单的 Foundry 测试案例，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs solidity">// 示例：模拟账户转账+事件监听<br>pragma solidity ^0.8.20;<br><br>import &quot;forge-std/Test.sol&quot;;<br>import &quot;../src/Token.sol&quot;; // 自己写一个简单的 ERC20 代币<br><br>contract TokenTest is Test &#123;<br>    Token public token;<br>    address public alice = address(1);<br>    address public bob = address(2);<br><br>    function setUp() public &#123;<br>        // 部署代币合约（DVD 测试中也会先部署漏洞合约）<br>        token = new Token();<br>    &#125;<br><br>    function testTransfer() public &#123;<br>        // 1. 模拟 alice 有代币（作弊码 vm.mint，对应 DVD 中给玩家发代币）<br>        vm.prank(address(token)); // 模拟代币合约地址<br>        token.mint(alice, 100 ether);<br><br>        // 2. 监听 Transfer 事件（对应你遇到的 FlashLoanStatus 事件）<br>        vm.expectEmit(true, true, false, true); // 配置监听的索引参数<br>        emit Transfer(alice, bob, 50 ether); // 预期触发的事件<br><br>        // 3. 模拟 alice 转账（prank 切换账户）<br>        vm.prank(alice);<br>        token.transfer(bob, 50 ether);<br><br>        // 4. 断言结果（验证转账成功）<br>        assertEq(token.balanceOf(bob), 50 ether);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>跑这个测试：<code>forge test --match-test testTransfer -vvv</code>，理解每一行的作用，再对照 DVD 的 <code>.t.sol</code>，你会发现逻辑是相通的。</p>
<h3 id="3-重点吃透-DVD-测试中高频的-5-个作弊码"><a href="#3-重点吃透-DVD-测试中高频的-5-个作弊码" class="headerlink" title="3. 重点吃透 DVD 测试中高频的 5 个作弊码"></a>3. 重点吃透 DVD 测试中高频的 5 个作弊码</h3><p>| 作弊码               | DVD 中的用途                                  | 简单示例                                                                 |<br>| <code>vm.prank(address)</code>  | 切换到指定地址执行下一步操作（比如玩家攻击）| <code>vm.prank(player); vault.flashLoan(...);</code>                                |<br>| <code>vm.expectEmit()</code>    | 预期某个事件被触发（比如你遇到的 FlashLoanStatus） | <code>vm.expectEmit(); emit FlashLoanStatus(false);</code>                          |<br>| <code>vm.expectRevert()</code>  | 预期交易回滚（验证漏洞触发，比如闪电贷失败）| <code>vm.expectRevert(&quot;Invalid balance&quot;); vault.flashLoan(...);</code>              |<br>| <code>vm.startPrank()</code>    | 持续切换账户（多步操作同一地址）| <code>vm.startPrank(player); token.transfer(...); token.approve(...);</code>        |<br>| <code>vm.label()</code>         | 给地址命名（方便看日志，比如 player&#x2F;deployer） | <code>vm.label(player, &quot;Player&quot;);</code>                                            |</p>
<h2 id="三、第二阶段：补全-Solidity-与-DeFi-基础（看懂合约逻辑）"><a href="#三、第二阶段：补全-Solidity-与-DeFi-基础（看懂合约逻辑）" class="headerlink" title="三、第二阶段：补全 Solidity 与 DeFi 基础（看懂合约逻辑）"></a>三、第二阶段：补全 Solidity 与 DeFi 基础（看懂合约逻辑）</h2><p>DVD 的测试文件是操作“漏洞合约”的，若看不懂合约本身的逻辑，也无法理解测试代码的目的。</p>
<h3 id="1-Solidity-核心知识点（优先级从高到低）"><a href="#1-Solidity-核心知识点（优先级从高到低）" class="headerlink" title="1. Solidity 核心知识点（优先级从高到低）"></a>1. Solidity 核心知识点（优先级从高到低）</h3><p>| 知识点                | 为什么重要（DVD 场景）| 学习资源                                                                 |<br>| ERC20 代币标准        | DVD 绝大多数挑战基于 ERC20（比如你遇到的 DVT 代币） | <a target="_blank" rel="noopener" href="https://docs.openzeppelin.com/contracts/4.x/erc20">https://docs.openzeppelin.com/contracts/4.x/erc20</a>                        |<br>| 函数可见性（<code>external</code>&#x2F;<code>public</code>） | 漏洞合约的核心函数（如 flashLoan）都是 external   | <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/en/latest/contracts.html#function-visibility">https://docs.soliditylang.org/en/latest/contracts.html#function-visibility</a> |<br>| 事件（<code>event</code>）| 测试中大量通过事件验证结果（如 FlashLoanStatus） | <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/en/latest/contracts.html#events">https://docs.soliditylang.org/en/latest/contracts.html#events</a>            |<br>| 回滚机制（<code>require</code>&#x2F;<code>assert</code>） | 漏洞的核心（比如触发 assert 使合约失效）| <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/en/latest/control-structures.html#error-handling">https://docs.soliditylang.org/en/latest/control-structures.html#error-handling</a> |<br>| 回调函数（如 <code>onFlashLoan</code>） | 闪电贷、DEX 等场景的核心逻辑                     | 先理解“钩子函数”概念，再看 ERC3156 闪电贷标准                             |</p>
<h3 id="2-DeFi-基础概念（不用深钻，先懂名词）"><a href="#2-DeFi-基础概念（不用深钻，先懂名词）" class="headerlink" title="2. DeFi 基础概念（不用深钻，先懂名词）"></a>2. DeFi 基础概念（不用深钻，先懂名词）</h3><p>DVD 是 DeFi 漏洞练习，先搞懂这些核心名词，才能理解测试的目的：</p>
<p>| 名词          | 简单解释（对应 DVD 挑战）| 入门理解程度                  |<br>| 闪电贷（FlashLoan） | 无抵押、必须即时归还的贷款（Unstoppable 挑战核心） | 知道“借→用→还”必须在一笔交易内完成 |<br>| 借贷池（Lending Pool） | 存放资金供用户借贷的合约（如 UnstoppableVault） | 知道池的余额是核心校验点        |<br>| ERC20 余额校验 | <code>balanceOf(address)</code> 读取合约持有的代币数量    | 知道外部转账会改变合约余额      |<br>| 事件监听       | 通过事件判断合约执行结果（如 success&#x3D;true&#x2F;false） | 知道事件是“日志”，测试用来验证结果 |</p>
<h2 id="四、第三阶段：手把手拆解-DVD-的-Unstoppable-t-sol（落地练习）"><a href="#四、第三阶段：手把手拆解-DVD-的-Unstoppable-t-sol（落地练习）" class="headerlink" title="四、第三阶段：手把手拆解 DVD 的 Unstoppable.t.sol（落地练习）"></a>四、第三阶段：手把手拆解 DVD 的 Unstoppable.t.sol（落地练习）</h2><p>以你遇到的 <code>Unstoppable.t.sol</code> 为例，按“拆步骤→对应知识点”的方式分析，帮你建立“看测试文件”的思维：</p>
<h3 id="步骤-1：先看测试合约的结构（Foundry-基础）"><a href="#步骤-1：先看测试合约的结构（Foundry-基础）" class="headerlink" title="步骤 1：先看测试合约的结构（Foundry 基础）"></a>步骤 1：先看测试合约的结构（Foundry 基础）</h3><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs solidity">contract UnstoppableChallenge is Test &#123;<br>    // 1. 定义合约/地址变量（对应 Foundry 测试的变量声明）<br>    address public deployer = makeAddr(&quot;deployer&quot;);<br>    address public player = makeAddr(&quot;player&quot;);<br>    UnstoppableVault public vault;<br>    UnstoppableMonitor public monitor;<br>    DamnValuableToken public dvt;<br><br>    // 2. setUp 函数：部署所有合约（Foundry 测试的初始化）<br>    function setUp() public &#123;<br>        // 部署代币、Vault、Monitor 合约（对应 DeFi 合约部署）<br>        vm.prank(deployer);<br>        dvt = new DamnValuableToken();<br><br>        vm.prank(deployer);<br>        vault = new UnstoppableVault(dvt);<br><br>        // 给 Vault 充钱（模拟 DeFi 资金池）<br>        vm.prank(deployer);<br>        dvt.approve(address(vault), 1000000 ether);<br>        vm.prank(deployer);<br>        vault.deposit(1000000 ether);<br><br>        vm.prank(deployer);<br>        monitor = new UnstoppableMonitor(vault, dvt, deployer);<br>    &#125;<br><br>    // 3. 测试用例 1：验证初始状态（基础断言）<br>    function test_assertInitialState() public &#123;<br>        assertEq(dvt.balanceOf(address(vault)), 1000000 ether);<br>        assertEq(vault.totalAssets(), 1000000 ether);<br>    &#125;<br><br>    // 4. 测试用例 2：核心挑战（漏洞利用）<br>    function test_unstoppable() public &#123;<br>        // 这里是你需要写漏洞利用代码的地方！<br>        // 比如：玩家直接转账代币到 Vault，破坏余额校验<br><br>        // 预期触发 FlashLoanStatus(false)（事件监听）<br>        vm.expectEmit(true, true, true, true);<br>        emit FlashLoanStatus(false);<br>        // 调用闪电贷，预期失败<br>        monitor.checkFlashLoan(100 ether);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h3 id="步骤-2：对应知识点拆解（你看不懂的地方）"><a href="#步骤-2：对应知识点拆解（你看不懂的地方）" class="headerlink" title="步骤 2：对应知识点拆解（你看不懂的地方）"></a>步骤 2：对应知识点拆解（你看不懂的地方）</h3><p>| 代码片段                | 对应知识点                | 解释                                                                 |<br>| <code>makeAddr(&quot;player&quot;)</code>    | Foundry 地址生成          | 快速创建测试用的虚拟地址，不用手动输 0x…                            |<br>| <code>setUp()</code>               | Foundry 测试初始化        | 所有测试用例执行前先跑这个函数，部署合约、初始化状态                  |<br>| <code>vm.expectEmit()</code>       | Foundry 事件监听          | 预期接下来的操作会触发指定事件，参数不匹配就会失败（你遇到的问题）|<br>| <code>monitor.checkFlashLoan()</code> | DeFi 闪电贷逻辑          | 调用监控合约的闪电贷检查函数，本质是触发 Vault 的 flashLoan 函数      |</p>
<h2 id="五、学习路径建议（新手友好）"><a href="#五、学习路径建议（新手友好）" class="headerlink" title="五、学习路径建议（新手友好）"></a>五、学习路径建议（新手友好）</h2><ol>
<li><strong>先花 1-2 天吃透 Foundry 基础</strong>：<ul>
<li>跟着官方文档写 3-5 个简单测试（比如 ERC20 转账、权限验证）；</li>
<li>重点练 <code>prank</code>&#x2F;<code>expectEmit</code>&#x2F;<code>expectRevert</code> 这 3 个作弊码。</li>
</ul>
</li>
<li><strong>补 Solidity 核心（2-3 天）</strong>：<ul>
<li>重点看 ERC20、函数可见性、事件、回滚机制；</li>
<li>不用学太复杂的（比如组装器、内联汇编），先懂基础语法。</li>
</ul>
</li>
<li><strong>拆解 DVD 的简单挑战（从 Unstoppable 开始）</strong>：<ul>
<li>先看 <code>src/unstoppable/</code> 下的合约（UnstoppableVault.sol），找漏洞点（比如 <code>balanceOf</code> 校验）；</li>
<li>再看测试文件，逐行注释每个代码的作用；</li>
<li>尝试修改测试代码，比如添加 <code>player</code> 转账代币到 Vault，跑测试看是否通过。</li>
</ul>
</li>
<li><strong>进阶：看 DVD 官方题解（如果卡壳）</strong>：<ul>
<li>DVD 有社区题解（比如 GitHub 上的 writeup），看不懂时可以参考，但先自己试；</li>
<li>重点看“漏洞利用代码”是怎么写的，对应 Foundry 哪个知识点。</li>
</ul>
</li>
</ol>
<h3 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h3><p>你看不懂 DVD 的 <code>.t.sol</code>，核心是缺 <strong>Foundry 测试框架的核心用法</strong> 和 <strong>Solidity&#x2F;DeFi 基础</strong>，按以下优先级补充即可：</p>
<ol>
<li>先掌握 Foundry 的 <code>vm</code> 作弊码（<code>prank</code>&#x2F;<code>expectEmit</code>&#x2F;<code>expectRevert</code>）和测试结构；</li>
<li>理解 Solidity 事件、回滚机制和 ERC20 基础；</li>
<li>从最简单的 Unstoppable 挑战入手，逐行拆解测试文件，把“代码→知识点”对应起来。</li>
</ol>
<p>不用急于求成，先把 Unstoppable 这一个挑战的测试文件看懂、改通，再去看其他挑战，你会发现逻辑都是相通的。如果某一行代码看不懂，比如 <code>vm.expectEmit</code> 的参数怎么配，就针对性查 Foundry 文档，聚焦“解决当前问题”，而不是一次性学完所有知识。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>mermaid图标说明文档 <a target="_blank" rel="noopener" href="https://mermaid.js.org/syntax/flowchart.html">https://mermaid.js.org/syntax/flowchart.html</a></li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Web3/">Web3</a>
                    
                      <a class="hover-with-bg" href="/tags/audit/">audit</a>
                    
                  </div>
                
              </div>
              
                
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/12/19/59195.html">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">foundry</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/12/18/60865.html">
                        <span class="hidden-mobile">Mermaid</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


            

                
                  <a id="scroll-top-button" href="#" role="button">
                    <i class="iconfont icon-arrowup" aria-hidden="true"></i>
                  </a>
                  

                    

                          
      </main>

      <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://whale3070.github.io/" target="_blank" rel="nofollow noopener"><span>Whale3070</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->




  



  <script  src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js" ></script>





  <script  src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


<link href="/pagefind/pagefind-ui.css" rel="stylesheet">
  <script src="/pagefind/pagefind-ui.js"></script>
  <style>
    /* 搜索框配色适配 */
    #search { margin-top: 2rem; }
    [data-user-color-scheme='dark'] .pagefind-ui {
      --pagefind-ui-primary: #eeeeee;
      --pagefind-ui-text: #eeeeee;
      --pagefind-ui-background: #151515;
      --pagefind-ui-border: #333;
    }
  </style>
    </body>

  </html>