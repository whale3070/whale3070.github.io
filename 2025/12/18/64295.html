

  <!DOCTYPE html>
  <html lang="zh-CN" data-default-color-scheme=&#34;dark&#34; >
  <style>
    .text1
    {
    text-shadow: 0px 0px 2px #f2f3f2;
    }
    </style>

  <script>
    // 强制内网 IP 识别为安全上下文
    if (window.location.hostname !== 'localhost' && window.location.protocol === 'http:') {
        // 尝试手动映射 crypto 属性
        if (!window.crypto.subtle && window.crypto.webkitSubtle) {
            window.crypto.subtle = window.crypto.webkitSubtle;
        }
    }
    
    // 终极补丁：如果还是没有 subtle，则创建一个占位符避免报错
    // 提示：这通常能解决加载报错，但如果插件强依赖原生加密，建议执行下面的“降级”预判
    if (!window.isSecureContext) {
        console.warn('当前环境非安全上下文，正在尝试兼容内网加密解密...');
    }
</script>


<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/null">
  <link rel="icon" type="image/png" href="/null">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  <title>slither3 - whale3070&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.4.0/styles/github-gist.min.css" />
    
  

  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"192.168.126.129","root":"/","version":"1.8.7","typing":{"enable":false,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":false,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 7.3.0"></head>


    <body>
      <header style="height: 70vh;">
        <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>InfoSec learning</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/search/">
                <i class="iconfont icon-search"></i>
                搜索
              </a>
            </li>
          
        
        
        
          
        
      </ul>
    </div>
  </div>
</nav>

          <div class="banner" id="banner" false
            style="background: url('/img/default.png') no-repeat center center;
              background-size: cover;">
              <div class="full-bg-img">
                <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
                  <div class="page-header text-center fade-in-up">
                    <span class="h2 text1" id="subtitle" title="slither3">
                      
                        slither3
                      
                    </span>
        
                    
                      <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2025-12-18 05:24" pubdate>
        2025年12月18日 凌晨
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      4.5k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      49
       分钟
    </span>
  

  
  
</div>

                    
                  </div>
                    
                  </div>
                  
                </div>
              </div>
          </div>
      </header>

      <main>
        
          

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" data-pagefind-body>
            <!-- SEO header -->
            <h1 style="display: none">slither3</h1>
            
            <div class="markdown-body">
              <p><a target="_blank" rel="noopener" href="http://192.168.5.1:40080/2025/12/17/687a3b9bfc79/">slither</a></p>
<p><a target="_blank" rel="noopener" href="http://192.168.5.1:40080/2025/12/17/9ee62a18d00d/">slither2</a></p>
<p>之前学到了slither是python开发的安全审计工具，并且无法识别unstoppable这种业务逻辑漏洞。</p>
<h1 id="我现在想要分析slither源码，该从哪里开始"><a href="#我现在想要分析slither源码，该从哪里开始" class="headerlink" title="我现在想要分析slither源码，该从哪里开始"></a>我现在想要分析slither源码，该从哪里开始</h1><p>要分析 <strong>Slither</strong> 的源码，可以从以下几个方面开始：</p>
<h3 id="1-了解-Slither-的基本功能和结构"><a href="#1-了解-Slither-的基本功能和结构" class="headerlink" title="1. 了解 Slither 的基本功能和结构"></a>1. <strong>了解 Slither 的基本功能和结构</strong></h3><p><strong>Slither</strong> 是一个开源的智能合约静态分析工具，专门用于检查 Solidity 合约中的潜在安全漏洞。分析 Slither 源码的第一步是了解它的主要功能和架构。Slither 通过分析 Solidity 合约，识别出可能的安全漏洞和不良实践。</p>
<h4 id="主要功能："><a href="#主要功能：" class="headerlink" title="主要功能："></a><strong>主要功能：</strong></h4><ul>
<li>检测常见的 Solidity 漏洞，例如重入攻击、整数溢出、访问控制问题等。</li>
<li>提供易于理解的报告和修复建议。</li>
<li>提供 API 和命令行工具，方便集成到 CI&#x2F;CD 流程中。</li>
</ul>
<h4 id="Slither-的架构："><a href="#Slither-的架构：" class="headerlink" title="Slither 的架构："></a><strong>Slither 的架构：</strong></h4><p>Slither 的源代码主要包括以下部分：</p>
<ul>
<li><strong>分析模块</strong>：实现静态分析和检查合约的各个方面。</li>
<li><strong>检查器（Checkers）</strong>：定义了各种检查规则，用于分析 Solidity 合约的特定部分。</li>
<li><strong>报告生成器</strong>：生成漏洞报告并输出到命令行或文件中。</li>
<li><strong>CLI 工具</strong>：允许用户通过命令行界面运行 Slither 并分析 Solidity 合约。</li>
</ul>
<h3 id="2-获取-Slither-的源代码"><a href="#2-获取-Slither-的源代码" class="headerlink" title="2. 获取 Slither 的源代码"></a>2. <strong>获取 Slither 的源代码</strong></h3><p>首先，你需要获取 Slither 的源代码。你可以从 GitHub 仓库中克隆 Slither 源码：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/TrailOfBits/slither.git<br><span class="hljs-built_in">cd</span> slither<br></code></pre></div></td></tr></table></figure>

<h3 id="3-熟悉-Slither-的核心模块"><a href="#3-熟悉-Slither-的核心模块" class="headerlink" title="3. 熟悉 Slither 的核心模块"></a>3. <strong>熟悉 Slither 的核心模块</strong></h3><p>Slither 的源码分布在多个模块中，理解以下几个关键模块有助于你快速入门：</p>
<ul>
<li><strong><code>slither/core/</code></strong>：这个目录包含 Slither 核心的分析逻辑，涉及合约的静态分析。</li>
<li><strong><code>slither/checkers/</code></strong>：这个目录包含了 Slither 的检查器（Checkers），每个检查器负责检查一种特定的潜在漏洞或安全问题。你可以查看这些检查器来了解 Slither 如何检测不同类型的漏洞。</li>
<li><strong><code>slither/cli/</code></strong>：这个目录包含 Slither 的命令行工具实现，允许你通过命令行运行 Slither 分析合约。</li>
<li><strong><code>slither/reporters/</code></strong>：用于生成并输出分析报告的模块，通常会输出 JSON 格式的结果。</li>
</ul>
<h3 id="4-分析主要功能实现"><a href="#4-分析主要功能实现" class="headerlink" title="4. 分析主要功能实现"></a>4. <strong>分析主要功能实现</strong></h3><p>Slither 的核心功能实现主要集中在几个文件中，以下是你可以重点分析的部分：</p>
<ul>
<li><p><strong><code>slither/core/slither.py</code></strong>：这是 Slither 的入口点，包含了启动分析的主要逻辑。它负责加载合约文件，运行分析，调用检查器等。</p>
</li>
<li><p><strong><code>slither/checkers/</code></strong>：这个目录中每个文件代表一种检查器，用于分析 Solidity 合约的不同方面，例如：</p>
<ul>
<li><strong><code>reentrancy.py</code></strong>：检测重入攻击的检查器。</li>
<li><strong><code>uninitialized-storage.py</code></strong>：检查未初始化的存储变量。</li>
<li><strong><code>integer-overflow.py</code></strong>：检查整数溢出漏洞。</li>
</ul>
<p>阅读这些文件，可以帮助你了解 Slither 如何分析合约的特定安全问题。</p>
</li>
<li><p><strong><code>slither/reporters/</code></strong>：这个目录包含了生成报告的代码，分析报告如何格式化并输出到终端或文件中。</p>
</li>
</ul>
<h3 id="5-阅读文档和注释"><a href="#5-阅读文档和注释" class="headerlink" title="5. 阅读文档和注释"></a>5. <strong>阅读文档和注释</strong></h3><p>在代码中找到你感兴趣的部分后，仔细阅读代码中的文档和注释。Slither 的开发者提供了大量的注释来帮助理解每个模块的功能和实现逻辑。</p>
<h3 id="6-运行-Slither-并调试"><a href="#6-运行-Slither-并调试" class="headerlink" title="6. 运行 Slither 并调试"></a>6. <strong>运行 Slither 并调试</strong></h3><p>在你分析代码的同时，可以通过运行 Slither 来测试代码的实际行为。你可以通过以下命令来分析 Solidity 合约：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">slither &lt;your-contract.sol&gt;<br></code></pre></div></td></tr></table></figure>

<p>你可以使用 <code>--debug</code> 标志来启用调试输出，这样你可以看到 Slither 在分析合约时的详细信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">slither &lt;your-contract.sol&gt; --debug<br></code></pre></div></td></tr></table></figure>

<h3 id="7-查阅-Slither-的测试用例"><a href="#7-查阅-Slither-的测试用例" class="headerlink" title="7. 查阅 Slither 的测试用例"></a>7. <strong>查阅 Slither 的测试用例</strong></h3><p>Slither 提供了一些测试用例，帮助你理解它的分析功能如何工作。这些测试通常位于 <code>slither/tests/</code> 目录下。你可以查看这些测试文件来了解 Slither 在不同场景下如何分析 Solidity 合约。</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> slither/tests<br></code></pre></div></td></tr></table></figure>

<p>查看测试文件，理解每个测试的用意，并尝试修改或扩展它们，以便深入理解 Slither 的行为。</p>
<h3 id="8-了解-Slither-的插件系统"><a href="#8-了解-Slither-的插件系统" class="headerlink" title="8. 了解 Slither 的插件系统"></a>8. <strong>了解 Slither 的插件系统</strong></h3><p>Slither 还支持插件系统，如果你有兴趣扩展它的功能，可以查看如何编写自己的插件。插件系统的代码可以在 <code>slither/plugins/</code> 目录下找到。</p>
<h3 id="9-贡献与扩展"><a href="#9-贡献与扩展" class="headerlink" title="9. 贡献与扩展"></a>9. <strong>贡献与扩展</strong></h3><p>Slither 是一个开源项目，如果你希望为其贡献代码或扩展功能，可以按照以下步骤进行：</p>
<ul>
<li>阅读 <strong>贡献指南</strong>：了解如何向 Slither 提交代码和修复漏洞。</li>
<li>分析 <strong>Issue 列表</strong>：看看是否有你感兴趣的问题或功能需求。</li>
</ul>
<p>你可以在 GitHub 上找到 Slither 的问题跟踪器和贡献指南：<a target="_blank" rel="noopener" href="https://github.com/TrailOfBits/slither">Slither GitHub</a></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>要分析 <strong>Slither</strong> 的源码，建议从以下几个方面入手：</p>
<ol>
<li>获取并克隆 Slither 的 GitHub 仓库。</li>
<li>熟悉 Slither 的核心模块，特别是 <code>slither/core/</code> 和 <code>slither/checkers/</code> 目录。</li>
<li>阅读代码中的注释和文档，了解每个模块的功能。</li>
<li>运行 Slither，调试并查看它如何分析 Solidity 合约。</li>
<li>查阅 Slither 的测试用例，了解其如何工作。</li>
<li>如果需要，扩展 Slither 功能或为其贡献代码。</li>
</ol>
<p>通过以上步骤，你可以深入理解 Slither 的工作原理，并根据需要进行定制化修改或贡献代码。如果有其他问题或需要帮助的地方，随时告诉我！</p>
<h1 id="分析一下main-py"><a href="#分析一下main-py" class="headerlink" title="分析一下main.py"></a>分析一下main.py</h1><p>该文件是一个用于运行 <strong>Slither</strong> 静态分析工具的主程序，它负责解析命令行参数、初始化分析流程、运行检测器和打印机，并将分析结果输出。以下是代码结构和功能的详细分析：</p>
<h3 id="1-导入和初始化"><a href="#1-导入和初始化" class="headerlink" title="1. 导入和初始化"></a>1. <strong>导入和初始化</strong></h3><p>在程序开始时，导入了大量的模块和库：</p>
<ul>
<li><strong><code>argparse</code></strong>：用于处理命令行参数。</li>
<li><strong><code>logging</code></strong>：设置日志记录，便于调试和输出信息。</li>
<li><strong><code>crytic_compile</code></strong>：用于编译 Solidity 合约。</li>
<li><strong><code>slither</code></strong>：用于静态分析，包括检测器和打印机。</li>
<li><strong><code>json</code>、<code>glob</code>、<code>os</code></strong> 等：用于文件操作、输出格式和系统级操作。</li>
</ul>
<p>日志记录器（<code>logger</code>）初始化为 <strong>Slither</strong>，并用于跟踪执行过程中的信息、错误和警告。</p>
<h3 id="2-process-single-函数"><a href="#2-process-single-函数" class="headerlink" title="2. process_single 函数"></a>2. <strong><code>process_single</code> 函数</strong></h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_single</span>(<span class="hljs-params"></span><br><span class="hljs-params">    target: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, CryticCompile],</span><br><span class="hljs-params">    args: argparse.Namespace,</span><br><span class="hljs-params">    detector_classes: <span class="hljs-type">List</span>[<span class="hljs-type">Type</span>[AbstractDetector]],</span><br><span class="hljs-params">    printer_classes: <span class="hljs-type">List</span>[<span class="hljs-type">Type</span>[AbstractPrinter]],</span><br><span class="hljs-params"></span>) -&gt; <span class="hljs-type">Tuple</span>[Slither, <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>], <span class="hljs-type">List</span>[Output], <span class="hljs-built_in">int</span>]:<br></code></pre></div></td></tr></table></figure>

<ul>
<li><strong>功能</strong>：此函数用于处理单个目标（一个 Solidity 文件或一个 CryticCompile 对象）。它会初始化一个 <code>Slither</code> 实例，注册检测器和打印机，并运行相关分析。</li>
<li><strong>返回值</strong>：返回一个包含 Slither 实例、检测器结果、打印机结果和分析的合约数量的元组。</li>
</ul>
<h3 id="3-process-all-函数"><a href="#3-process-all-函数" class="headerlink" title="3. process_all 函数"></a>3. <strong><code>process_all</code> 函数</strong></h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_all</span>(<span class="hljs-params"></span><br><span class="hljs-params">    target: <span class="hljs-built_in">str</span>,</span><br><span class="hljs-params">    args: argparse.Namespace,</span><br><span class="hljs-params">    detector_classes: <span class="hljs-type">List</span>[<span class="hljs-type">Type</span>[AbstractDetector]],</span><br><span class="hljs-params">    printer_classes: <span class="hljs-type">List</span>[<span class="hljs-type">Type</span>[AbstractPrinter]],</span><br><span class="hljs-params"></span>) -&gt; <span class="hljs-type">Tuple</span>[<span class="hljs-type">List</span>[Slither], <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>], <span class="hljs-type">List</span>[Output], <span class="hljs-built_in">int</span>]:<br></code></pre></div></td></tr></table></figure>

<ul>
<li><strong>功能</strong>：该函数处理多个目标（如多个文件或合约）。它使用 <code>process_single</code> 处理每个目标，并收集所有结果。</li>
<li><strong>返回值</strong>：返回多个 <code>Slither</code> 实例、所有检测器和打印机的结果，以及分析的合约数量。</li>
</ul>
<h3 id="4-process-函数"><a href="#4-process-函数" class="headerlink" title="4. _process 函数"></a>4. <strong><code>_process</code> 函数</strong></h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_process</span>(<span class="hljs-params"></span><br><span class="hljs-params">    slither: Slither,</span><br><span class="hljs-params">    detector_classes: <span class="hljs-type">List</span>[<span class="hljs-type">Type</span>[AbstractDetector]],</span><br><span class="hljs-params">    printer_classes: <span class="hljs-type">List</span>[<span class="hljs-type">Type</span>[AbstractPrinter]],</span><br><span class="hljs-params"></span>) -&gt; <span class="hljs-type">Tuple</span>[Slither, <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>], <span class="hljs-type">List</span>[Output], <span class="hljs-built_in">int</span>]:<br></code></pre></div></td></tr></table></figure>

<ul>
<li><p><strong>功能</strong>：该函数是核心分析函数，负责为给定的 <code>Slither</code> 实例注册检测器和打印机，运行检测器，收集检测结果和打印结果。</p>
</li>
<li><p><strong>步骤</strong>：</p>
<ol>
<li>注册检测器和打印机。</li>
<li>根据是否有打印机，选择运行检测器或打印机。</li>
<li>收集检测器和打印机的结果。</li>
</ol>
</li>
</ul>
<h3 id="5-检测器和打印机的选择"><a href="#5-检测器和打印机的选择" class="headerlink" title="5. 检测器和打印机的选择"></a>5. <strong>检测器和打印机的选择</strong></h3><ul>
<li><strong><code>get_detectors_and_printers</code></strong>：获取所有可用的检测器和打印机，并支持插件功能。通过 <code>entry_points</code> 加载额外的插件检测器和打印机。</li>
<li><strong><code>choose_detectors</code></strong> 和 <strong><code>choose_printers</code></strong>：根据命令行参数选择要运行的检测器和打印机。支持包括和排除特定的检测器或打印机。</li>
</ul>
<h3 id="6-命令行参数解析"><a href="#6-命令行参数解析" class="headerlink" title="6. 命令行参数解析"></a>6. <strong>命令行参数解析</strong></h3><p><strong><code>parse_args</code></strong> 函数解析命令行参数，生成 <code>argparse.Namespace</code> 对象。它处理检测器、打印机、输出格式、路径过滤等选项。</p>
<ul>
<li><strong><code>--detect</code></strong>、<strong><code>--print</code></strong>：指定要运行的检测器和打印机。</li>
<li><strong><code>--json</code></strong>、<strong><code>--sarif</code></strong>：控制输出的格式（如 JSON、SARIF）。</li>
<li><strong><code>--fail-*</code></strong>：控制在检测到特定级别的漏洞时是否退出。</li>
<li><strong><code>--checklist</code></strong>：生成 Markdown 格式的检查列表。</li>
</ul>
<h3 id="7-分析和输出"><a href="#7-分析和输出" class="headerlink" title="7. 分析和输出"></a>7. <strong>分析和输出</strong></h3><ul>
<li><strong><code>StandardOutputCapture</code></strong>：用于捕获标准输出，以便生成 JSON 或 SARIF 格式的报告。</li>
<li><strong><code>output_to_json</code>、<code>output_to_sarif</code></strong>：将检测结果输出为 JSON 或 SARIF 格式，支持输出到文件或标准输出。</li>
<li><strong><code>output_to_markdown</code>、<code>output_wiki</code></strong>：将检测结果输出为 Markdown 或 Wiki 格式，便于进一步阅读和分享。</li>
</ul>
<h3 id="8-性能分析"><a href="#8-性能分析" class="headerlink" title="8. 性能分析"></a>8. <strong>性能分析</strong></h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">if</span> args.perf:<br>    cp = cProfile.Profile()<br>    cp.enable()<br></code></pre></div></td></tr></table></figure>

<ul>
<li>如果启用了 <code>--perf</code> 选项，使用 Python 的 <code>cProfile</code> 模块来跟踪和分析性能，最后打印性能统计数据。</li>
</ul>
<h3 id="9-错误处理"><a href="#9-错误处理" class="headerlink" title="9. 错误处理"></a>9. <strong>错误处理</strong></h3><p>在执行过程中，如果发生 <code>SlitherException</code>，会捕获并输出错误信息，并建议报告给 Slither 的 GitHub 仓库。</p>
<h3 id="10-主程序执行"><a href="#10-主程序执行" class="headerlink" title="10. 主程序执行"></a>10. <strong>主程序执行</strong></h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></div></td></tr></table></figure>

<p>主程序调用 <code>main()</code> 函数，启动整个 Slither 静态分析过程。</p>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>该脚本是 <strong>Slither</strong> 静态分析工具的主程序，负责：</p>
<ul>
<li>解析命令行参数。</li>
<li>初始化分析过程，选择并运行检测器和打印机。</li>
<li>输出检测结果，支持多种格式（JSON、SARIF、Markdown等）。</li>
<li>通过插件系统扩展检测器和打印机。</li>
<li>支持性能分析。</li>
</ul>
<p>它的核心任务是将目标合约（或文件）传递给 Slither 进行静态分析，并根据命令行参数生成相应的报告。</p>
<p>如果你需要对特定部分有更多的了解，或者想进一步分析其中的某个功能模块，请告诉我！</p>
<h1 id="分析一下core文件夹下的slither-core"><a href="#分析一下core文件夹下的slither-core" class="headerlink" title="分析一下core文件夹下的slither_core"></a>分析一下core文件夹下的slither_core</h1><p>分析 <strong>SlitherCore</strong> 类的源码时，我们可以从几个关键部分来逐步理解它的功能和实现。这段代码实现了 <strong>SlitherCore</strong> 类，它是 <strong>Slither</strong> 静态分析工具的核心部分，负责管理合约解析、分析及存储相关的数据。</p>
<h3 id="1-类概述"><a href="#1-类概述" class="headerlink" title="1. 类概述"></a>1. <strong>类概述</strong></h3><p><code>SlitherCore</code> 类继承自 <code>Context</code>，它是 Slither 静态分析的核心部分。主要功能包括：</p>
<ul>
<li>合约的加载、存储和分析。</li>
<li>支持通过不同的配置选项过滤和排除结果。</li>
<li>进行多次编译分析。</li>
<li>支持报告生成，并与其他工具（如 SARIF 格式）集成。</li>
</ul>
<h3 id="2-初始化和属性"><a href="#2-初始化和属性" class="headerlink" title="2. 初始化和属性"></a>2. <strong>初始化和属性</strong></h3><p>在 <code>__init__</code> 方法中，初始化了许多与分析相关的属性，例如：</p>
<ul>
<li><strong><code>_filename</code></strong>：存储当前文件名。</li>
<li><strong><code>_raw_source_code</code></strong>：用于存储源代码的字典。</li>
<li><strong><code>_contracts</code></strong> 和 <strong><code>_contracts_derived</code></strong>：分别存储原始合约和派生合约。</li>
<li><strong><code>_compilation_units</code></strong>：存储编译单元的列表。</li>
<li><strong><code>_previous_results</code></strong> 和 <strong><code>_previous_results_ids</code></strong>：存储之前的分析结果和它们的 ID。</li>
</ul>
<p>这些属性帮助管理不同合约、编译单元和结果，确保多次分析的高效执行。</p>
<h3 id="3-方法和功能"><a href="#3-方法和功能" class="headerlink" title="3. 方法和功能"></a>3. <strong>方法和功能</strong></h3><ul>
<li><strong><code>add_compilation_unit</code></strong>：向 <code>SlitherCore</code> 中添加一个新的编译单元（<code>SlitherCompilationUnit</code>）。</li>
<li><strong><code>contracts</code></strong> 和 <strong><code>contracts_derived</code></strong>：通过懒加载（lazy loading）方式获取合约和派生合约列表，确保只在需要时加载这些合约。</li>
<li><strong><code>get_contract_from_name</code></strong>：根据合约名称查找对应的合约实例。</li>
<li><strong><code>source_code</code></strong> 和 <strong><code>filename</code></strong>：获取源代码和当前文件名，支持动态修改文件名。</li>
<li><strong><code>add_source_code</code></strong>：加载源代码，支持从文件或通过 <code>CryticCompile</code> 获取源代码。</li>
</ul>
<h3 id="4-源代码映射"><a href="#4-源代码映射" class="headerlink" title="4. 源代码映射"></a>4. <strong>源代码映射</strong></h3><p>Slither 需要通过源代码映射来关联合约代码和源文件的位置。<code>_compute_offsets_from_thing</code> 和 <code>_compute_offsets_to_ref_impl_decl</code> 是用于计算和存储源代码偏移量（<code>offsets</code>）的方法。它们处理了合约、函数、变量等在源代码中的位置，确保分析器能够正确地关联代码和检测的漏洞。</p>
<ul>
<li><strong><code>_offset_to_min_offset</code></strong>：存储最小偏移量。</li>
<li><strong><code>_offset_to_objects</code></strong>、<strong><code>_offset_to_definitions</code></strong>、<strong><code>_offset_to_implementations</code></strong>：分别存储源代码中的对象、定义和实现。</li>
</ul>
<p>这些映射有助于 Slither 跟踪合约中的每个元素，确保分析和检测漏洞时能够正确定位到源码中的具体行。</p>
<h3 id="5-过滤和忽略结果"><a href="#5-过滤和忽略结果" class="headerlink" title="5. 过滤和忽略结果"></a>5. <strong>过滤和忽略结果</strong></h3><p><code>SlitherCore</code> 类还具有多种结果过滤和忽略的功能：</p>
<ul>
<li><strong><code>parse_ignore_comments</code></strong>：解析源代码中的 <code>slither-disable-start</code> 和 <code>slither-disable-end</code> 注释，这些注释用于指示哪些检查需要被跳过。</li>
<li><strong><code>has_ignore_comment</code></strong>：检查结果是否在被忽略的范围内。</li>
<li><strong><code>valid_result</code></strong>：验证分析结果是否有效。如果结果被忽略或是重复的，它会被排除在外。</li>
</ul>
<p>此外，<code>SlitherCore</code> 还支持保存和加载之前的分析结果，以便进行增量分析。</p>
<h3 id="6-依赖和补丁生成"><a href="#6-依赖和补丁生成" class="headerlink" title="6. 依赖和补丁生成"></a>6. <strong>依赖和补丁生成</strong></h3><ul>
<li><strong><code>generate_patches</code></strong>：如果启用，它会生成修复补丁。</li>
<li><strong><code>skip_data_dependency</code></strong> 和 <strong><code>disallow_partial</code></strong>：用于控制是否跳过某些数据依赖项，或者是否允许部分分析。</li>
</ul>
<h3 id="7-与-CryticCompile-的集成"><a href="#7-与-CryticCompile-的集成" class="headerlink" title="7. 与 CryticCompile 的集成"></a>7. <strong>与 <code>CryticCompile</code> 的集成</strong></h3><p><code>SlitherCore</code> 依赖于 <code>CryticCompile</code> 来处理 Solidity 合约的编译和解析。它通过 <code>crytic_compile</code> 属性访问相关功能，并在 <code>add_source_code</code> 中加载源代码。</p>
<h3 id="8-结果处理和存储"><a href="#8-结果处理和存储" class="headerlink" title="8. 结果处理和存储"></a>8. <strong>结果处理和存储</strong></h3><ul>
<li><strong><code>load_previous_results</code></strong>：加载之前的分析结果，支持从 SARIF 格式的报告中读取结果。</li>
<li><strong><code>write_results_to_hide</code></strong> 和 <strong><code>save_results_to_hide</code></strong>：用于存储需要隐藏的分析结果。</li>
</ul>
<h3 id="9-总结"><a href="#9-总结" class="headerlink" title="9. 总结"></a>9. <strong>总结</strong></h3><p><code>SlitherCore</code> 类在 Slither 静态分析工具中扮演着至关重要的角色，负责管理合约的分析、结果的过滤和报告的生成。它通过将合约、函数、变量等源代码元素与偏移量关联，确保能够正确分析并报告潜在的安全漏洞。该类还支持多次分析、增量分析和结果过滤，是 Slither 核心功能的基础。</p>
<p>如果你有特定的问题或者需要深入了解某个部分的实现，可以进一步提问！</p>
<h1 id="分析一下slither-py"><a href="#分析一下slither-py" class="headerlink" title="分析一下slither.py"></a>分析一下slither.py</h1><p>这段代码定义了 <strong>Slither</strong> 类，它是 <strong>Slither</strong> 静态分析工具的核心组件，继承自 <code>SlitherCore</code>，并提供了一些与目标分析、检测器、打印机以及其它分析任务相关的功能。以下是对代码的详细分析：</p>
<h3 id="1-Slither-类概述"><a href="#1-Slither-类概述" class="headerlink" title="1. Slither 类概述"></a>1. <strong><code>Slither</code> 类概述</strong></h3><p><code>Slither</code> 类的主要任务是管理和执行静态分析任务。它通过使用不同的 <strong>检测器（detectors）</strong> 和 <strong>打印机（printers）</strong> 来分析合约代码并生成报告。类中的方法和属性涉及合约的编译、源代码的解析、检测漏洞、输出报告等。</p>
<h3 id="2-初始化和属性-1"><a href="#2-初始化和属性-1" class="headerlink" title="2. 初始化和属性"></a>2. <strong>初始化和属性</strong></h3><p><code>Slither</code> 类的构造函数 <code>__init__</code> 中，初始化了许多关键参数和属性，支持灵活配置和定制分析过程：</p>
<ul>
<li><strong><code>target</code></strong>：分析目标，可以是一个文件路径或 <code>CryticCompile</code> 对象。</li>
<li><strong><code>disallow_partial</code></strong>：是否禁止部分分析。</li>
<li><strong><code>skip_assembly</code></strong>：是否跳过汇编代码分析。</li>
<li><strong><code>show_ignored_findings</code></strong>：是否显示被忽略的漏洞。</li>
<li><strong><code>line_prefix</code></strong>：控制显示源代码时的行前缀（例如 <code>file.sol#1</code>）。</li>
<li><strong><code>codex_enabled</code></strong>：是否启用 Codex 相关功能，用于与 OpenAI Codex 集成。</li>
<li><strong><code>no_fail</code></strong>：如果设置为 <code>True</code>，在分析失败时不会抛出异常。</li>
<li><strong><code>_parsers</code></strong>：用于存储合约的解析器，支持 Solidity 和 Vyper 合约。</li>
<li><strong><code>_crytic_compile</code></strong>：编译器实例，用于编译目标合约。</li>
<li><strong><code>_detectors</code></strong> 和 <strong><code>_printers</code></strong>：分别存储已注册的检测器和打印机，用于漏洞检测和报告输出。</li>
</ul>
<h3 id="3-合约解析"><a href="#3-合约解析" class="headerlink" title="3. 合约解析"></a>3. <strong>合约解析</strong></h3><p><code>Slither</code> 会解析传入的目标合约，并根据合约的类型（Solidity 或 Vyper）选择适当的解析器（<code>SlitherCompilationUnitSolc</code> 或 <code>VyperCompilationUnit</code>）。每个合约的编译单元会被解析并添加到分析队列中。</p>
<ul>
<li><strong><code>SlitherCompilationUnitSolc</code></strong>：用于解析 Solidity 合约。</li>
<li><strong><code>VyperCompilationUnit</code></strong>：用于解析 Vyper 合约。</li>
<li><strong><code>_update_file_scopes</code></strong>：更新合约的文件范围，确保所有引用和符号都能正确解析。</li>
</ul>
<h3 id="4-检测器（Detectors）和打印机（Printers）"><a href="#4-检测器（Detectors）和打印机（Printers）" class="headerlink" title="4. 检测器（Detectors）和打印机（Printers）"></a>4. <strong>检测器（Detectors）和打印机（Printers）</strong></h3><p><code>Slither</code> 通过 <strong>检测器</strong> 来扫描合约并检测潜在的漏洞。检测器继承自 <code>AbstractDetector</code>，并根据不同的漏洞类型（如重入攻击、整数溢出等）进行检测。每个检测器会根据合约的 AST（抽象语法树）执行静态分析。</p>
<ul>
<li><strong><code>register_detector</code></strong>：注册新的检测器。</li>
<li><strong><code>unregister_detector</code></strong>：注销已注册的检测器。</li>
<li><strong><code>run_detectors</code></strong>：执行所有已注册的检测器，收集分析结果。</li>
</ul>
<p><strong>打印机</strong> 用于格式化和输出分析结果，支持输出为 JSON、SARIF 或其他格式。</p>
<ul>
<li><strong><code>register_printer</code></strong>：注册打印机。</li>
<li><strong><code>unregister_printer</code></strong>：注销打印机。</li>
<li><strong><code>run_printers</code></strong>：执行所有已注册的打印机，生成分析报告。</li>
</ul>
<h3 id="5-Codex-集成"><a href="#5-Codex-集成" class="headerlink" title="5. Codex 集成"></a>5. <strong>Codex 集成</strong></h3><p><code>Slither</code> 支持与 <strong>Codex</strong>（OpenAI 的模型）集成，进行自动化的漏洞修复建议。相关的配置项包括：</p>
<ul>
<li><strong><code>codex_enabled</code></strong>：是否启用 Codex 功能。</li>
<li><strong><code>codex_contracts</code></strong>：指定哪些合约会使用 Codex。</li>
<li><strong><code>codex_model</code></strong>：指定 Codex 模型（如 <code>text-davinci-003</code>）。</li>
<li><strong><code>codex_temperature</code></strong> 和 <strong><code>codex_max_tokens</code></strong>：控制 Codex 的生成参数。</li>
</ul>
<h3 id="6-合约检测和结果处理"><a href="#6-合约检测和结果处理" class="headerlink" title="6. 合约检测和结果处理"></a>6. <strong>合约检测和结果处理</strong></h3><p><code>Slither</code> 的一大特点是它的 <strong>增量分析</strong> 能力。它会加载之前的分析结果，并支持 <strong>triage（优先级分析）</strong> 模式，根据已经分析过的结果来过滤和排除重复的漏洞报告。</p>
<ul>
<li><strong><code>load_previous_results</code></strong>：加载之前的分析结果，以便增量分析。</li>
<li><strong><code>write_results_to_hide</code></strong> 和 <strong><code>save_results_to_hide</code></strong>：保存需要隐藏的结果，避免在后续分析中重复显示。</li>
<li><strong><code>valid_result</code></strong>：用于检查结果的有效性，排除不需要的结果（如被忽略的漏洞或重复报告）。</li>
</ul>
<h3 id="7-编译和源代码管理"><a href="#7-编译和源代码管理" class="headerlink" title="7. 编译和源代码管理"></a>7. <strong>编译和源代码管理</strong></h3><p><code>Slither</code> 通过 <strong><code>CryticCompile</code></strong> 进行合约编译和解析，并支持多种语言（Solidity 和 Vyper）。它会解析每个合约的 AST，并生成相关的符号和文件范围信息。</p>
<ul>
<li><strong><code>add_source_code</code></strong>：添加源代码并解析相关的符号。</li>
<li><strong><code>_compute_offsets_from_thing</code></strong>：为每个合约、函数、变量等元素计算源代码中的偏移量，确保能够正确映射和解析源代码。</li>
</ul>
<h3 id="8-总结"><a href="#8-总结" class="headerlink" title="8. 总结"></a>8. <strong>总结</strong></h3><p><code>Slither</code> 类的核心功能包括：</p>
<ul>
<li><strong>合约解析和编译</strong>：支持 Solidity 和 Vyper 合约的解析和编译。</li>
<li><strong>漏洞检测</strong>：通过多种检测器检测合约中的安全漏洞。</li>
<li><strong>结果过滤和处理</strong>：支持增量分析、忽略特定结果、显示被忽略的漏洞等。</li>
<li><strong>与 Codex 集成</strong>：利用 OpenAI Codex 提供自动化漏洞修复建议。</li>
</ul>
<p>如果你需要进一步了解某一部分的实现，或对代码有具体的疑问，随时提问！</p>
<h1 id="分析一下"><a href="#分析一下" class="headerlink" title="分析一下"></a>分析一下</h1>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Web3/">Web3</a>
                    
                      <a class="hover-with-bg" href="/tags/audit/">audit</a>
                    
                  </div>
                
              </div>
              
                
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/12/18/45235.html">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">我的生平（三十二）</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/12/17/4091.html">
                        <span class="hidden-mobile">slither2</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


            

                
                  <a id="scroll-top-button" href="#" role="button">
                    <i class="iconfont icon-arrowup" aria-hidden="true"></i>
                  </a>
                  

                    

                          
      </main>

      <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://whale3070.github.io/" target="_blank" rel="nofollow noopener"><span>Whale3070</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->




  



  <script  src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js" ></script>





  <script  src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


<link href="/pagefind/pagefind-ui.css" rel="stylesheet">
  <script src="/pagefind/pagefind-ui.js"></script>
  <style>
    /* 搜索框配色适配 */
    #search { margin-top: 2rem; }
    [data-user-color-scheme='dark'] .pagefind-ui {
      --pagefind-ui-primary: #eeeeee;
      --pagefind-ui-text: #eeeeee;
      --pagefind-ui-background: #151515;
      --pagefind-ui-border: #333;
    }
  </style>
    </body>

  </html>