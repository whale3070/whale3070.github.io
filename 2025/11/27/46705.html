

  <!DOCTYPE html>
  <html lang="zh-CN" data-default-color-scheme=&#34;dark&#34; >
  <style>
    .text1
    {
    text-shadow: 0px 0px 2px #f2f3f2;
    }
    </style>

  

<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/null">
  <link rel="icon" type="image/png" href="/null">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  <title>cryptozombies10 - whale3070&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />
  



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"192.168.126.129","root":"/","version":"1.8.7","typing":{"enable":false,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 7.3.0"></head>


    <body>
      <header style="height: 70vh;">
        <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>InfoSec learning</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/search/">
                <i class="iconfont icon-search"></i>
                æœç´¢
              </a>
            </li>
          
        
        
        
          
        
      </ul>
    </div>
  </div>
</nav>

          <div class="banner" id="banner" false
            style="background: url('/img/default.png') no-repeat center center;
              background-size: cover;">
              <div class="full-bg-img">
                <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
                  <div class="page-header text-center fade-in-up">
                    <span class="h2 text1" id="subtitle" title="cryptozombies10">
                      
                        cryptozombies10
                      
                    </span>
        
                    
                      <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2025-11-27 14:48" pubdate>
        2025å¹´11æœˆ27æ—¥ ä¸‹åˆ
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      8.1k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      111
       åˆ†é’Ÿ
    </span>
  

  
  
</div>

                    
                  </div>
                    
                  </div>
                  
                </div>
              </div>
          </div>
      </header>

      <main>
        
          

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" data-pagefind-body>
            <!-- SEO header -->
            <h1 style="display: none">cryptozombies10</h1>
            
            <div class="markdown-body">
              <h1 id="ç¬¬7ç« ï¼šä¿æŒæ¸¸æˆçš„ä¹è¶£ï¼ˆç»­ï¼‰"><a href="#ç¬¬7ç« ï¼šä¿æŒæ¸¸æˆçš„ä¹è¶£ï¼ˆç»­ï¼‰" class="headerlink" title="ç¬¬7ç« ï¼šä¿æŒæ¸¸æˆçš„ä¹è¶£ï¼ˆç»­ï¼‰"></a>ç¬¬7ç« ï¼šä¿æŒæ¸¸æˆçš„ä¹è¶£ï¼ˆç»­ï¼‰</h1><p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†å®Œæˆç¬¬äºŒä¸ªæµ‹è¯•çš„ä»£ç ã€‚å®ƒåº”è¯¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li><p>é¦–å…ˆï¼ŒAlice åº”è¯¥è°ƒç”¨ <code>createRandomZombie</code> å¹¶å°† <code>zombieNames[0]</code> ä½œä¸ºå¥¹ç¬¬ä¸€ä¸ªåƒµå°¸çš„åå­—ã€‚</p>
</li>
<li><p>æ¥ä¸‹æ¥ï¼ŒAlice åº”è¯¥å°è¯•åˆ›å»ºå¥¹çš„ç¬¬äºŒä¸ªåƒµå°¸ã€‚å”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œè¿™æ¬¡åƒµå°¸çš„åå­—åº”è¯¥è®¾ç½®ä¸º <code>zombieNames[1]</code>ã€‚</p>
</li>
<li><p>åœ¨è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬é¢„è®¡åˆçº¦ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</p>
</li>
<li><p>ç”±äºæˆ‘ä»¬çš„æµ‹è¯•åªæœ‰åœ¨æ™ºèƒ½åˆçº¦æŠ›å‡ºé”™è¯¯æ—¶æ‰ç®—é€šè¿‡ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„é€»è¾‘ä¼šç¨æœ‰ä¸åŒã€‚æˆ‘ä»¬å°†ä¸å¾—ä¸å°†ç¬¬äºŒæ¬¡è°ƒç”¨ <code>createRandomZombie</code> æ”¾åœ¨ <code>try/catch</code> å—ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-comment">// å°è¯•åˆ›å»ºç¬¬äºŒä¸ªåƒµå°¸</span><br>    <span class="hljs-keyword">await</span> contractInstance.<span class="hljs-title function_">createRandomZombie</span>(zombieNames[<span class="hljs-number">1</span>], &#123;<span class="hljs-attr">from</span>: alice&#125;);<br>    <span class="hljs-title function_">assert</span>(<span class="hljs-literal">true</span>);<br>&#125;<br><span class="hljs-keyword">catch</span> (err) &#123;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><span class="hljs-title function_">assert</span>(<span class="hljs-literal">false</span>, <span class="hljs-string">&quot;The contract did not throw.&quot;</span>);<br></code></pre></div></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å¾—åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œå¯¹å§ï¼Ÿ</p>
<p>å—¯â€¦ æˆ‘ä»¬å·²ç»å¾ˆæ¥è¿‘äº†ï¼Œä½†è¿˜å·®ä¸€ç‚¹ã€‚</p>
<p>ä¸ºäº†ä¿æŒæµ‹è¯•ä»£ç çš„ç®€æ´ï¼Œæˆ‘ä»¬å°†ä¸Šé¢çš„ä»£ç ç§»åˆ°äº† <code>helpers/utils.js</code> ä¸­ï¼Œå¹¶åœ¨ <code>CryptoZombies.js</code> ä¸­å¯¼å…¥å®ƒï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./helpers/utils&quot;</span>);<br></code></pre></div></td></tr></table></figure>

<p>ç„¶åï¼Œè°ƒç”¨å‡½æ•°çš„ä»£ç è¡Œåº”è¯¥åƒè¿™æ ·ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">await</span> utils.<span class="hljs-title function_">shouldThrow</span>(myAwesomeContractInstance.<span class="hljs-title function_">myAwesomeFunction</span>());<br></code></pre></div></td></tr></table></figure>

<h3 id="æµ‹è¯•ä¸€ä¸‹"><a href="#æµ‹è¯•ä¸€ä¸‹" class="headerlink" title="æµ‹è¯•ä¸€ä¸‹"></a>æµ‹è¯•ä¸€ä¸‹</h3><p>åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬ä¸ºç¬¬äºŒä¸ªæµ‹è¯•åˆ›å»ºäº†ä¸€ä¸ªç©ºçš„æ¡†æ¶ã€‚ç°åœ¨è®©æˆ‘ä»¬æ¥å¡«å……å®ƒã€‚</p>
<p>é¦–å…ˆï¼Œè®© Alice åˆ›å»ºå¥¹çš„ç¬¬ä¸€ä¸ªåƒµå°¸ã€‚å°† <code>zombieNames[0]</code> ä½œä¸ºåå­—ï¼Œå¹¶ç¡®ä¿æ­£ç¡®è®¾ç½®æ‰€æœ‰è€…ã€‚</p>
<p>åœ¨ Alice åˆ›å»ºäº†ç¬¬ä¸€ä¸ªåƒµå°¸ä¹‹åï¼Œä½¿ç”¨ <code>shouldThrow</code> è¿è¡Œ <code>createRandomZombie</code>ï¼Œä½œä¸ºå‚æ•°ã€‚å¦‚æœä½ ä¸è®°å¾—å¦‚ä½•ç¼–å†™è¯­æ³•ï¼Œå¯ä»¥å‚è€ƒä¸Šé¢çš„ç¤ºä¾‹ã€‚ä¸è¿‡ï¼Œé¦–å…ˆè¯•ç€è‡ªå·±å†™å†™çœ‹ï¼Œä¸è¦å·çœ‹å“¦ã€‚</p>
<p>å¤ªæ£’äº†ï¼Œä½ åˆšåˆšå®Œæˆäº†ç¬¬äºŒä¸ªæµ‹è¯•çš„ç¼–å†™ï¼</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ä¸ºä½ è¿è¡Œäº† <code>truffle test</code>ã€‚ä»¥ä¸‹æ˜¯è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livecodeserver">Contract: CryptoZombies<br>    âœ“ should be able <span class="hljs-built_in">to</span> <span class="hljs-built_in">create</span> <span class="hljs-keyword">a</span> <span class="hljs-built_in">new</span> zombie (<span class="hljs-number">129</span>ms)<br>    âœ“ should <span class="hljs-keyword">not</span> allow <span class="hljs-literal">two</span> zombies (<span class="hljs-number">148</span>ms)<br><br>  <span class="hljs-number">2</span> passing (<span class="hljs-number">1</span>s)<br></code></pre></div></td></tr></table></figure>

<p>æµ‹è¯•é€šè¿‡äº†ã€‚å¤ªæ£’äº†ï¼</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">it(<span class="hljs-string">&quot;should not allow two zombies&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;<span class="hljs-keyword">from</span>: alice&#125;);<br>    <span class="hljs-keyword">await</span> utils.shouldThrow(contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">1</span>], &#123;<span class="hljs-keyword">from</span>: alice&#125;));<br>&#125;)<br></code></pre></div></td></tr></table></figure>
<p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ª <strong>Mocha æµ‹è¯•</strong>ï¼Œç”¨äºæµ‹è¯•æ™ºèƒ½åˆçº¦ä¸­çš„ <strong><code>createRandomZombie</code></strong> å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶åˆ†è§£ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†æ¥è§£é‡Šï¼š</p>
<h3 id="1-it-å‡½æ•°"><a href="#1-it-å‡½æ•°" class="headerlink" title="1. it å‡½æ•°"></a>1. <strong><code>it</code> å‡½æ•°</strong></h3><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">it</span>(<span class="hljs-string">&quot;should not allow two zombies&quot;</span>, <span class="hljs-title function_">async</span> () =&gt; &#123;<br>    <span class="hljs-comment">// æµ‹è¯•ä»£ç </span><br>&#125;);<br></code></pre></div></td></tr></table></figure>

<ul>
<li><code>it()</code> æ˜¯ Mocha æµ‹è¯•æ¡†æ¶çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥å®šä¹‰ä¸€ä¸ªå…·ä½“çš„æµ‹è¯•ç”¨ä¾‹ã€‚æµ‹è¯•ç”¨ä¾‹çš„æè¿°æ˜¯ <code>&quot;should not allow two zombies&quot;</code>ï¼Œæ„å‘³ç€è¿™ä¸ªæµ‹è¯•çš„ç›®çš„æ˜¯éªŒè¯åˆçº¦æ˜¯å¦æ­£ç¡®é™åˆ¶ä¸€ä¸ªç”¨æˆ·ä¸èƒ½åˆ›å»ºå¤šä¸ªåƒµå°¸ã€‚</li>
<li><code>async</code> å…³é”®å­—è¡¨æ˜è¿™ä¸ªæµ‹è¯•æ˜¯å¼‚æ­¥çš„ï¼Œæ„å‘³ç€æµ‹è¯•ä¸­çš„ä»£ç ä¼šæ¶‰åŠåˆ°ä¸åŒºå—é“¾çš„äº¤äº’ï¼Œå¹¶ä¸”éœ€è¦ç­‰å¾…æ™ºèƒ½åˆçº¦çš„å“åº”ã€‚</li>
</ul>
<h3 id="2-åˆ›å»ºç¬¬ä¸€ä¸ªåƒµå°¸"><a href="#2-åˆ›å»ºç¬¬ä¸€ä¸ªåƒµå°¸" class="headerlink" title="2. åˆ›å»ºç¬¬ä¸€ä¸ªåƒµå°¸"></a>2. <strong>åˆ›å»ºç¬¬ä¸€ä¸ªåƒµå°¸</strong></h3><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">await</span> contractInstance.<span class="hljs-title function_">createRandomZombie</span>(zombieNames[<span class="hljs-number">0</span>], &#123;<span class="hljs-attr">from</span>: alice&#125;);<br></code></pre></div></td></tr></table></figure>

<ul>
<li>è¿™è¡Œä»£ç è°ƒç”¨åˆçº¦å®ä¾‹ <code>contractInstance</code> ä¸Šçš„ <code>createRandomZombie</code> æ–¹æ³•ï¼Œå¹¶ä¼ é€’ä¸€ä¸ªåå­—ï¼ˆ<code>zombieNames[0]</code>ï¼‰å’Œä¸€ä¸ªæ‰€æœ‰è€…åœ°å€ï¼ˆ<code>from: alice</code>ï¼‰ã€‚è¿™æ„å‘³ç€ Alice å°†åˆ›å»ºä¸€ä¸ªåä¸º <code>zombieNames[0]</code> çš„åƒµå°¸ã€‚</li>
<li><code>await</code> ç”¨äºç­‰å¾…åˆçº¦è°ƒç”¨å®Œæˆã€‚åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>createRandomZombie</code> å¯èƒ½æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ <code>await</code> æ¥ç¡®ä¿æµ‹è¯•åœ¨æ‰§è¡Œåç»­ä»£ç å‰ç­‰å¾…è¿™æ¬¡è°ƒç”¨å®Œæˆã€‚</li>
</ul>
<h3 id="3-éªŒè¯ä¸èƒ½åˆ›å»ºç¬¬äºŒä¸ªåƒµå°¸"><a href="#3-éªŒè¯ä¸èƒ½åˆ›å»ºç¬¬äºŒä¸ªåƒµå°¸" class="headerlink" title="3. éªŒè¯ä¸èƒ½åˆ›å»ºç¬¬äºŒä¸ªåƒµå°¸"></a>3. <strong>éªŒè¯ä¸èƒ½åˆ›å»ºç¬¬äºŒä¸ªåƒµå°¸</strong></h3><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">await</span> utils.<span class="hljs-title function_">shouldThrow</span>(contractInstance.<span class="hljs-title function_">createRandomZombie</span>(zombieNames[<span class="hljs-number">1</span>], &#123;<span class="hljs-attr">from</span>: alice&#125;));<br></code></pre></div></td></tr></table></figure>

<ul>
<li>è¿™è¡Œä»£ç å°è¯•å†æ¬¡è°ƒç”¨ <code>createRandomZombie</code>ï¼Œå¹¶ç»™å‡ºä¸€ä¸ªæ–°çš„åå­—ï¼ˆ<code>zombieNames[1]</code>ï¼‰ã€‚ç„¶è€Œï¼Œæ ¹æ®åˆçº¦ä¸­çš„é™åˆ¶ï¼Œç”¨æˆ·åªèƒ½æ‹¥æœ‰ä¸€ä¸ªåƒµå°¸ï¼Œæ‰€ä»¥è¿™æ¬¡è°ƒç”¨åº”è¯¥æŠ›å‡ºé”™è¯¯ï¼ˆ<code>require(ownerZombieCount[msg.sender] == 0)</code>ï¼‰ã€‚</li>
<li><code>utils.shouldThrow()</code> æ˜¯ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼ˆä½äº <code>helpers/utils.js</code> ä¸­ï¼‰ï¼Œå®ƒçš„ç›®çš„æ˜¯æ£€æŸ¥ç»™å®šçš„åˆçº¦è°ƒç”¨æ˜¯å¦æŠ›å‡ºäº†é”™è¯¯ã€‚å¦‚æœæŠ›å‡ºé”™è¯¯ï¼Œè¯´æ˜æµ‹è¯•é€šè¿‡ï¼›å¦‚æœæ²¡æœ‰æŠ›å‡ºé”™è¯¯ï¼Œåˆ™æµ‹è¯•å¤±è´¥ã€‚</li>
<li>è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯ç¡®ä¿ç¬¬äºŒæ¬¡è°ƒç”¨ <code>createRandomZombie</code> æ—¶ï¼Œåˆçº¦ä¼šæŠ›å‡ºé”™è¯¯ï¼Œä»è€ŒéªŒè¯æˆ‘ä»¬çš„é€»è¾‘ï¼šä¸€ä¸ªç”¨æˆ·ä¸èƒ½æ‹¥æœ‰è¶…è¿‡ä¸€ä¸ªåƒµå°¸ã€‚</li>
</ul>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™æ®µæµ‹è¯•çš„ç›®çš„æ˜¯éªŒè¯æ™ºèƒ½åˆçº¦ä¸­çš„é™åˆ¶ï¼šæ¯ä¸ªç”¨æˆ·æœ€å¤šåªèƒ½æ‹¥æœ‰ä¸€ä¸ªåƒµå°¸ã€‚å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>Alice åˆ›å»ºäº†ç¬¬ä¸€ä¸ªåƒµå°¸ã€‚</li>
<li>ç„¶åï¼Œæˆ‘ä»¬éªŒè¯å½“ Alice å†æ¬¡å°è¯•åˆ›å»ºç¬¬äºŒä¸ªåƒµå°¸æ—¶ï¼Œåˆçº¦åº”è¯¥æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</li>
<li>é€šè¿‡ <code>shouldThrow</code> æ–¹æ³•ï¼Œç¡®ä¿é”™è¯¯è¢«æ­£ç¡®æŠ›å‡ºï¼Œå¦‚æœæŠ›å‡ºé”™è¯¯ï¼Œæµ‹è¯•é€šè¿‡ã€‚</li>
</ol>
<p>è¿™ä¸ªæµ‹è¯•çš„æ ¸å¿ƒæ€æƒ³æ˜¯åˆ©ç”¨ <code>require</code> æ¥é™åˆ¶ç”¨æˆ·åªèƒ½åˆ›å»ºä¸€ä¸ªåƒµå°¸ï¼Œå¹¶ç¡®ä¿ç¬¬äºŒæ¬¡å°è¯•æ—¶ä¼šè§¦å‘é”™è¯¯ã€‚</p>
<h1 id="ç¬¬8ç« ï¼šåƒµå°¸è½¬ç§»"><a href="#ç¬¬8ç« ï¼šåƒµå°¸è½¬ç§»" class="headerlink" title="ç¬¬8ç« ï¼šåƒµå°¸è½¬ç§»"></a>ç¬¬8ç« ï¼šåƒµå°¸è½¬ç§»</h1><p><strong>é—®é¢˜</strong>ï¼šå‡è®¾ Alice æƒ³è¦å°†å¥¹çš„åƒµå°¸å‘é€ç»™ Bobã€‚æˆ‘ä»¬è¦æµ‹è¯•è¿™ä¸ªåŠŸèƒ½å—ï¼Ÿ</p>
<p><strong>å½“ç„¶è¦ï¼</strong></p>
<p>å¦‚æœä½ ä¸€ç›´è·Ÿéšæˆ‘ä»¬ä¹‹å‰çš„è¯¾ç¨‹ï¼Œä½ åº”è¯¥çŸ¥é“ï¼Œæˆ‘ä»¬çš„åƒµå°¸é™¤äº†ç»§æ‰¿è‡ª ERC721 å¤–ï¼Œè¿˜å…·å¤‡ ERC721 çš„ä¸€äº›åŸºæœ¬ç‰¹æ€§ã€‚ERC721 è§„èŒƒæä¾›äº†ä¸¤ç§è½¬ç§»ä»£å¸çš„æ–¹å¼ï¼š</p>
<h4 id="1-ç¬¬ä¸€ç§æ–¹å¼"><a href="#1-ç¬¬ä¸€ç§æ–¹å¼" class="headerlink" title="(1) ç¬¬ä¸€ç§æ–¹å¼"></a>(1) ç¬¬ä¸€ç§æ–¹å¼</h4><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs solidity">function transferFrom(address _from, address _to, uint256 _tokenId) external payable;<br></code></pre></div></td></tr></table></figure>

<p>ç¬¬ä¸€ç§æ–¹å¼æ˜¯ Aliceï¼ˆæ‹¥æœ‰è€…ï¼‰è°ƒç”¨ <code>transferFrom</code>ï¼Œå°†å¥¹çš„åœ°å€ä½œä¸º <code>_from</code> å‚æ•°ï¼ŒBob çš„åœ°å€ä½œä¸º <code>_to</code> å‚æ•°ï¼Œä¼ å…¥å¥¹æƒ³è½¬ç§»çš„åƒµå°¸ IDã€‚</p>
<h4 id="2-ç¬¬äºŒç§æ–¹å¼"><a href="#2-ç¬¬äºŒç§æ–¹å¼" class="headerlink" title="(2) ç¬¬äºŒç§æ–¹å¼"></a>(2) ç¬¬äºŒç§æ–¹å¼</h4><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs solidity">function approve(address _approved, uint256 _tokenId) external payable;<br></code></pre></div></td></tr></table></figure>

<p>æ¥ç€è°ƒç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs solidity">function transferFrom(address _from, address _to, uint256 _tokenId) external payable;<br></code></pre></div></td></tr></table></figure>

<p>ç¬¬äºŒç§æ–¹å¼æ˜¯ Alice é¦–å…ˆè°ƒç”¨ <code>approve</code>ï¼Œå°† Bob çš„åœ°å€å’Œåƒµå°¸ ID ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œåˆçº¦è®°å½• Bob è¢«æˆæƒè½¬ç§»è¯¥åƒµå°¸ã€‚æ¥ç€ï¼Œå½“ Alice æˆ– Bob è°ƒç”¨ <code>transferFrom</code> æ—¶ï¼Œåˆçº¦æ£€æŸ¥ <code>msg.sender</code> æ˜¯å¦ä¸º Alice æˆ– Bob çš„åœ°å€ã€‚å¦‚æœæ˜¯ï¼Œå°±å°†åƒµå°¸è½¬ç§»ç»™ Bobã€‚</p>
<p>æˆ‘ä»¬å°†è¿™ä¸¤ç§è½¬ç§»åƒµå°¸çš„æ–¹å¼ç§°ä¸ºâ€œåœºæ™¯â€ã€‚ä¸ºäº†æµ‹è¯•æ¯ç§åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸¤ä¸ªä¸åŒçš„æµ‹è¯•ç»„ï¼Œå¹¶ä¸ºå®ƒä»¬æä¾›æœ‰æ„ä¹‰çš„æè¿°ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆè¦åˆ†ç»„æµ‹è¯•ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦åˆ†ç»„æµ‹è¯•ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦åˆ†ç»„æµ‹è¯•ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦åˆ†ç»„æµ‹è¯•ï¼Ÿ</h3><p>æˆ‘ä»¬ç°åœ¨çš„é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œä½†å°†æ¥å¯èƒ½ä¼šæ›´å¤æ‚ã€‚å°¤å…¶æ˜¯ç¬¬äºŒç§åœºæ™¯ï¼ˆå³ <code>approve</code> åè·Ÿ <code>transferFrom</code>ï¼‰è‡³å°‘éœ€è¦ä¸¤ä¸ªæµ‹è¯•ï¼š</p>
<ul>
<li>é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»æ£€æŸ¥ Alice è‡ªå·±æ˜¯å¦èƒ½è½¬ç§»åƒµå°¸ã€‚</li>
<li>å…¶æ¬¡ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»æ£€æŸ¥ Bob æ˜¯å¦è¢«å…è®¸è¿è¡Œ <code>transferFrom</code>ã€‚</li>
</ul>
<p>æ­¤å¤–ï¼Œå°†æ¥ä½ å¯èƒ½ä¼šæ·»åŠ å…¶ä»–åŠŸèƒ½ï¼Œéœ€è¦ä¸åŒçš„æµ‹è¯•ã€‚æˆ‘ä»¬è®¤ä¸ºä»ä¸€å¼€å§‹å°±è®¾å®šä¸€ä¸ªå¯æ‰©å±•çš„ç»“æ„æ˜¯æœ€å¥½çš„åšæ³•ğŸ˜‰ã€‚è¿™æ ·ï¼Œæ— è®ºæ˜¯å…¶ä»–å¼€å‘è€…è¿˜æ˜¯ä½ è‡ªå·±ï¼Œå¦‚æœåœ¨ä¸€æ®µæ—¶é—´åé‡æ–°å›é¡¾è¿™äº›ä»£ç ï¼Œéƒ½ä¼šæ›´å®¹æ˜“ç†è§£ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœä½ ä¸å…¶ä»–å¼€å‘äººå‘˜ä¸€èµ·å·¥ä½œï¼Œä½ ä¼šå‘ç°ä»–ä»¬æ›´æœ‰å¯èƒ½éµå¾ªä½ åœ¨åˆæœŸä»£ç ä¸­æ‰€è®¾å®šçš„çº¦å®šã€‚èƒ½å¤Ÿæœ‰æ•ˆåä½œæ˜¯ä½ åœ¨åšå¤§é¡¹ç›®æ—¶å¿…é¡»æŒæ¡çš„æŠ€èƒ½ã€‚å°½æ—©å…»æˆè¿™äº›å¥½çš„ä¹ æƒ¯ï¼Œä¼šè®©ä½ ä½œä¸ºå¼€å‘è€…çš„ç”Ÿæ´»å˜å¾—æ›´åŠ è½»æ¾å’ŒæˆåŠŸã€‚</p>
<h3 id="context-å‡½æ•°"><a href="#context-å‡½æ•°" class="headerlink" title="context å‡½æ•°"></a><code>context</code> å‡½æ•°</h3><p>ä¸ºäº†åˆ†ç»„æµ‹è¯•ï¼ŒTruffle æä¾›äº†ä¸€ä¸ªå«åš <code>context</code> çš„å‡½æ•°ã€‚è®©æˆ‘å¿«é€Ÿå±•ç¤ºä¸€ä¸‹å¦‚ä½•ä½¿ç”¨å®ƒæ¥æ›´å¥½åœ°ç»“æ„åŒ–æˆ‘ä»¬çš„ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">context</span>(<span class="hljs-string">&quot;with the single-step transfer scenario&quot;</span>, <span class="hljs-title function_">async</span> () =&gt; &#123;<br>    <span class="hljs-title function_">it</span>(<span class="hljs-string">&quot;should transfer a zombie&quot;</span>, <span class="hljs-title function_">async</span> () =&gt; &#123;<br>      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> æµ‹è¯•å•æ­¥è½¬ç§»åœºæ™¯ã€‚</span><br>    &#125;)<br>&#125;)<br><br><span class="hljs-title function_">context</span>(<span class="hljs-string">&quot;with the two-step transfer scenario&quot;</span>, <span class="hljs-title function_">async</span> () =&gt; &#123;<br>    <span class="hljs-title function_">it</span>(<span class="hljs-string">&quot;should approve and then transfer a zombie when the approved address calls transferFrom&quot;</span>, <span class="hljs-title function_">async</span> () =&gt; &#123;<br>      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> æµ‹è¯•ä¸¤æ­¥è½¬ç§»åœºæ™¯ã€‚ç”±æˆæƒåœ°å€è°ƒç”¨ transferFrom</span><br>    &#125;)<br>    <span class="hljs-title function_">it</span>(<span class="hljs-string">&quot;should approve and then transfer a zombie when the owner calls transferFrom&quot;</span>, <span class="hljs-title function_">async</span> () =&gt; &#123;<br>        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> æµ‹è¯•ä¸¤æ­¥è½¬ç§»åœºæ™¯ã€‚ç”±æ‹¥æœ‰è€…è°ƒç”¨ transferFrom</span><br>     &#125;)<br>&#125;)<br></code></pre></div></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬å°†è¿™äº›ä»£ç æ·»åŠ åˆ° <code>CryptoZombies.js</code> æ–‡ä»¶ä¸­ï¼Œå¹¶è¿è¡Œ <code>truffle test</code>ï¼Œè¾“å‡ºåº”è¯¥ç±»ä¼¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livecodeserver">Contract: CryptoZombies<br>    âœ“ should be able <span class="hljs-built_in">to</span> <span class="hljs-built_in">create</span> <span class="hljs-keyword">a</span> <span class="hljs-built_in">new</span> zombie (<span class="hljs-number">100</span>ms)<br>    âœ“ should <span class="hljs-keyword">not</span> allow <span class="hljs-literal">two</span> zombies (<span class="hljs-number">251</span>ms)<br>    <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> single-step transfer scenario<br>      âœ“ should transfer <span class="hljs-keyword">a</span> zombie<br>    <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> <span class="hljs-literal">two</span>-step transfer scenario<br>      âœ“ should approve <span class="hljs-keyword">and</span> <span class="hljs-keyword">then</span> transfer <span class="hljs-keyword">a</span> zombie when <span class="hljs-keyword">the</span> owner calls transferFrom<br>      âœ“ should approve <span class="hljs-keyword">and</span> <span class="hljs-keyword">then</span> transfer <span class="hljs-keyword">a</span> zombie when <span class="hljs-keyword">the</span> approved address calls transferFrom<br><br>  <span class="hljs-number">5</span> passing (<span class="hljs-number">2</span>s)<br></code></pre></div></td></tr></table></figure>

<p><strong>ä½†æ˜¯</strong>ï¼Œçœ‹ä¸€ä¸‹ä¸Šé¢çš„è¾“å‡ºâ€”â€”å®ƒçœ‹èµ·æ¥å¥½åƒæ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡äº†ï¼Œæ˜¾ç„¶è¿™æ˜¯ä¸å¯¹çš„ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰ç¼–å†™è¿™äº›æµ‹è¯•å‘¢ï¼ï¼</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œè¿™æœ‰ä¸€ä¸ªç®€å•çš„è§£å†³åŠæ³•â€”â€”å¦‚æœæˆ‘ä»¬åœ¨ <code>context()</code> å‡½æ•°å‰åŠ ä¸Š <code>x</code>ï¼Œå°±åƒè¿™æ ·ï¼š<code>xcontext()</code>ï¼ŒTruffle ä¼šè·³è¿‡è¿™äº›æµ‹è¯•ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šä½ ä¹Ÿå¯ä»¥åœ¨ <code>it()</code> å‡½æ•°å‰åŠ ä¸Š <code>x</code>ã€‚è®°ä½ï¼Œå½“ä½ ç¼–å†™å®Œè¿™äº›å‡½æ•°çš„æµ‹è¯•åï¼Œåˆ«å¿˜äº†å»æ‰æ‰€æœ‰çš„ <code>x</code>ï¼</p>
<p>ç°åœ¨ï¼Œè¿è¡Œ <code>truffle test</code>ã€‚è¾“å‡ºåº”è¯¥ç±»ä¼¼äºä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livecodeserver">Contract: CryptoZombies<br>    âœ“ should be able <span class="hljs-built_in">to</span> <span class="hljs-built_in">create</span> <span class="hljs-keyword">a</span> <span class="hljs-built_in">new</span> zombie (<span class="hljs-number">199</span>ms)<br>    âœ“ should <span class="hljs-keyword">not</span> allow <span class="hljs-literal">two</span> zombies (<span class="hljs-number">175</span>ms)<br>    <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> single-step transfer scenario<br>      - should transfer <span class="hljs-keyword">a</span> zombie<br>    <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> <span class="hljs-literal">two</span>-step transfer scenario<br>      - should approve <span class="hljs-keyword">and</span> <span class="hljs-keyword">then</span> transfer <span class="hljs-keyword">a</span> zombie when <span class="hljs-keyword">the</span> owner calls transferFrom<br>      - should approve <span class="hljs-keyword">and</span> <span class="hljs-keyword">then</span> transfer <span class="hljs-keyword">a</span> zombie when <span class="hljs-keyword">the</span> approved address calls transferFrom<br><br>  <span class="hljs-number">2</span> passing (<span class="hljs-number">827</span>ms)<br>  <span class="hljs-number">3</span> pending<br></code></pre></div></td></tr></table></figure>

<p>å…¶ä¸­ <code>-</code> è¡¨ç¤ºå·²è·³è¿‡çš„æµ‹è¯•ã€‚</p>
<p>æ˜¯ä¸æ˜¯å¾ˆé…·ï¼Ÿç°åœ¨ä½ å¯ä»¥åœ¨ç¼–å†™æµ‹è¯•æ—¶æ ‡è®°å‡ºä½ çŸ¥é“éœ€è¦å†™æµ‹è¯•çš„ç©ºå‡½æ•°ï¼Œç„¶åç»§ç»­è¿›è¡Œå…¶ä»–å·¥ä½œã€‚</p>
<h3 id="æµ‹è¯•ä¸€ä¸‹-1"><a href="#æµ‹è¯•ä¸€ä¸‹-1" class="headerlink" title="æµ‹è¯•ä¸€ä¸‹"></a>æµ‹è¯•ä¸€ä¸‹</h3><p>èµ¶å¿«å¤åˆ¶&#x2F;ç²˜è´´ä¸Šé¢çš„ä»£ç ã€‚</p>
<p>æš‚æ—¶è·³è¿‡æˆ‘ä»¬æ–°æ·»åŠ çš„ <code>context</code> å‡½æ•°ã€‚</p>
<p>æˆ‘ä»¬çš„æµ‹è¯•åªæ˜¯ç©ºçš„æ¡†æ¶ï¼Œè¿˜éœ€è¦å†™å¾ˆå¤šé€»è¾‘æ¥å®ç°å®ƒä»¬ã€‚æˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­åˆ†æ­¥éª¤å®ç°è¿™äº›åŠŸèƒ½ã€‚</p>
<p>ç­”æ¡ˆï¼š</p>
<figure class="highlight dart"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dart"><br><span class="hljs-keyword">const</span> CryptoZombies = artifacts.require(<span class="hljs-string">&quot;CryptoZombies&quot;</span>);<br><span class="hljs-keyword">const</span> utils = require(<span class="hljs-string">&quot;./helpers/utils&quot;</span>);<br><span class="hljs-keyword">const</span> zombieNames = [<span class="hljs-string">&quot;Zombie 1&quot;</span>, <span class="hljs-string">&quot;Zombie 2&quot;</span>];<br>contract(<span class="hljs-string">&quot;CryptoZombies&quot;</span>, (accounts) =&gt; &#123;<br>    let [alice, bob] = accounts;<br>    let contractInstance;<br>    beforeEach(<span class="hljs-keyword">async</span> () =&gt; &#123;<br>        contractInstance = <span class="hljs-keyword">await</span> CryptoZombies.<span class="hljs-keyword">new</span>();<br>    &#125;);<br>    it(<span class="hljs-string">&quot;should be able to create a new zombie&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>        <span class="hljs-keyword">assert</span>.equal(result.receipt.status, <span class="hljs-keyword">true</span>);<br>        <span class="hljs-keyword">assert</span>.equal(result.logs[<span class="hljs-number">0</span>].args.name,zombieNames[<span class="hljs-number">0</span>]);<br>    &#125;)<br>    it(<span class="hljs-string">&quot;should not allow two zombies&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>        <span class="hljs-keyword">await</span> utils.shouldThrow(contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">1</span>], &#123;from: alice&#125;));<br>    &#125;)<br><br>    xcontext(<span class="hljs-string">&quot;with the single-step transfer scenario&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>    it(<span class="hljs-string">&quot;should transfer a zombie&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Test the single-step transfer scenario.</span><br>    &#125;)<br>&#125;)<br><br>xcontext(<span class="hljs-string">&quot;with the two-step transfer scenario&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>    it(<span class="hljs-string">&quot;should approve and then transfer a zombie when the approved address calls transferFrom&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Test the two-step scenario.  The approved address calls transferFrom</span><br>    &#125;)<br>    it(<span class="hljs-string">&quot;should approve and then transfer a zombie when the owner calls transferFrom&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Test the two-step scenario.  The owner calls transferFrom</span><br>     &#125;)<br>&#125;)<br>&#125;)<br><br></code></pre></div></td></tr></table></figure>

<h1 id="ç¬¬9ç« ï¼šERC721-ä»£å¸è½¬ç§»-å•æ­¥åœºæ™¯"><a href="#ç¬¬9ç« ï¼šERC721-ä»£å¸è½¬ç§»-å•æ­¥åœºæ™¯" class="headerlink" title="ç¬¬9ç« ï¼šERC721 ä»£å¸è½¬ç§» - å•æ­¥åœºæ™¯"></a>ç¬¬9ç« ï¼šERC721 ä»£å¸è½¬ç§» - å•æ­¥åœºæ™¯</h1><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»…ä»…æ˜¯åšäº†çƒ­èº«â€¦</p>
<p>ä½†ç°åœ¨æ˜¯æ—¶å€™çœŸæ­£å±•ç¤ºä½ çš„çŸ¥è¯†äº†ï¼</p>
<p>åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æŠŠæ‰€å­¦çš„å†…å®¹æ•´åˆèµ·æ¥ï¼Œæµ‹è¯•ä¸€äº›éå¸¸é…·çš„ä¸œè¥¿ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†æµ‹è¯• Alice å°†å¥¹çš„ ERC721 ä»£å¸è½¬ç§»ç»™ Bob çš„åœºæ™¯ï¼Œé‡‡ç”¨å•æ­¥æ“ä½œã€‚</p>
<h3 id="æµ‹è¯•åº”è¯¥åšä»€ä¹ˆï¼š"><a href="#æµ‹è¯•åº”è¯¥åšä»€ä¹ˆï¼š" class="headerlink" title="æµ‹è¯•åº”è¯¥åšä»€ä¹ˆï¼š"></a>æµ‹è¯•åº”è¯¥åšä»€ä¹ˆï¼š</h3><ol>
<li>ä¸º Alice åˆ›å»ºä¸€ä¸ªæ–°çš„åƒµå°¸ï¼ˆè®°ä½ï¼Œåƒµå°¸å°±æ˜¯ä¸€ä¸ª ERC721 ä»£å¸ï¼‰ã€‚</li>
<li>ç¡®ä¿ Alice å°†å¥¹çš„ ERC721 ä»£å¸è½¬ç§»ç»™ Bobã€‚</li>
<li>æ­¤æ—¶ï¼ŒBob åº”è¯¥æ‹¥æœ‰è¯¥ ERC721 ä»£å¸ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œè°ƒç”¨ <code>ownerOf</code> æ—¶åº”è¿”å› Bob çš„åœ°å€ã€‚</li>
</ol>
<p>æœ€åï¼Œæˆ‘ä»¬ç”¨æ–­è¨€æ¥æ£€æŸ¥ Bob æ˜¯å¦æ˜¯æ–°çš„æ‹¥æœ‰è€…ã€‚</p>
<h3 id="æµ‹è¯•ä¸€ä¸‹-2"><a href="#æµ‹è¯•ä¸€ä¸‹-2" class="headerlink" title="æµ‹è¯•ä¸€ä¸‹"></a>æµ‹è¯•ä¸€ä¸‹</h3><ol>
<li><p><strong>ç¬¬ä¸€è¡Œ</strong>ï¼šè°ƒç”¨ <code>createRandomZombie</code>ï¼Œä¸º Alice åˆ›å»ºä¸€ä¸ªåƒµå°¸ã€‚ç»™å®ƒ <code>zombieNames[0]</code> ä½œä¸ºåå­—ï¼Œå¹¶ç¡®ä¿ Alice æ˜¯è¯¥åƒµå°¸çš„æ‰€æœ‰è€…ã€‚</p>
</li>
<li><p><strong>ç¬¬äºŒè¡Œ</strong>ï¼šå£°æ˜ä¸€ä¸ªå¸¸é‡ <code>zombieId</code>ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºåƒµå°¸çš„ IDã€‚åœ¨ç¬¬äº”ç« ä¸­ï¼Œä½ å­¦ä¼šäº†å¦‚ä½•ä»æ—¥å¿—å’Œäº‹ä»¶ä¸­è·å–ä¿¡æ¯ã€‚éœ€è¦æ—¶ï¼Œå›é¡¾ä¸€ä¸‹ç›¸å…³å†…å®¹ã€‚ç¡®ä¿ä½¿ç”¨ <code>toNumber()</code> å°† <code>zombieId</code> è½¬æ¢ä¸ºæœ‰æ•ˆçš„æ•°å­—ã€‚</p>
</li>
<li><p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨ <code>transferFrom</code>ï¼Œå°† Alice å’Œ Bob ä½œä¸ºå‰ä¸¤ä¸ªå‚æ•°ä¼ å…¥ã€‚ç¡®ä¿ Alice è°ƒç”¨æ­¤å‡½æ•°ï¼Œå¹¶ä¸”åœ¨ç»§ç»­ä¸‹ä¸€æ­¥ä¹‹å‰ç­‰å¾…å®ƒè¿è¡Œå®Œæ¯•ã€‚</p>
</li>
<li><p>å£°æ˜ä¸€ä¸ªåä¸º <code>newOwner</code> çš„å¸¸é‡ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºè°ƒç”¨ <code>ownerOf</code>ï¼Œä¼ å…¥ <code>zombieId</code>ã€‚</p>
</li>
<li><p>æœ€åï¼Œè®©æˆ‘ä»¬æ£€æŸ¥ Bob æ˜¯å¦æ‹¥æœ‰è¯¥ ERC721 ä»£å¸ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œ <code>assert.equal(newOwner, bob)</code> æ¥éªŒè¯è¿™ä¸€ç‚¹ã€‚</p>
</li>
</ol>
<p><strong>æ³¨æ„</strong>ï¼š<code>assert.equal(newOwner, bob)</code> å’Œ <code>assert.equal(bob, newOwner)</code> åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯æˆ‘ä»¬çš„å‘½ä»¤è¡Œè§£é‡Šå™¨å¹¶ä¸æ˜¯å¾ˆé«˜çº§ï¼Œå› æ­¤é™¤éä½ è¾“å…¥ç¬¬ä¸€ä¸ªé€‰é¡¹ï¼Œå®ƒä¸ä¼šè®¤ä¸ºä½ çš„ç­”æ¡ˆæ­£ç¡®ã€‚</p>
<p>æˆ‘è¯´è¿‡å‰ä¸€æ­¥æ˜¯æœ€åä¸€æ­¥å—ï¼Ÿå¥½å§â€¦ å…¶å®é‚£æ˜¯é”™çš„ã€‚æœ€åæˆ‘ä»¬è¦åšçš„æ˜¯é€šè¿‡ç§»é™¤ <code>x</code> æ¥â€œå–æ¶ˆè·³è¿‡â€ç¬¬ä¸€ä¸ªåœºæ™¯ã€‚</p>
<p>å‘¼ï¼è¿™å·²ç»æ˜¯å¾ˆå¤šä»£ç äº†ã€‚å¸Œæœ›ä½ èƒ½åšå¯¹ã€‚å¦‚æœæ²¡æœ‰ï¼Œéšæ—¶ç‚¹å‡»â€œæ˜¾ç¤ºç­”æ¡ˆâ€ã€‚</p>
<h3 id="ç°åœ¨æˆ‘ä»¬æ¥è¿è¡Œ-truffle-testï¼Œçœ‹çœ‹æ–°çš„æµ‹è¯•æ˜¯å¦é€šè¿‡ï¼š"><a href="#ç°åœ¨æˆ‘ä»¬æ¥è¿è¡Œ-truffle-testï¼Œçœ‹çœ‹æ–°çš„æµ‹è¯•æ˜¯å¦é€šè¿‡ï¼š" class="headerlink" title="ç°åœ¨æˆ‘ä»¬æ¥è¿è¡Œ truffle testï¼Œçœ‹çœ‹æ–°çš„æµ‹è¯•æ˜¯å¦é€šè¿‡ï¼š"></a>ç°åœ¨æˆ‘ä»¬æ¥è¿è¡Œ <code>truffle test</code>ï¼Œçœ‹çœ‹æ–°çš„æµ‹è¯•æ˜¯å¦é€šè¿‡ï¼š</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livecodeserver">Contract: CryptoZombies<br>  âœ“ should be able <span class="hljs-built_in">to</span> <span class="hljs-built_in">create</span> <span class="hljs-keyword">a</span> <span class="hljs-built_in">new</span> zombie (<span class="hljs-number">146</span>ms)<br>  âœ“ should <span class="hljs-keyword">not</span> allow <span class="hljs-literal">two</span> zombies (<span class="hljs-number">235</span>ms)<br>  <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> single-step transfer scenario<br>    âœ“ should transfer <span class="hljs-keyword">a</span> zombie (<span class="hljs-number">382</span>ms)<br>  <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> <span class="hljs-literal">two</span>-step transfer scenario<br>    - should approve <span class="hljs-keyword">and</span> <span class="hljs-keyword">then</span> transfer <span class="hljs-keyword">a</span> zombie when <span class="hljs-keyword">the</span> owner calls transferFrom<br>    - should approve <span class="hljs-keyword">and</span> <span class="hljs-keyword">then</span> transfer <span class="hljs-keyword">a</span> zombie when <span class="hljs-keyword">the</span> approved address calls transferFrom<br><br><span class="hljs-number">3</span> passing (<span class="hljs-number">1</span>s)<br><span class="hljs-number">2</span> pending<br></code></pre></div></td></tr></table></figure>

<p>çœ‹ï¼æˆ‘ä»¬çš„ä»£ç æˆåŠŸé€šè¿‡äº†æµ‹è¯•ğŸ‘ğŸ»ã€‚</p>
<p>åœ¨ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†ç»§ç»­è¿›è¡Œä¸¤æ­¥åœºæ™¯ï¼Œå…¶ä¸­ <code>approve</code> åè·Ÿ <code>transferFrom</code>ã€‚</p>
<p>ç­”æ¡ˆï¼š</p>
<figure class="highlight dart"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dart"><span class="hljs-keyword">const</span> CryptoZombies = artifacts.require(<span class="hljs-string">&quot;CryptoZombies&quot;</span>);<br><span class="hljs-keyword">const</span> utils = require(<span class="hljs-string">&quot;./helpers/utils&quot;</span>);<br><span class="hljs-keyword">const</span> zombieNames = [<span class="hljs-string">&quot;Zombie 1&quot;</span>, <span class="hljs-string">&quot;Zombie 2&quot;</span>];<br>contract(<span class="hljs-string">&quot;CryptoZombies&quot;</span>, (accounts) =&gt; &#123;<br>    let [alice, bob] = accounts;<br>    let contractInstance;<br>    beforeEach(<span class="hljs-keyword">async</span> () =&gt; &#123;<br>        contractInstance = <span class="hljs-keyword">await</span> CryptoZombies.<span class="hljs-keyword">new</span>();<br>    &#125;);<br>    it(<span class="hljs-string">&quot;should be able to create a new zombie&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>        <span class="hljs-keyword">assert</span>.equal(result.receipt.status, <span class="hljs-keyword">true</span>);<br>        <span class="hljs-keyword">assert</span>.equal(result.logs[<span class="hljs-number">0</span>].args.name,zombieNames[<span class="hljs-number">0</span>]);<br>    &#125;)<br>    it(<span class="hljs-string">&quot;should not allow two zombies&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>        <span class="hljs-keyword">await</span> utils.shouldThrow(contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">1</span>], &#123;from: alice&#125;));<br>    &#125;)<br>    context(<span class="hljs-string">&quot;with the single-step transfer scenario&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        it(<span class="hljs-string">&quot;should transfer a zombie&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>          <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>            <span class="hljs-keyword">const</span> zombieId = result.logs[<span class="hljs-number">0</span>].args.zombieId.toNumber();<br>            <span class="hljs-keyword">await</span> contractInstance.transferFrom(alice, bob, zombieId, &#123;from: alice&#125;);<br>            <span class="hljs-keyword">const</span> newOwner = <span class="hljs-keyword">await</span> contractInstance.ownerOf(zombieId);<br>            <span class="hljs-keyword">assert</span>.equal(newOwner, bob);<br>        &#125;)<br>    &#125;)<br>    xcontext(<span class="hljs-string">&quot;with the two-step transfer scenario&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        it(<span class="hljs-string">&quot;should approve and then transfer a zombie when the approved address calls transferFrom&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>          <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Test the two-step scenario.  The approved address calls transferFrom</span><br>        &#125;)<br>        it(<span class="hljs-string">&quot;should approve and then transfer a zombie when the owner calls transferFrom&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>            <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Test the two-step scenario.  The owner calls transferFrom</span><br>         &#125;)<br>    &#125;)<br>&#125;)<br><br></code></pre></div></td></tr></table></figure>

<h1 id="ç¬¬10ç« ï¼šERC721-ä»£å¸è½¬ç§»-ä¸¤æ­¥åœºæ™¯"><a href="#ç¬¬10ç« ï¼šERC721-ä»£å¸è½¬ç§»-ä¸¤æ­¥åœºæ™¯" class="headerlink" title="ç¬¬10ç« ï¼šERC721 ä»£å¸è½¬ç§» - ä¸¤æ­¥åœºæ™¯"></a>ç¬¬10ç« ï¼šERC721 ä»£å¸è½¬ç§» - ä¸¤æ­¥åœºæ™¯</h1><p>ç°åœ¨ï¼Œä½¿ç”¨ <strong>approve</strong> åè·Ÿ <strong>transferFrom</strong> çš„æ–¹å¼è½¬ç§» ERC721 ä»£å¸è¿œä¸æ˜¯ä¸€ä»¶è½»æ¾çš„äº‹æƒ…ï¼Œä½†æˆ‘åœ¨è¿™é‡Œå¸®åŠ©ä½ ã€‚</p>
<p>ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬éœ€è¦æµ‹è¯•ä¸¤ç§ä¸åŒçš„åœºæ™¯ï¼š</p>
<ol>
<li><strong>Alice æ‰¹å‡† Bob è½¬ç§» ERC721 ä»£å¸</strong>ï¼Œç„¶åç”± Bobï¼ˆè¢«æ‰¹å‡†çš„åœ°å€ï¼‰è°ƒç”¨ <code>transferFrom</code>ã€‚</li>
<li><strong>Alice æ‰¹å‡† Bob è½¬ç§» ERC721 ä»£å¸</strong>ï¼Œç„¶åç”± Alice è‡ªå·±è°ƒç”¨ <code>transferFrom</code>ã€‚</li>
</ol>
<p>è¿™ä¸¤ç§åœºæ™¯çš„åŒºåˆ«åœ¨äºè°æ¥æ‰§è¡Œå®é™…çš„è½¬ç§»æ“ä½œï¼Œæ˜¯ Alice è¿˜æ˜¯ Bobã€‚</p>
<p>çœ‹èµ·æ¥æˆ‘ä»¬å·²ç»å°†å…¶ç®€åŒ–äº†ï¼Œå¯¹å§ï¼Ÿ</p>
<h3 id="è®©æˆ‘ä»¬æ¥çœ‹ç¬¬ä¸€ä¸ªåœºæ™¯ï¼š"><a href="#è®©æˆ‘ä»¬æ¥çœ‹ç¬¬ä¸€ä¸ªåœºæ™¯ï¼š" class="headerlink" title="è®©æˆ‘ä»¬æ¥çœ‹ç¬¬ä¸€ä¸ªåœºæ™¯ï¼š"></a>è®©æˆ‘ä»¬æ¥çœ‹ç¬¬ä¸€ä¸ªåœºæ™¯ï¼š</h3><h4 id="Bob-è°ƒç”¨-transferFrom"><a href="#Bob-è°ƒç”¨-transferFrom" class="headerlink" title="Bob è°ƒç”¨ transferFrom"></a>Bob è°ƒç”¨ <code>transferFrom</code></h4><p>è¿™ä¸ªåœºæ™¯çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>Alice åˆ›å»ºä¸€ä¸ªæ–°çš„ ERC721 ä»£å¸ï¼Œç„¶åè°ƒç”¨ <code>approve</code>ã€‚</li>
<li>æ¥ä¸‹æ¥ï¼ŒBob æ‰§è¡Œ <code>transferFrom</code>ï¼Œè¿™åº”è¯¥ä½¿ä»–æˆä¸ºè¯¥ ERC721 ä»£å¸çš„æ‰€æœ‰è€…ã€‚</li>
<li>æœ€åï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨ <code>assert.equal</code>ï¼Œæ£€æŸ¥ <code>newOwner</code> æ˜¯å¦ç­‰äº Bobã€‚</li>
</ol>
<h3 id="æµ‹è¯•ä¸€ä¸‹-3"><a href="#æµ‹è¯•ä¸€ä¸‹-3" class="headerlink" title="æµ‹è¯•ä¸€ä¸‹"></a>æµ‹è¯•ä¸€ä¸‹</h3><p>æˆ‘ä»¬æµ‹è¯•çš„å‰ä¸¤è¡Œä»£ç å’Œä¹‹å‰çš„æµ‹è¯•ç±»ä¼¼ã€‚æˆ‘ä»¬å·²ç»ä¸ºä½ å¤åˆ¶å¹¶ç²˜è´´äº†å®ƒä»¬ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œä¸ºäº†è®© Bob è¢«æ‰¹å‡†è½¬ç§» ERC721 ä»£å¸ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨ <code>approve()</code>ã€‚è¯¥å‡½æ•°æ¥æ”¶ Bob å’Œ <code>zombieId</code> ä½œä¸ºå‚æ•°ã€‚å¹¶ç¡®ä¿ Alice è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼ˆå› ä¸ºæ˜¯å¥¹çš„ ERC721 ä»£å¸å°†è¢«è½¬ç§»ï¼‰ã€‚</p>
<p>æ¥ä¸‹æ¥çš„ä¸‰è¡Œä»£ç ä¸ä¹‹å‰çš„æµ‹è¯•å‡ ä¹ç›¸åŒã€‚æˆ‘ä»¬å·²ç»ä¸ºä½ å¤åˆ¶å¹¶ç²˜è´´äº†å®ƒä»¬ã€‚è®©æˆ‘ä»¬æ›´æ–° <code>transferFrom()</code> çš„è°ƒç”¨ï¼Œç¡®ä¿å‘é€è€…æ˜¯ Bobã€‚</p>
<p>æœ€åï¼Œè®©æˆ‘ä»¬å–æ¶ˆè·³è¿‡è¿™ä¸ªåœºæ™¯ï¼Œå¹¶è·³è¿‡æœ€åä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹â€”â€”é‚£ä¸ªæˆ‘ä»¬è¿˜æ²¡æœ‰ç¼–å†™çš„æµ‹è¯•ã€‚</p>
<h3 id="è¿è¡Œ-truffle-testï¼Œçœ‹çœ‹æˆ‘ä»¬çš„æµ‹è¯•æ˜¯å¦é€šè¿‡ï¼š"><a href="#è¿è¡Œ-truffle-testï¼Œçœ‹çœ‹æˆ‘ä»¬çš„æµ‹è¯•æ˜¯å¦é€šè¿‡ï¼š" class="headerlink" title="è¿è¡Œ truffle testï¼Œçœ‹çœ‹æˆ‘ä»¬çš„æµ‹è¯•æ˜¯å¦é€šè¿‡ï¼š"></a>è¿è¡Œ <code>truffle test</code>ï¼Œçœ‹çœ‹æˆ‘ä»¬çš„æµ‹è¯•æ˜¯å¦é€šè¿‡ï¼š</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livecodeserver">Contract: CryptoZombies<br>    âœ“ should be able <span class="hljs-built_in">to</span> <span class="hljs-built_in">create</span> <span class="hljs-keyword">a</span> <span class="hljs-built_in">new</span> zombie (<span class="hljs-number">218</span>ms)<br>    âœ“ should <span class="hljs-keyword">not</span> allow <span class="hljs-literal">two</span> zombies (<span class="hljs-number">175</span>ms)<br>    <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> single-step transfer scenario<br>      âœ“ should transfer <span class="hljs-keyword">a</span> zombie (<span class="hljs-number">334</span>ms)<br>    <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> <span class="hljs-literal">two</span>-step transfer scenario<br>      âœ“ should approve <span class="hljs-keyword">and</span> <span class="hljs-keyword">then</span> transfer <span class="hljs-keyword">a</span> zombie when <span class="hljs-keyword">the</span> owner calls transferFrom (<span class="hljs-number">360</span>ms)<br>      - should approve <span class="hljs-keyword">and</span> <span class="hljs-keyword">then</span> transfer <span class="hljs-keyword">a</span> zombie when <span class="hljs-keyword">the</span> approved address calls transferFrom<br><br>  <span class="hljs-number">4</span> passing (<span class="hljs-number">2</span>s)<br>  <span class="hljs-number">1</span> pending<br></code></pre></div></td></tr></table></figure>

<p><strong>å¤ªæ£’äº†ï¼</strong> ç°åœ¨ï¼Œæˆ‘ä»¬è¿›å…¥ä¸‹ä¸€ä¸ªæµ‹è¯•ã€‚</p>
<p>ç­”æ¡ˆï¼š</p>
<figure class="highlight livescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livescript"><span class="hljs-keyword">const</span> CryptoZombies = artifacts.<span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;CryptoZombies&quot;</span>);<br><span class="hljs-keyword">const</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./helpers/utils&quot;</span>);<br><span class="hljs-keyword">const</span> zombieNames = [<span class="hljs-string">&quot;Zombie 1&quot;</span>, <span class="hljs-string">&quot;Zombie 2&quot;</span>];<br>contract(<span class="hljs-string">&quot;CryptoZombies&quot;</span>, (accounts) =&gt; &#123;<br>    <span class="hljs-keyword">let</span> [alice, bob] = accounts;<br>    <span class="hljs-keyword">let</span> contractInstance;<br>    beforeEach(<span class="hljs-keyword">async</span> () =&gt; &#123;<br>        contractInstance = <span class="hljs-keyword">await</span> CryptoZombies.<span class="hljs-keyword">new</span>();<br>    &#125;);<br>    <span class="hljs-literal">it</span>(<span class="hljs-string">&quot;should be able to create a new zombie&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>        assert.equal(result.receipt.status, <span class="hljs-literal">true</span>);<br>        assert.equal(result.logs[<span class="hljs-number">0</span>].args.name,zombieNames[<span class="hljs-number">0</span>]);<br>    &#125;)<br>    <span class="hljs-literal">it</span>(<span class="hljs-string">&quot;should not allow two zombies&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>        <span class="hljs-keyword">await</span> utils.shouldThrow(contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">1</span>], &#123;from: alice&#125;));<br>    &#125;)<br>    context(<span class="hljs-string">&quot;with the single-step transfer scenario&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-literal">it</span>(<span class="hljs-string">&quot;should transfer a zombie&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>            <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>            <span class="hljs-keyword">const</span> zombieId = result.logs[<span class="hljs-number">0</span>].args.zombieId.toNumber();<br>            <span class="hljs-keyword">await</span> contractInstance.transferFrom(alice, bob, zombieId, &#123;from: alice&#125;);<br>            <span class="hljs-keyword">const</span> newOwner = <span class="hljs-keyword">await</span> contractInstance.ownerOf(zombieId);<br>            assert.equal(newOwner, bob);<br>        &#125;)<br>    &#125;)<br>    context(<span class="hljs-string">&quot;with the two-step transfer scenario&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-literal">it</span>(<span class="hljs-string">&quot;should approve and then transfer a zombie when the approved address calls transferFrom&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>            <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>            <span class="hljs-keyword">const</span> zombieId = result.logs[<span class="hljs-number">0</span>].args.zombieId.toNumber();<br>            <span class="hljs-keyword">await</span> contractInstance.approve(bob, zombieId, &#123;from: alice&#125;);<br>            <span class="hljs-keyword">await</span> contractInstance.transferFrom(alice, bob, zombieId, &#123;from: bob&#125;);<br>            <span class="hljs-keyword">const</span> newOwner = <span class="hljs-keyword">await</span> contractInstance.ownerOf(zombieId);<br>            assert.equal(newOwner,bob);<br>        &#125;)<br>        xit(<span class="hljs-string">&quot;should approve and then transfer a zombie when the owner calls transferFrom&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>         &#125;)<br>    &#125;)<br>&#125;)<br></code></pre></div></td></tr></table></figure>

<h1 id="ç¬¬11ç« ï¼šERC721-ä»£å¸è½¬ç§»-ä¸¤æ­¥åœºæ™¯ï¼ˆç»­ï¼‰"><a href="#ç¬¬11ç« ï¼šERC721-ä»£å¸è½¬ç§»-ä¸¤æ­¥åœºæ™¯ï¼ˆç»­ï¼‰" class="headerlink" title="ç¬¬11ç« ï¼šERC721 ä»£å¸è½¬ç§» - ä¸¤æ­¥åœºæ™¯ï¼ˆç»­ï¼‰"></a>ç¬¬11ç« ï¼šERC721 ä»£å¸è½¬ç§» - ä¸¤æ­¥åœºæ™¯ï¼ˆç»­ï¼‰</h1><p>æˆ‘ä»¬å¿«å®Œæˆè½¬ç§»çš„æµ‹è¯•äº†ï¼ç°åœ¨æˆ‘ä»¬æ¥æµ‹è¯• Alice è°ƒç”¨ <code>transferFrom</code> çš„åœºæ™¯ã€‚</p>
<p>æœ‰ä¸€ä¸ªå¥½æ¶ˆæ¯â€”â€”è¿™ä¸ªæµ‹è¯•éå¸¸ç®€å•ã€‚ä½ åªéœ€è¦å¤åˆ¶å¹¶ç²˜è´´å‰ä¸€ç« èŠ‚çš„ä»£ç ï¼Œç„¶åè®© Aliceï¼ˆè€Œä¸æ˜¯ Bobï¼‰è°ƒç”¨ <code>transferFrom</code>ã€‚</p>
<h3 id="åŠ¨æ‰‹å®è·µ"><a href="#åŠ¨æ‰‹å®è·µ" class="headerlink" title="åŠ¨æ‰‹å®è·µ"></a>åŠ¨æ‰‹å®è·µ</h3><p>å¤åˆ¶å¹¶ç²˜è´´å‰ä¸€ä¸ªæµ‹è¯•çš„ä»£ç ï¼Œå¹¶è®© Alice è°ƒç”¨ <code>transferFrom</code>ã€‚<br>â€œå–æ¶ˆè·³è¿‡â€è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ã€‚</p>
<p>å¦‚æœä½ è¿è¡Œ <code>truffle test</code>ï¼Œè¾“å‡ºå°†ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livecodeserver">Contract: CryptoZombies<br>    âœ“ should be able <span class="hljs-built_in">to</span> <span class="hljs-built_in">create</span> <span class="hljs-keyword">a</span> <span class="hljs-built_in">new</span> zombie (<span class="hljs-number">201</span>ms)<br>    âœ“ should <span class="hljs-keyword">not</span> allow <span class="hljs-literal">two</span> zombies (<span class="hljs-number">486</span>ms)<br>    âœ“ should <span class="hljs-literal">return</span> <span class="hljs-keyword">the</span> correct owner (<span class="hljs-number">382</span>ms)<br>    <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> single-step transfer scenario<br>      âœ“ should transfer <span class="hljs-keyword">a</span> zombie (<span class="hljs-number">337</span>ms)<br>    <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> <span class="hljs-literal">two</span>-step transfer scenario<br>      âœ“ should approve <span class="hljs-keyword">and</span> <span class="hljs-keyword">then</span> transfer <span class="hljs-keyword">a</span> zombie when <span class="hljs-keyword">the</span> approved address calls transferFrom (<span class="hljs-number">266</span>ms)<br>  <span class="hljs-number">5</span> passing (<span class="hljs-number">3</span>s)<br></code></pre></div></td></tr></table></figure>

<p>æˆ‘æƒ³ä¸å‡ºè¿˜æœ‰ä»€ä¹ˆå’Œè½¬ç§»ç›¸å…³çš„æµ‹è¯•ï¼Œæ‰€ä»¥æˆ‘ä»¬æš‚æ—¶å°±åˆ°è¿™é‡Œã€‚</p>
<p>ç­”æ¡ˆï¼š</p>
<figure class="highlight livescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livescript"><span class="hljs-keyword">const</span> CryptoZombies = artifacts.<span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;CryptoZombies&quot;</span>);<br><span class="hljs-keyword">const</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./helpers/utils&quot;</span>);<br><span class="hljs-keyword">const</span> zombieNames = [<span class="hljs-string">&quot;Zombie 1&quot;</span>, <span class="hljs-string">&quot;Zombie 2&quot;</span>];<br>contract(<span class="hljs-string">&quot;CryptoZombies&quot;</span>, (accounts) =&gt; &#123;<br>    <span class="hljs-keyword">let</span> [alice, bob] = accounts;<br>    <span class="hljs-keyword">let</span> contractInstance;<br>    beforeEach(<span class="hljs-keyword">async</span> () =&gt; &#123;<br>        contractInstance = <span class="hljs-keyword">await</span> CryptoZombies.<span class="hljs-keyword">new</span>();<br>    &#125;);<br>    <span class="hljs-literal">it</span>(<span class="hljs-string">&quot;should be able to create a new zombie&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>        assert.equal(result.receipt.status, <span class="hljs-literal">true</span>);<br>        assert.equal(result.logs[<span class="hljs-number">0</span>].args.name,zombieNames[<span class="hljs-number">0</span>]);<br>    &#125;)<br>    <span class="hljs-literal">it</span>(<span class="hljs-string">&quot;should not allow two zombies&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>        <span class="hljs-keyword">await</span> utils.shouldThrow(contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">1</span>], &#123;from: alice&#125;));<br>    &#125;)<br>    context(<span class="hljs-string">&quot;with the single-step transfer scenario&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-literal">it</span>(<span class="hljs-string">&quot;should transfer a zombie&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>            <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>            <span class="hljs-keyword">const</span> zombieId = result.logs[<span class="hljs-number">0</span>].args.zombieId.toNumber();<br>            <span class="hljs-keyword">await</span> contractInstance.transferFrom(alice, bob, zombieId, &#123;from: alice&#125;);<br>            <span class="hljs-keyword">const</span> newOwner = <span class="hljs-keyword">await</span> contractInstance.ownerOf(zombieId);<br>            assert.equal(newOwner, bob);<br>        &#125;)<br>    &#125;)<br>    context(<span class="hljs-string">&quot;with the two-step transfer scenario&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-literal">it</span>(<span class="hljs-string">&quot;should approve and then transfer a zombie when the approved address calls transferFrom&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>            <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>            <span class="hljs-keyword">const</span> zombieId = result.logs[<span class="hljs-number">0</span>].args.zombieId.toNumber();<br>            <span class="hljs-keyword">await</span> contractInstance.approve(bob, zombieId, &#123;from: alice&#125;);<br>            <span class="hljs-keyword">await</span> contractInstance.transferFrom(alice, bob, zombieId, &#123;from: bob&#125;);<br>            <span class="hljs-keyword">const</span> newOwner = <span class="hljs-keyword">await</span> contractInstance.ownerOf(zombieId);<br>            assert.equal(newOwner,bob);<br>        &#125;)<br>        <span class="hljs-literal">it</span>(<span class="hljs-string">&quot;should approve and then transfer a zombie when the owner calls transferFrom&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>            <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>            <span class="hljs-keyword">const</span> zombieId = result.logs[<span class="hljs-number">0</span>].args.zombieId.toNumber();<br>            <span class="hljs-keyword">await</span> contractInstance.approve(bob, zombieId, &#123;from: alice&#125;);<br>            <span class="hljs-keyword">await</span> contractInstance.transferFrom(alice, bob, zombieId, &#123;from: alice&#125;);<br>            <span class="hljs-keyword">const</span> newOwner = <span class="hljs-keyword">await</span> contractInstance.ownerOf(zombieId);<br>            assert.equal(newOwner,bob);<br>         &#125;)<br>    &#125;)<br>&#125;)<br><br></code></pre></div></td></tr></table></figure>

<h1 id="ç¬¬12ç« ï¼šåƒµå°¸æ”»å‡»"><a href="#ç¬¬12ç« ï¼šåƒµå°¸æ”»å‡»" class="headerlink" title="ç¬¬12ç« ï¼šåƒµå°¸æ”»å‡»"></a>ç¬¬12ç« ï¼šåƒµå°¸æ”»å‡»</h1><p>å“‡ï¼å‰å‡ ç« å†…å®¹éå¸¸å……å®ï¼Œæˆ‘ä»¬å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å°±å®Œæˆäº†æ‰€æœ‰çš„åœºæ™¯å—ï¼Ÿä¸ï¼Œè¿˜æ²¡æœ‰ã€‚æˆ‘ä»¬æŠŠæœ€ç²¾å½©çš„éƒ¨åˆ†ç•™åˆ°äº†æœ€åã€‚</p>
<p>æˆ‘ä»¬å·²ç»æ„å»ºäº†ä¸€ä¸ªåƒµå°¸æ¸¸æˆï¼Œè€Œæœ€ç²¾å½©çš„éƒ¨åˆ†è«è¿‡äºåƒµå°¸ä»¬äº’ç›¸æˆ˜æ–—ï¼Œå¯¹å§ï¼Ÿ</p>
<p>è¿™ä¸ªæµ‹è¯•ç›¸å½“ç®€å•ï¼ŒåŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>é¦–å…ˆï¼Œæˆ‘ä»¬ä¸º Alice å’Œ Bob å„åˆ›å»ºä¸€ä¸ªæ–°çš„åƒµå°¸ã€‚</li>
<li>ç„¶åï¼ŒAlice ä½¿ç”¨ Bob çš„åƒµå°¸ ID ä½œä¸ºå‚æ•°è¿è¡Œæ”»å‡»ã€‚</li>
<li>æœ€åï¼Œä¸ºäº†ä½¿æµ‹è¯•é€šè¿‡ï¼Œæˆ‘ä»¬å°†æ£€æŸ¥ <code>result.receipt.status</code> æ˜¯å¦ä¸º <code>true</code>ã€‚</li>
</ol>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘å·²ç»å¿«é€Ÿå†™å¥½äº†æ‰€æœ‰çš„é€»è¾‘ï¼Œå¹¶å°†å…¶åŒ…è£¹åœ¨ <code>it()</code> å‡½æ•°ä¸­ï¼Œç„¶åè¿è¡Œäº† <code>truffle test</code>ã€‚</p>
<p>è¾“å‡ºçœ‹èµ·æ¥åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livecodeserver">Contract: CryptoZombies<br>    âœ“ should be able <span class="hljs-built_in">to</span> <span class="hljs-built_in">create</span> <span class="hljs-keyword">a</span> <span class="hljs-built_in">new</span> zombie (<span class="hljs-number">102</span>ms)<br>    âœ“ should <span class="hljs-keyword">not</span> allow <span class="hljs-literal">two</span> zombies (<span class="hljs-number">321</span>ms)<br>    âœ“ should <span class="hljs-literal">return</span> <span class="hljs-keyword">the</span> correct owner (<span class="hljs-number">333</span>ms)<br>    <span class="hljs-number">1</span>) zombies should be able <span class="hljs-built_in">to</span> attack another zombie<br>    <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> single-step transfer scenario<br>      âœ“ should transfer <span class="hljs-keyword">a</span> zombie (<span class="hljs-number">307</span>ms)<br>    <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> <span class="hljs-literal">two</span>-step transfer scenario<br>      âœ“ should approve <span class="hljs-keyword">and</span> <span class="hljs-keyword">then</span> transfer <span class="hljs-keyword">a</span> zombie when <span class="hljs-keyword">the</span> owner calls transferFrom (<span class="hljs-number">357</span>ms)<br></code></pre></div></td></tr></table></figure>

<p><strong>å“å‘€</strong>ï¼Œæˆ‘ä»¬çš„æµ‹è¯•å¤±è´¥äº†â˜¹ï¸ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆä¼šå¤±è´¥å‘¢ï¼Ÿ</strong></p>
<p>è®©æˆ‘ä»¬æ¥ææ¸…æ¥šã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ¥ä»”ç»†çœ‹çœ‹ <code>createRandomZombie()</code> çš„ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs solidity">function createRandomZombie(string _name) public &#123;<br>  require(ownerZombieCount[msg.sender] == 0);<br>  uint randDna = _generateRandomDna(_name);<br>  randDna = randDna - randDna % 100;<br>  _createZombie(_name, randDna);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>åˆ°ç›®å‰ä¸ºæ­¢éƒ½æ²¡æœ‰é—®é¢˜ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŸ¥çœ‹ <code>_createZombie()</code> çš„ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs solidity">function _createZombie(string _name, uint _dna) internal &#123;<br>  uint id = zombies.push(Zombie(_name, _dna, 1, uint32(now + cooldownTime), 0, 0)) - 1;<br>  zombieToOwner[id] = msg.sender;<br>  ownerZombieCount[msg.sender] = ownerZombieCount[msg.sender].add(1);<br>  emit NewZombie(id, _name, _dna);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>å“¦ï¼Œä½ çœ‹åˆ°äº†é—®é¢˜äº†å—ï¼Ÿ</p>
<p>æˆ‘ä»¬çš„æµ‹è¯•å¤±è´¥äº†ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨æ¸¸æˆä¸­åŠ å…¥äº†å†·å´æ—¶é—´ï¼Œå¹¶ä¸”è®©åƒµå°¸åœ¨æ”»å‡»ï¼ˆæˆ–å–‚é£Ÿï¼‰åå¿…é¡»ç­‰ 1 å¤©æ‰èƒ½å†æ¬¡æ”»å‡»ã€‚</p>
<p>å¦‚æœæ²¡æœ‰è¿™ä¸ªå†·å´æœŸï¼Œåƒµå°¸æ¯å¤©å¯ä»¥è¿›è¡Œæ— é™æ¬¡æ”»å‡»å’Œç¹æ®–ï¼Œè¿™ä¼šè®©æ¸¸æˆå˜å¾—éå¸¸ç®€å•ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨è¯¥æ€ä¹ˆåŠå‘¢â€¦ ç­‰ä¸€å¤©å—ï¼Ÿ</p>
<h3 id="æ—¶é—´æ—…è¡Œ"><a href="#æ—¶é—´æ—…è¡Œ" class="headerlink" title="æ—¶é—´æ—…è¡Œ"></a>æ—¶é—´æ—…è¡Œ</h3><p>å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸å¿…ç­‰è¿™ä¹ˆä¹…ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬æ ¹æœ¬ä¸éœ€è¦ç­‰å¾…ã€‚å› ä¸º <strong>Ganache</strong> æä¾›äº†é€šè¿‡ä¸¤ä¸ªè¾…åŠ©å‡½æ•°å®ç°æ—¶é—´å‰è¿›çš„æ–¹å¼ï¼š</p>
<ul>
<li><code>evm_increaseTime</code>ï¼šå¢åŠ ä¸‹ä¸€ä¸ªåŒºå—çš„æ—¶é—´ã€‚</li>
<li><code>evm_mine</code>ï¼šæŒ–æ˜ä¸€ä¸ªæ–°çš„åŒºå—ã€‚</li>
</ul>
<p>ä½ ç”šè‡³ä¸éœ€è¦ Tardis æˆ– DeLorean å°±èƒ½å®ç°è¿™ç§æ—¶é—´æ—…è¡Œã€‚</p>
<p>è®©æˆ‘è§£é‡Šä¸€ä¸‹è¿™äº›å‡½æ•°æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p>
<p>æ¯å½“ä¸€ä¸ªæ–°åŒºå—è¢«æŒ–æ˜æ—¶ï¼ŒçŸ¿å·¥ä¼šç»™å®ƒåŠ ä¸Šä¸€ä¸ªæ—¶é—´æˆ³ã€‚å‡è®¾åˆ›å»ºæˆ‘ä»¬çš„åƒµå°¸çš„äº¤æ˜“åœ¨åŒºå— 5 ä¸­è¢«æŒ–æ˜ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è°ƒç”¨ <code>evm_increaseTime</code>ï¼Œä½†æ˜¯ç”±äºåŒºå—é“¾æ˜¯ä¸å¯å˜çš„ï¼Œæ— æ³•ä¿®æ”¹ç°æœ‰åŒºå—ã€‚å› æ­¤ï¼Œå½“åˆçº¦æ£€æŸ¥æ—¶é—´æ—¶ï¼Œå®ƒä¸ä¼šå¢åŠ ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬è¿è¡Œ <code>evm_mine</code>ï¼ŒåŒºå— 6 ä¼šè¢«æŒ–æ˜ï¼ˆå¹¶åŠ ä¸Šæ—¶é—´æˆ³ï¼‰ï¼Œè¿™æ„å‘³ç€å½“æˆ‘ä»¬è®©åƒµå°¸å¼€å§‹æˆ˜æ–—æ—¶ï¼Œæ™ºèƒ½åˆçº¦å°†â€œçœ‹åˆ°â€ä¸€å¤©å·²ç»è¿‡å»ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥ä¿®å¤æˆ‘ä»¬çš„æµ‹è¯•ï¼Œè¿›è¡Œæ—¶é—´æ—…è¡Œï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">await</span> web3.<span class="hljs-property">currentProvider</span>.<span class="hljs-title function_">sendAsync</span>(&#123;<br>  <span class="hljs-attr">jsonrpc</span>: <span class="hljs-string">&quot;2.0&quot;</span>,<br>  <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;evm_increaseTime&quot;</span>,<br>  <span class="hljs-attr">params</span>: [<span class="hljs-number">86400</span>],  <span class="hljs-comment">// ä¸€å¤©æœ‰ 86400 ç§’</span><br>  <span class="hljs-attr">id</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>()<br>&#125;, <span class="hljs-function">() =&gt;</span> &#123; &#125;);<br><br>web3.<span class="hljs-property">currentProvider</span>.<span class="hljs-title function_">send</span>(&#123;<br>    <span class="hljs-attr">jsonrpc</span>: <span class="hljs-string">&#x27;2.0&#x27;</span>,<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;evm_mine&#x27;</span>,<br>    <span class="hljs-attr">params</span>: [],<br>    <span class="hljs-attr">id</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>()<br>&#125;);<br></code></pre></div></td></tr></table></figure>

<p>æ˜¯çš„ï¼Œè¿™æ˜¯ä¸€æ®µä¸é”™çš„ä»£ç ï¼Œä½†æˆ‘ä»¬ä¸å¸Œæœ›å°†è¿™ä¸ªé€»è¾‘ç›´æ¥åŠ åˆ°æˆ‘ä»¬çš„ <code>CryptoZombies.js</code> æ–‡ä»¶ä¸­ã€‚</p>
<p>æˆ‘ä»¬å·²ç»å°†æ‰€æœ‰å†…å®¹ç§»åˆ°äº†ä¸€ä¸ªåä¸º <code>helpers/time.js</code> çš„æ–°æ–‡ä»¶ä¸­ã€‚è¦å¢åŠ æ—¶é—´ï¼Œä½ åªéœ€è¦è°ƒç”¨ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">time.<span class="hljs-title function_">increaseTime</span>(<span class="hljs-number">86400</span>);<br></code></pre></div></td></tr></table></figure>

<p>å—¯ï¼Œè¿™æ ·è¿˜ä¸å¤Ÿå¥½ã€‚æ¯•ç«Ÿï¼Œæˆ‘ä»¬æ€ä¹ˆèƒ½æŒ‡æœ›ä½ èƒ½éšä¾¿è®°ä½ä¸€å¤©æœ‰å¤šå°‘ç§’å‘¢ï¼Ÿ</p>
<p>å½“ç„¶ä¸èƒ½ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æ·»åŠ äº†å¦ä¸€ä¸ªè¾…åŠ©å‡½æ•° <code>days</code>ï¼Œå®ƒæ¥å—ä½ æƒ³å¢åŠ çš„å¤©æ•°ä½œä¸ºå‚æ•°ã€‚ä½ å¯ä»¥è¿™æ ·è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">await</span> time.<span class="hljs-title function_">increase</span>(time.<span class="hljs-property">duration</span>.<span class="hljs-title function_">days</span>(<span class="hljs-number">1</span>));<br></code></pre></div></td></tr></table></figure>

<p><strong>æ³¨æ„</strong>ï¼šæ˜¾ç„¶ï¼Œæ—¶é—´æ—…è¡Œåœ¨ä¸»ç½‘æˆ–ä»»ä½•ç”±çŸ¿å·¥ä¿æŠ¤çš„æµ‹è¯•é“¾ä¸Šéƒ½æ˜¯ä¸å¯ç”¨çš„ã€‚å¦‚æœä»»ä½•äººéƒ½èƒ½éšä¾¿æ”¹å˜ç°å®ä¸–ç•Œçš„æ—¶é—´æ“ä½œï¼Œé‚£å°†ä¼šæå¾—ä¸€å›¢ç³Ÿï¼ä½†å¯¹äºæµ‹è¯•æ™ºèƒ½åˆçº¦æ¥è¯´ï¼Œæ—¶é—´æ—…è¡Œæ˜¯å¼€å‘è€…å·¥å…·ç®±ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚</p>
<h3 id="æµ‹è¯•ä¸€ä¸‹-4"><a href="#æµ‹è¯•ä¸€ä¸‹-4" class="headerlink" title="æµ‹è¯•ä¸€ä¸‹"></a>æµ‹è¯•ä¸€ä¸‹</h3><p>æˆ‘ä»¬å·²ç»ä¸ºä½ å¡«å……äº†é‚£ä¸ªå¤±è´¥çš„æµ‹è¯•ç‰ˆæœ¬ã€‚</p>
<p>æ»šåŠ¨åˆ°æˆ‘ä»¬ä¸ºä½ ç•™ä¸‹çš„æ³¨é‡Šã€‚æ¥ä¸‹æ¥ï¼Œé€šè¿‡è¿è¡Œ <code>await time.increase</code> ä¿®å¤æµ‹è¯•ç”¨ä¾‹ï¼Œåƒä¸Šé¢æ‰€ç¤ºé‚£æ ·ã€‚</p>
<p>æˆ‘ä»¬ä¸€åˆ‡å‡†å¤‡å¥½äº†ã€‚ç°åœ¨è®©æˆ‘ä»¬è¿è¡Œ <code>truffle test</code>ï¼š</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livecodeserver">Contract: CryptoZombies<br>    âœ“ should be able <span class="hljs-built_in">to</span> <span class="hljs-built_in">create</span> <span class="hljs-keyword">a</span> <span class="hljs-built_in">new</span> zombie (<span class="hljs-number">119</span>ms)<br>    âœ“ should <span class="hljs-keyword">not</span> allow <span class="hljs-literal">two</span> zombies (<span class="hljs-number">112</span>ms)<br>    âœ“ should <span class="hljs-literal">return</span> <span class="hljs-keyword">the</span> correct owner (<span class="hljs-number">109</span>ms)<br>    âœ“ zombies should be able <span class="hljs-built_in">to</span> attack another zombie (<span class="hljs-number">475</span>ms)<br>    <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> single-step transfer scenario<br>      âœ“ should transfer <span class="hljs-keyword">a</span> zombie (<span class="hljs-number">235</span>ms)<br>    <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> <span class="hljs-literal">two</span>-step transfer scenario<br>      âœ“ should approve <span class="hljs-keyword">and</span> <span class="hljs-keyword">then</span> transfer <span class="hljs-keyword">a</span> zombie when <span class="hljs-keyword">the</span> owner calls transferFrom (<span class="hljs-number">181</span>ms)<br>      âœ“ should approve <span class="hljs-keyword">and</span> <span class="hljs-keyword">then</span> transfer <span class="hljs-keyword">a</span> zombie when <span class="hljs-keyword">the</span> approved address calls transferFrom (<span class="hljs-number">152</span>ms)<br></code></pre></div></td></tr></table></figure>

<p>å°±è¿™æ ·ï¼è¿™æ˜¯æœ¬ç« çš„æœ€åä¸€æ­¥ã€‚</p>
<h1 id="ç¬¬13ç« ï¼šä½¿ç”¨-Chai-è¿›è¡Œæ›´å…·è¡¨è¾¾åŠ›çš„æ–­è¨€"><a href="#ç¬¬13ç« ï¼šä½¿ç”¨-Chai-è¿›è¡Œæ›´å…·è¡¨è¾¾åŠ›çš„æ–­è¨€" class="headerlink" title="ç¬¬13ç« ï¼šä½¿ç”¨ Chai è¿›è¡Œæ›´å…·è¡¨è¾¾åŠ›çš„æ–­è¨€"></a>ç¬¬13ç« ï¼šä½¿ç”¨ Chai è¿›è¡Œæ›´å…·è¡¨è¾¾åŠ›çš„æ–­è¨€</h1><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨å†…ç½®çš„ <code>assert</code> æ¨¡å—æ¥ç¼–å†™æ–­è¨€ã€‚è™½ç„¶ <code>assert</code> æ¨¡å—å¹¶ä¸å·®ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªé‡å¤§ç¼ºç‚¹â€”â€”ä»£ç çš„å¯è¯»æ€§å·®ã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰å‡ ä¸ªæ›´å¥½çš„æ–­è¨€æ¨¡å—ï¼Œå…¶ä¸­ <strong>Chai</strong> æ˜¯æœ€æ£’çš„ä¹‹ä¸€ã€‚</p>
<h3 id="Chai-æ–­è¨€åº“"><a href="#Chai-æ–­è¨€åº“" class="headerlink" title="Chai æ–­è¨€åº“"></a>Chai æ–­è¨€åº“</h3><p>Chai éå¸¸å¼ºå¤§ï¼Œè€ƒè™‘åˆ°æœ¬è¯¾çš„èŒƒå›´ï¼Œæˆ‘ä»¬è¿™é‡Œåªæ˜¯ç®€å•ä»‹ç»ä¸€ä¸‹ã€‚å®Œæˆè¿™èŠ‚è¯¾åï¼Œéšæ—¶å¯ä»¥æŸ¥çœ‹ä»–ä»¬çš„æ–‡æ¡£æ¥è¿›ä¸€æ­¥å­¦ä¹ ã€‚</p>
<p>è¯è™½å¦‚æ­¤ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ Chai ä¸­åŒ…å«çš„ä¸‰ç§æ–­è¨€é£æ ¼ï¼š</p>
<h4 id="1-expectï¼š"><a href="#1-expectï¼š" class="headerlink" title="1. expectï¼š"></a>1. <strong>expect</strong>ï¼š</h4><p>å…è®¸ä½ åƒä¸‹è¿°é‚£æ ·é“¾å¼è°ƒç”¨è‡ªç„¶è¯­è¨€çš„æ–­è¨€ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> lessonTitle = <span class="hljs-string">&quot;Testing Smart Contracts with Truffle&quot;</span>;<br><span class="hljs-title function_">expect</span>(lessonTitle).<span class="hljs-property">to</span>.<span class="hljs-property">be</span>.<span class="hljs-title function_">a</span>(<span class="hljs-string">&quot;string&quot;</span>);<br></code></pre></div></td></tr></table></figure>

<h4 id="2-shouldï¼š"><a href="#2-shouldï¼š" class="headerlink" title="2. shouldï¼š"></a>2. <strong>should</strong>ï¼š</h4><p>æä¾›äº†ç±»ä¼¼ <code>expect</code> æ¥å£çš„æ–­è¨€ï¼Œä½†é“¾å¼è°ƒç”¨æ˜¯ä» <code>should</code> å±æ€§å¼€å§‹çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> lessonTitle = <span class="hljs-string">&quot;Testing Smart Contracts with Truffle&quot;</span>;<br>lessonTitle.<span class="hljs-property">should</span>.<span class="hljs-property">be</span>.<span class="hljs-title function_">a</span>(<span class="hljs-string">&quot;string&quot;</span>);<br></code></pre></div></td></tr></table></figure>

<h4 id="3-assertï¼š"><a href="#3-assertï¼š" class="headerlink" title="3. assertï¼š"></a>3. <strong>assert</strong>ï¼š</h4><p>æä¾›äº†ä¸ node.js ä¸­çš„æ–­è¨€ç±»ä¼¼çš„è¯­æ³•ï¼Œå¹¶åŒ…å«äº†å‡ ä¸ªé™„åŠ çš„æµ‹è¯•ï¼ŒåŒæ—¶ä¹Ÿå…¼å®¹æµè§ˆå™¨ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> lessonTitle = <span class="hljs-string">&quot;Testing Smart Contracts with Truffle&quot;</span>;<br>assert.<span class="hljs-title function_">typeOf</span>(lessonTitle, <span class="hljs-string">&quot;string&quot;</span>);<br></code></pre></div></td></tr></table></figure>

<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨ <code>expect</code> é£æ ¼æ¥æ”¹è¿›ä½ çš„æ–­è¨€ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šæˆ‘ä»¬å‡è®¾ä½ å·²ç»åœ¨ä½ çš„ç”µè„‘ä¸Šå®‰è£…äº† <code>chai</code> åŒ…ã€‚å¦‚æœè¿˜æ²¡æœ‰ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è½»æ¾å®‰è£…å®ƒï¼š</p>
<figure class="highlight cmake"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cmake">npm -g <span class="hljs-keyword">install</span> chai<br></code></pre></div></td></tr></table></figure>

<p>è¦ä½¿ç”¨ <code>expect</code> é£æ ¼ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦å°†å…¶å¯¼å…¥åˆ°é¡¹ç›®ä¸­ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> expect = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;chai&#x27;</span>).<span class="hljs-property">expect</span>;<br><span class="hljs-title function_">expect</span>().<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>()<br></code></pre></div></td></tr></table></figure>

<h3 id="ä½¿ç”¨-expect-é£æ ¼è¿›è¡Œæ–­è¨€"><a href="#ä½¿ç”¨-expect-é£æ ¼è¿›è¡Œæ–­è¨€" class="headerlink" title="ä½¿ç”¨ expect é£æ ¼è¿›è¡Œæ–­è¨€"></a>ä½¿ç”¨ <code>expect</code> é£æ ¼è¿›è¡Œæ–­è¨€</h3><p>ç°åœ¨æˆ‘ä»¬å·²ç»å°† <code>expect</code> å¯¼å…¥åˆ°é¡¹ç›®ä¸­ï¼Œæ£€æŸ¥ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> zombieName = <span class="hljs-string">&#x27;My Awesome Zombie&#x27;</span>;<br><span class="hljs-title function_">expect</span>(zombieName).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-string">&#x27;My Awesome Zombie&#x27;</span>);<br></code></pre></div></td></tr></table></figure>

<p>è¯´å¤Ÿäº†ï¼Œè®©æˆ‘ä»¬å¥½å¥½åˆ©ç”¨ Chai çš„å¼ºå¤§åŠŸèƒ½å§ï¼</p>
<h3 id="æµ‹è¯•ä¸€ä¸‹-5"><a href="#æµ‹è¯•ä¸€ä¸‹-5" class="headerlink" title="æµ‹è¯•ä¸€ä¸‹"></a>æµ‹è¯•ä¸€ä¸‹</h3><ol>
<li><p>å°† <code>expect</code> å¯¼å…¥åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ã€‚</p>
</li>
<li><p>ç»§ç»­ä¸Šé¢çš„ <code>zombieName</code> ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>expect</code> æ¥æµ‹è¯•äº¤æ˜“æ˜¯å¦æˆåŠŸï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">expect</span>(result.<span class="hljs-property">receipt</span>.<span class="hljs-property">status</span>).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-literal">true</span>);<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>æˆ‘ä»¬å¯ä»¥æ£€æŸ¥ Alice æ˜¯å¦æ‹¥æœ‰ä¸€ä¸ªåƒµå°¸ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">expect</span>(zombieOwner).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(alice);<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>å°†ä»£ç ä¸­æ‰€æœ‰çš„ <code>assert.equal</code> æ›¿æ¢ä¸º <code>expect</code>ã€‚æˆ‘ä»¬åœ¨ä»£ç ä¸­ç•™ä¸‹äº†å¾ˆå¤šæ³¨é‡Šï¼Œæ–¹ä¾¿ä½ æ‰¾åˆ°éœ€è¦æ›¿æ¢çš„åœ°æ–¹ã€‚</p>
</li>
</ol>
<figure class="highlight livescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livescript"><span class="hljs-keyword">const</span> CryptoZombies = artifacts.<span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;CryptoZombies&quot;</span>);<br><span class="hljs-keyword">const</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./helpers/utils&quot;</span>);<br><span class="hljs-keyword">const</span> time = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./helpers/time&quot;</span>);<br><span class="hljs-keyword">var</span> expect = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;chai&#x27;</span>).expect;<br><span class="hljs-keyword">const</span> zombieNames = [<span class="hljs-string">&quot;Zombie 1&quot;</span>, <span class="hljs-string">&quot;Zombie 2&quot;</span>];<br>contract(<span class="hljs-string">&quot;CryptoZombies&quot;</span>, (accounts) =&gt; &#123;<br>    <span class="hljs-keyword">let</span> [alice, bob] = accounts;<br>    <span class="hljs-keyword">let</span> contractInstance;<br>    beforeEach(<span class="hljs-keyword">async</span> () =&gt; &#123;<br>        contractInstance = <span class="hljs-keyword">await</span> CryptoZombies.<span class="hljs-keyword">new</span>();<br>    &#125;);<br>    <span class="hljs-literal">it</span>(<span class="hljs-string">&quot;should be able to create a new zombie&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>        expect(result.receipt.status).<span class="hljs-keyword">to</span>.equal(<span class="hljs-literal">true</span>);<br>        expect(result.logs[<span class="hljs-number">0</span>].args.name).<span class="hljs-keyword">to</span>.equal(zombieNames[<span class="hljs-number">0</span>]);<br>    &#125;)<br>    <span class="hljs-literal">it</span>(<span class="hljs-string">&quot;should not allow two zombies&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>        <span class="hljs-keyword">await</span> utils.shouldThrow(contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">1</span>], &#123;from: alice&#125;));<br>    &#125;)<br>    context(<span class="hljs-string">&quot;with the single-step transfer scenario&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-literal">it</span>(<span class="hljs-string">&quot;should transfer a zombie&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>            <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>            <span class="hljs-keyword">const</span> zombieId = result.logs[<span class="hljs-number">0</span>].args.zombieId.toNumber();<br>            <span class="hljs-keyword">await</span> contractInstance.transferFrom(alice, bob, zombieId, &#123;from: alice&#125;);<br>            <span class="hljs-keyword">const</span> newOwner = <span class="hljs-keyword">await</span> contractInstance.ownerOf(zombieId);<br>            expect(newOwner).<span class="hljs-keyword">to</span>.equal(bob);<br>        &#125;)<br>    &#125;)<br>    context(<span class="hljs-string">&quot;with the two-step transfer scenario&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-literal">it</span>(<span class="hljs-string">&quot;should approve and then transfer a zombie when the approved address calls transferFrom&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>            <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>            <span class="hljs-keyword">const</span> zombieId = result.logs[<span class="hljs-number">0</span>].args.zombieId.toNumber();<br>            <span class="hljs-keyword">await</span> contractInstance.approve(bob, zombieId, &#123;from: alice&#125;);<br>            <span class="hljs-keyword">await</span> contractInstance.transferFrom(alice, bob, zombieId, &#123;from: bob&#125;);<br>            <span class="hljs-keyword">const</span> newOwner = <span class="hljs-keyword">await</span> contractInstance.ownerOf(zombieId);<br>            expect(newOwner).<span class="hljs-keyword">to</span>.equal(bob);<br>        &#125;)<br>        <span class="hljs-literal">it</span>(<span class="hljs-string">&quot;should approve and then transfer a zombie when the owner calls transferFrom&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>            <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>            <span class="hljs-keyword">const</span> zombieId = result.logs[<span class="hljs-number">0</span>].args.zombieId.toNumber();<br>            <span class="hljs-keyword">await</span> contractInstance.approve(bob, zombieId, &#123;from: alice&#125;);<br>            <span class="hljs-keyword">await</span> contractInstance.transferFrom(alice, bob, zombieId, &#123;from: alice&#125;);<br>            <span class="hljs-keyword">const</span> newOwner = <span class="hljs-keyword">await</span> contractInstance.ownerOf(zombieId);<br>            expect(newOwner).<span class="hljs-keyword">to</span>.equal(bob);<br>         &#125;)<br>    &#125;)<br>    <span class="hljs-literal">it</span>(<span class="hljs-string">&quot;zombies should be able to attack another zombie&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-keyword">let</span> result;<br>        result = <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">0</span>], &#123;from: alice&#125;);<br>        <span class="hljs-keyword">const</span> firstZombieId = result.logs[<span class="hljs-number">0</span>].args.zombieId.toNumber();<br>        result = <span class="hljs-keyword">await</span> contractInstance.createRandomZombie(zombieNames[<span class="hljs-number">1</span>], &#123;from: bob&#125;);<br>        <span class="hljs-keyword">const</span> secondZombieId = result.logs[<span class="hljs-number">0</span>].args.zombieId.toNumber();<br>        <span class="hljs-keyword">await</span> time.increase(time.duration.days(<span class="hljs-number">1</span>));<br>        <span class="hljs-keyword">await</span> contractInstance.attack(firstZombieId, secondZombieId, &#123;from: alice&#125;);<br>        expect(result.receipt.status).<span class="hljs-keyword">to</span>.equal(<span class="hljs-literal">true</span>);<br>    &#125;)<br>&#125;)<br></code></pre></div></td></tr></table></figure>

<h1 id="ç¬¬14ç« ï¼šåœ¨-Loom-ä¸Šè¿›è¡Œæµ‹è¯•"><a href="#ç¬¬14ç« ï¼šåœ¨-Loom-ä¸Šè¿›è¡Œæµ‹è¯•" class="headerlink" title="ç¬¬14ç« ï¼šåœ¨ Loom ä¸Šè¿›è¡Œæµ‹è¯•"></a>ç¬¬14ç« ï¼šåœ¨ Loom ä¸Šè¿›è¡Œæµ‹è¯•</h1><p>éå¸¸æ£’ï¼ä½ ä¸€å®šå·²ç»åœ¨ä¸æ–­ç»ƒä¹ äº†ã€‚</p>
<p>ç°åœ¨ï¼Œæœ¬æ•™ç¨‹å¦‚æœæ²¡æœ‰å±•ç¤ºå¦‚ä½•åœ¨ Loom Testnet ä¸Šè¿›è¡Œæµ‹è¯•ï¼Œé‚£å°±ä¸å®Œæ•´äº†ã€‚</p>
<p>å›æƒ³ä¸€ä¸‹æˆ‘ä»¬ä¹‹å‰çš„è¯¾ç¨‹ï¼Œä½ åº”è¯¥è®°å¾—åœ¨ Loom ä¸Šï¼Œç”¨æˆ·å¯ä»¥äº«å—æ¯”åœ¨ Ethereum ä¸Šæ›´å¿«é€Ÿä¸”æ—  gas è´¹ç”¨çš„äº¤æ˜“ã€‚è¿™ä½¿å¾— DAppChains éå¸¸é€‚åˆåƒæ¸¸æˆæˆ–é¢å‘ç”¨æˆ·çš„ DApp è¿™æ ·çš„åº”ç”¨ã€‚</p>
<p>è€Œä¸”ä½ çŸ¥é“å—ï¼Ÿéƒ¨ç½²å’Œåœ¨ Loom ä¸Šè¿›è¡Œæµ‹è¯•å®Œå…¨æ²¡æœ‰ä¸åŒã€‚æˆ‘ä»¬å·²ç»æ€»ç»“äº†åœ¨ Loom ä¸Šè¿›è¡Œæµ‹è¯•æ‰€éœ€çš„æ­¥éª¤ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿçœ‹ä¸€ä¸‹ã€‚</p>
<h3 id="é…ç½®-Truffle-ç”¨äºåœ¨-Loom-ä¸Šæµ‹è¯•"><a href="#é…ç½®-Truffle-ç”¨äºåœ¨-Loom-ä¸Šæµ‹è¯•" class="headerlink" title="é…ç½® Truffle ç”¨äºåœ¨ Loom ä¸Šæµ‹è¯•"></a>é…ç½® Truffle ç”¨äºåœ¨ Loom ä¸Šæµ‹è¯•</h3><p>é¦–å…ˆï¼Œé¦–å…ˆè¦åšçš„æ˜¯å‘Šè¯‰ Truffle å¦‚ä½•éƒ¨ç½²åˆ° Loom Testnetã€‚æˆ‘ä»¬éœ€è¦å°†ä»¥ä¸‹ä»£ç ç‰‡æ®µæ”¾åˆ° <code>networks</code> å¯¹è±¡ä¸­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-attr">loom_testnet</span>: &#123;<br>  <span class="hljs-attr">provider</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> privateKey = <span class="hljs-string">&#x27;YOUR_PRIVATE_KEY&#x27;</span>;<br>    <span class="hljs-keyword">const</span> chainId = <span class="hljs-string">&#x27;extdev-plasma-us1&#x27;</span>;<br>    <span class="hljs-keyword">const</span> writeUrl = <span class="hljs-string">&#x27;wss://extdev-basechain-us1.dappchains.com/websocket&#x27;</span>;<br>    <span class="hljs-keyword">const</span> readUrl = <span class="hljs-string">&#x27;wss://extdev-basechain-us1.dappchains.com/queryws&#x27;</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoomTruffleProvider</span>(chainId, writeUrl, readUrl, privateKey);<br>  &#125;,<br>  <span class="hljs-attr">network_id</span>: <span class="hljs-string">&#x27;extdev&#x27;</span><br>&#125;<br></code></pre></div></td></tr></table></figure>

<p><strong>æ³¨æ„</strong>ï¼šæ°¸è¿œä¸è¦æ³„éœ²ä½ çš„ç§é’¥ï¼æˆ‘ä»¬è¿™ä¹ˆåšåªæ˜¯ä¸ºäº†ç®€å•èµ·è§ã€‚æ›´å®‰å…¨çš„åšæ³•æ˜¯å°†ä½ çš„ç§é’¥ä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶ä»æ–‡ä»¶ä¸­è¯»å–ç§é’¥çš„å€¼ã€‚å¦‚æœè¿™æ ·åšï¼Œè¯·ç¡®ä¿ä¸è¦å°†ä¿å­˜ç§é’¥çš„æ–‡ä»¶æ¨é€åˆ° GitHub ä¸Šï¼Œè¿™æ ·ä»»ä½•äººéƒ½èƒ½çœ‹åˆ°å®ƒã€‚</p>
<h3 id="accounts-æ•°ç»„"><a href="#accounts-æ•°ç»„" class="headerlink" title="accounts æ•°ç»„"></a><code>accounts</code> æ•°ç»„</h3><p>ä¸ºäº†è®© Truffle ä¸ Loom é€šä¿¡ï¼Œæˆ‘ä»¬å°†é»˜è®¤çš„ <code>HDWalletProvider</code> æ›¿æ¢æˆäº†æˆ‘ä»¬è‡ªå·±çš„ Truffle Providerã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰æˆ‘ä»¬çš„æä¾›è€…å¡«å…… <code>accounts</code> æ•°ç»„ï¼Œä»¥ä¾¿æˆ‘ä»¬èƒ½å¤Ÿæµ‹è¯•æˆ‘ä»¬çš„æ¸¸æˆã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦æ›¿æ¢è¿”å›æ–° <code>LoomTruffleProvider</code> çš„ä»£ç è¡Œï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoomTruffleProvider</span>(chainId, writeUrl, readUrl, privateKey)<br></code></pre></div></td></tr></table></figure>

<p>ç”¨ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> loomTruffleProvider = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoomTruffleProvider</span>(chainId, writeUrl, readUrl, privateKey);<br>loomTruffleProvider.<span class="hljs-title function_">createExtraAccountsFromMnemonic</span>(mnemonic, <span class="hljs-number">10</span>);<br><span class="hljs-keyword">return</span> loomTruffleProvider;<br></code></pre></div></td></tr></table></figure>

<h3 id="æµ‹è¯•ä¸€ä¸‹-6"><a href="#æµ‹è¯•ä¸€ä¸‹-6" class="headerlink" title="æµ‹è¯•ä¸€ä¸‹"></a>æµ‹è¯•ä¸€ä¸‹</h3><ol>
<li>æ›¿æ¢è¿”å›æ–° <code>LoomTruffleProvider</code> çš„ä»£ç è¡Œï¼Œä½¿ç”¨ä¸Šé¢æä¾›çš„ä»£ç ç‰‡æ®µã€‚</li>
<li>è¿˜æœ‰ä¸€ä»¶äº‹éœ€è¦æ³¨æ„ï¼šæ—¶é—´æ—…è¡Œï¼ˆTime Travelingï¼‰ä»…åœ¨æµ‹è¯•æ—¶é€‚ç”¨äº Ganacheï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥è·³è¿‡è¿™ä¸ªæµ‹è¯•ã€‚ä½ å·²ç»çŸ¥é“å¦‚ä½•é€šè¿‡åœ¨å‡½æ•°åä¹‹å‰åŠ ä¸Š <code>x</code> æ¥è·³è¿‡æµ‹è¯•ã€‚ä½†æ˜¯ï¼Œè¿™æ¬¡æˆ‘ä»¬å¸Œæœ›ä½ å­¦åˆ°æ–°ä¸œè¥¿ã€‚ç®€è€Œè¨€ä¹‹ï¼Œä½ å¯ä»¥é€šè¿‡ç®€å•åœ°é“¾å¼è°ƒç”¨ <code>skip()</code> å‡½æ•°æ¥è·³è¿‡ä¸€ä¸ªæµ‹è¯•ï¼Œåƒè¿™æ ·ï¼š</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">it.<span class="hljs-title function_">skip</span>(<span class="hljs-string">&quot;zombies should be able to attack another zombie&quot;</span>, <span class="hljs-title function_">async</span> () =&gt; &#123;<br>    <span class="hljs-comment">// æˆ‘ä»¬è·³è¿‡äº†å‡½æ•°ä½“ä»¥ç®€åŒ–</span><br>&#125;)<br></code></pre></div></td></tr></table></figure>

<p>æˆ‘ä»¬å·²ç»ä¸ºä½ è·³è¿‡äº†è¯¥æµ‹è¯•ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿è¡Œäº† <code>truffle test --network loom_testnet</code>ã€‚</p>
<p>å¦‚æœä½ æŒ‰ç…§ä¸Šé¢çš„å‘½ä»¤è¾“å…¥ï¼Œè¾“å‡ºåº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livecodeserver">Contract: CryptoZombies<br>    âœ“ should be able <span class="hljs-built_in">to</span> <span class="hljs-built_in">create</span> <span class="hljs-keyword">a</span> <span class="hljs-built_in">new</span> zombie (<span class="hljs-number">6153</span>ms)<br>    âœ“ should <span class="hljs-keyword">not</span> allow <span class="hljs-literal">two</span> zombies (<span class="hljs-number">12895</span>ms)<br>    âœ“ should <span class="hljs-literal">return</span> <span class="hljs-keyword">the</span> correct owner (<span class="hljs-number">6962</span>ms)<br>    - zombies should be able <span class="hljs-built_in">to</span> attack another zombie<br>    <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> single-step transfer scenario<br>      âœ“ should transfer <span class="hljs-keyword">a</span> zombie (<span class="hljs-number">13810</span>ms)<br>    <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> <span class="hljs-literal">two</span>-step transfer scenario<br>      âœ“ should approve <span class="hljs-keyword">and</span> <span class="hljs-keyword">then</span> transfer <span class="hljs-keyword">a</span> zombie when <span class="hljs-keyword">the</span> approved address calls transferFrom (<span class="hljs-number">22388</span>ms)<br><br>  <span class="hljs-number">5</span> passing (<span class="hljs-number">2</span>m)<br>  <span class="hljs-number">1</span> pending<br></code></pre></div></td></tr></table></figure>

<h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†åœ¨ Loom ä¸Šæµ‹è¯• CryptoZombies æ™ºèƒ½åˆçº¦çš„è¿‡ç¨‹ã€‚</p>
<p>ç­”æ¡ˆï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">HDWalletProvider</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;truffle-hdwallet-provider&quot;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">LoomTruffleProvider</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;loom-truffle-provider&#x27;</span>);<br><span class="hljs-keyword">const</span> mnemonic = <span class="hljs-string">&quot;YOUR MNEMONIC HERE&quot;</span>;<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>    <span class="hljs-comment">// Object with configuration for each network</span><br>    <span class="hljs-attr">networks</span>: &#123;<br>        <span class="hljs-comment">//development</span><br>        <span class="hljs-attr">development</span>: &#123;<br>            <span class="hljs-attr">host</span>: <span class="hljs-string">&quot;127.0.0.1&quot;</span>,<br>            <span class="hljs-attr">port</span>: <span class="hljs-number">7545</span>,<br>            <span class="hljs-attr">network_id</span>: <span class="hljs-string">&quot;*&quot;</span>,<br>            <span class="hljs-attr">gas</span>: <span class="hljs-number">9500000</span><br>        &#125;,<br>        <span class="hljs-comment">// Configuration for Ethereum Mainnet</span><br>        <span class="hljs-attr">mainnet</span>: &#123;<br>            <span class="hljs-attr">provider</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HDWalletProvider</span>(mnemonic, <span class="hljs-string">&quot;https://mainnet.infura.io/v3/&lt;YOUR_INFURA_API_KEY&gt;&quot;</span>)<br>            &#125;,<br>            <span class="hljs-attr">network_id</span>: <span class="hljs-string">&quot;1&quot;</span> <span class="hljs-comment">// Match any network id</span><br>        &#125;,<br>        <span class="hljs-comment">// Configuration for Rinkeby Metwork</span><br>        <span class="hljs-attr">rinkeby</span>: &#123;<br>            <span class="hljs-attr">provider</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HDWalletProvider</span>(mnemonic, <span class="hljs-string">&quot;https://rinkeby.infura.io/v3/&lt;YOUR_INFURA_API_KEY&gt;&quot;</span>)<br>            &#125;,<br>            <span class="hljs-attr">network_id</span>: <span class="hljs-number">4</span><br>        &#125;,<br>        <span class="hljs-comment">// Configuration for Loom Testnet</span><br>        <span class="hljs-attr">loom_testnet</span>: &#123;<br>            <span class="hljs-attr">provider</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>                <span class="hljs-keyword">const</span> privateKey = <span class="hljs-string">&#x27;YOUR_PRIVATE_KEY&#x27;</span>;<br>                <span class="hljs-keyword">const</span> chainId = <span class="hljs-string">&#x27;extdev-plasma-us1&#x27;</span>;<br>                <span class="hljs-keyword">const</span> writeUrl = <span class="hljs-string">&#x27;wss://extdev-basechain-us1.dappchains.com/websocket&#x27;</span>;<br>                <span class="hljs-keyword">const</span> readUrl = <span class="hljs-string">&#x27;wss://extdev-basechain-us1.dappchains.com/queryws&#x27;</span>;<br>                <span class="hljs-keyword">const</span> loomTruffleProvider = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoomTruffleProvider</span>(chainId, writeUrl, readUrl, privateKey);<br>                loomTruffleProvider.<span class="hljs-title function_">createExtraAccountsFromMnemonic</span>(mnemonic, <span class="hljs-number">10</span>);<br>                <span class="hljs-keyword">return</span> loomTruffleProvider;<br>            &#125;,<br>            <span class="hljs-attr">network_id</span>: <span class="hljs-string">&#x27;9545242630824&#x27;</span><br>        &#125;<br>    &#125;,<br>    <span class="hljs-attr">compilers</span>: &#123;<br>        <span class="hljs-attr">solc</span>: &#123;<br>            <span class="hljs-attr">version</span>: <span class="hljs-string">&quot;0.4.25&quot;</span><br>        &#125;<br>    &#125;<br>&#125;;<br><br></code></pre></div></td></tr></table></figure>

<p>ä½ å®Œæˆäº†æ¸¸æˆçš„æµ‹è¯•ã€‚ä½ çœŸæ˜¯å¤ªæ£’äº†ï¼</p>
<p>å°½ç®¡åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­æˆ‘ä»¬çš„æ¸¸æˆæ˜¯ä¸ºäº†æ¼”ç¤ºè€Œæ„å»ºçš„ï¼Œä½†å¾ˆæ˜æ˜¾ï¼Œæµ‹è¯•ä¸€ä¸ª Solidity æ™ºèƒ½åˆçº¦å¹¶ä¸æ˜¯ä¸€ä»¶ç®€å•çš„äº‹ã€‚ä½†æˆ‘ä»¬çŸ¥é“ï¼Œç°åœ¨ä½ å·²ç»å…·å¤‡äº†æµ‹è¯•æ™ºèƒ½åˆçº¦çš„èƒ½åŠ›ï¼</p>
<p>éœ€è¦è®°ä½çš„é‡è¦äº‹é¡¹æ˜¯ï¼š</p>
<ul>
<li>ç¡®ä¿ä¸ºæ¸¸æˆä¸­çš„æ¯ä¸ªå‡½æ•°åˆ›å»ºå•ç‹¬çš„æµ‹è¯•ã€‚</li>
<li>ä¿æŒä»£ç æ¸…æ™°æ ‡æ³¨å’Œç»„ç»‡ã€‚</li>
<li>åˆ©ç”¨æ—¶é—´æ—…è¡Œï¼ˆtime travelingï¼‰åŠŸèƒ½ã€‚</li>
<li>åœ¨å¼€å‘æ¸¸æˆæˆ–é¢å‘ç”¨æˆ·çš„ DApp æ—¶ï¼Œè€ƒè™‘ä½¿ç”¨ Loomã€‚æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½ ä»æŸ¥çœ‹æˆ‘ä»¬çš„æ–‡æ¡£å¼€å§‹ã€‚</li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Web3/">Web3</a>
                    
                  </div>
                
              </div>
              
                
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/11/27/30384.html">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">cryptozombies11-TronBox</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/11/27/13959.html">
                        <span class="hidden-mobile">cryptozombies9</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


            

                
                  <a id="scroll-top-button" href="#" role="button">
                    <i class="iconfont icon-arrowup" aria-hidden="true"></i>
                  </a>
                  

                    

                          
      </main>

      <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://whale3070.github.io/" target="_blank" rel="nofollow noopener"><span>Whale3070</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js" ></script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




















<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>


<link href="/pagefind/pagefind-ui.css" rel="stylesheet">
  <script src="/pagefind/pagefind-ui.js"></script>
  <style>
    /* æœç´¢æ¡†é…è‰²é€‚é… */
    #search { margin-top: 2rem; }
    [data-user-color-scheme='dark'] .pagefind-ui {
      --pagefind-ui-primary: #eeeeee;
      --pagefind-ui-text: #eeeeee;
      --pagefind-ui-background: #151515;
      --pagefind-ui-border: #333;
    }
  </style>
    </body>

  </html>