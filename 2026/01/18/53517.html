

  <!DOCTYPE html>
  <html lang="zh-CN" data-default-color-scheme=&#34;dark&#34; >
  <style>
    .text1
    {
    text-shadow: 0px 0px 2px #f2f3f2;
    }
    </style>

  <script>
    // å¼ºåˆ¶å†…ç½‘ IP è¯†åˆ«ä¸ºå®‰å…¨ä¸Šä¸‹æ–‡
    if (window.location.hostname !== 'localhost' && window.location.protocol === 'http:') {
        // å°è¯•æ‰‹åŠ¨æ˜ å°„ crypto å±æ€§
        if (!window.crypto.subtle && window.crypto.webkitSubtle) {
            window.crypto.subtle = window.crypto.webkitSubtle;
        }
    }
    
    // ç»ˆæè¡¥ä¸ï¼šå¦‚æœè¿˜æ˜¯æ²¡æœ‰ subtleï¼Œåˆ™åˆ›å»ºä¸€ä¸ªå ä½ç¬¦é¿å…æŠ¥é”™
    // æç¤ºï¼šè¿™é€šå¸¸èƒ½è§£å†³åŠ è½½æŠ¥é”™ï¼Œä½†å¦‚æœæ’ä»¶å¼ºä¾èµ–åŸç”ŸåŠ å¯†ï¼Œå»ºè®®æ‰§è¡Œä¸‹é¢çš„â€œé™çº§â€é¢„åˆ¤
    if (!window.isSecureContext) {
        console.warn('å½“å‰ç¯å¢ƒéå®‰å…¨ä¸Šä¸‹æ–‡ï¼Œæ­£åœ¨å°è¯•å…¼å®¹å†…ç½‘åŠ å¯†è§£å¯†...');
    }
</script>


<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/null">
  <link rel="icon" type="image/png" href="/null">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  <title>whale-valut-é‡æ„ä»£ç  - whale3070&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.4.0/styles/github-gist.min.css" />
    
  

  



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"whale3070.github.io","root":"/","version":"1.8.7","typing":{"enable":false,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":false,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 7.3.0"></head>


    <body>
      <header style="height: 70vh;">
        <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>InfoSec learning</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/search/">
                <i class="iconfont icon-search"></i>
                æœç´¢
              </a>
            </li>
          
        
        
        
          
        
      </ul>
    </div>
  </div>
</nav>

          <div class="banner" id="banner" false
            style="background: url('/img/default.png') no-repeat center center;
              background-size: cover;">
              <div class="full-bg-img">
                <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
                  <div class="page-header text-center fade-in-up">
                    <span class="h2 text1" id="subtitle" title="whale-valut-é‡æ„ä»£ç ">
                      
                        whale-valut-é‡æ„ä»£ç 
                      
                    </span>
        
                    
                      <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2026-01-18 06:38" pubdate>
        2026å¹´1æœˆ18æ—¥ æ—©ä¸Š
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      3.4k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      55
       åˆ†é’Ÿ
    </span>
  

  
  
</div>

                    
                  </div>
                    
                  </div>
                  
                </div>
              </div>
          </div>
      </header>

      <main>
        
          

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" data-pagefind-body>
            <!-- SEO header -->
            <h1 style="display: none">whale-valut-é‡æ„ä»£ç </h1>
            
            <div class="markdown-body">
              <p>æ ¹æ®ä½ çš„é‡‘åº“åè®®ä¸‰å¤§æ¨¡å—ï¼Œæˆ‘å°†é‡æ„ <code>Validate2.go</code>ï¼Œé‡‡ç”¨æ¨¡å—åŒ–çš„Goé¡¹ç›®ç»“æ„ã€‚æˆ‘ä¼šåˆ›å»ºæ¸…æ™°çš„åŒ…ç»“æ„å’Œæ¥å£ï¼Œä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•æ‰“ä¸‹åŸºç¡€ã€‚</p>
<h2 id="ğŸ“-é¡¹ç›®ç»“æ„è§„åˆ’"><a href="#ğŸ“-é¡¹ç›®ç»“æ„è§„åˆ’" class="headerlink" title="ğŸ“ é¡¹ç›®ç»“æ„è§„åˆ’"></a>ğŸ“ <strong>é¡¹ç›®ç»“æ„è§„åˆ’</strong></h2><figure class="highlight nix"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nix">whale-vault-backend<span class="hljs-symbol">/</span><br>â”œâ”€â”€ go.mod<br>â”œâ”€â”€ go.sum<br>â”œâ”€â”€ main.go                    <span class="hljs-comment"># ä¸»å…¥å£æ–‡ä»¶</span><br>â”œâ”€â”€ config<span class="hljs-symbol">/</span><br>â”‚   â”œâ”€â”€ config.go              <span class="hljs-comment"># é…ç½®ç®¡ç†</span><br>â”‚   â””â”€â”€ env.go                 <span class="hljs-comment"># ç¯å¢ƒå˜é‡</span><br>â”œâ”€â”€ handlers<span class="hljs-symbol">/</span>                  <span class="hljs-comment"># HTTPå¤„ç†å™¨</span><br>â”‚   â”œâ”€â”€ reader_handler.go      <span class="hljs-comment"># è¯»è€…æ¨¡å—å¤„ç†å™¨</span><br>â”‚   â”œâ”€â”€ author_handler.go      <span class="hljs-comment"># ä½œè€…æ¨¡å—å¤„ç†å™¨</span><br>â”‚   â”œâ”€â”€ publisher_handler.go   <span class="hljs-comment"># å‡ºç‰ˆç¤¾æ¨¡å—å¤„ç†å™¨</span><br>â”‚   â””â”€â”€ common_handler.go      <span class="hljs-comment"># é€šç”¨å¤„ç†å™¨</span><br>â”œâ”€â”€ services<span class="hljs-symbol">/</span>                  <span class="hljs-comment"># ä¸šåŠ¡æœåŠ¡å±‚</span><br>â”‚   â”œâ”€â”€ reader_service.go      <span class="hljs-comment"># è¯»è€…æœåŠ¡</span><br>â”‚   â”œâ”€â”€ author_service.go      <span class="hljs-comment"># ä½œè€…æœåŠ¡</span><br>â”‚   â”œâ”€â”€ publisher_service.go   <span class="hljs-comment"># å‡ºç‰ˆç¤¾æœåŠ¡</span><br>â”‚   â”œâ”€â”€ blockchain_service.go  <span class="hljs-comment"># åŒºå—é“¾æœåŠ¡</span><br>â”‚   â”œâ”€â”€ nft_service.go         <span class="hljs-comment"># NFTæœåŠ¡</span><br>â”‚   â”œâ”€â”€ staking_service.go     <span class="hljs-comment"># è´¨æŠ¼æœåŠ¡</span><br>â”‚   â”œâ”€â”€ marketplace_service.go <span class="hljs-comment"># äº¤æ˜“å¸‚åœºæœåŠ¡</span><br>â”‚   â”œâ”€â”€ analytics_service.go   <span class="hljs-comment"># æ•°æ®åˆ†ææœåŠ¡</span><br>â”‚   â””â”€â”€ matrix_service.go      <span class="hljs-comment"># MatrixèŠå¤©æœåŠ¡</span><br>â”œâ”€â”€ models<span class="hljs-symbol">/</span>                    <span class="hljs-comment"># æ•°æ®æ¨¡å‹</span><br>â”‚   â”œâ”€â”€ reader.go              <span class="hljs-comment"># è¯»è€…æ¨¡å‹</span><br>â”‚   â”œâ”€â”€ author.go              <span class="hljs-comment"># ä½œè€…æ¨¡å‹</span><br>â”‚   â”œâ”€â”€ publisher.go           <span class="hljs-comment"># å‡ºç‰ˆç¤¾æ¨¡å‹</span><br>â”‚   â”œâ”€â”€ book.go                <span class="hljs-comment"># ä¹¦ç±æ¨¡å‹</span><br>â”‚   â”œâ”€â”€ nft.go                 <span class="hljs-comment"># NFTæ¨¡å‹</span><br>â”‚   â”œâ”€â”€ transaction.go         <span class="hljs-comment"># äº¤æ˜“æ¨¡å‹</span><br>â”‚   â””â”€â”€ response.go            <span class="hljs-comment"># å“åº”æ¨¡å‹</span><br>â”œâ”€â”€ repositories<span class="hljs-symbol">/</span>              <span class="hljs-comment"># æ•°æ®è®¿é—®å±‚</span><br>â”‚   â”œâ”€â”€ redis_repo.go          <span class="hljs-comment"># Rediså­˜å‚¨</span><br>â”‚   â””â”€â”€ cache_repo.go          <span class="hljs-comment"># ç¼“å­˜ç®¡ç†</span><br>â”œâ”€â”€ blockchain<span class="hljs-symbol">/</span>                <span class="hljs-comment"># åŒºå—é“¾äº¤äº’</span><br>â”‚   â”œâ”€â”€ monad_client.go        <span class="hljs-comment"># Monadå®¢æˆ·ç«¯</span><br>â”‚   â”œâ”€â”€ contract_interactor.go <span class="hljs-comment"># åˆçº¦äº¤äº’</span><br>â”‚   â””â”€â”€ transaction_manager.go <span class="hljs-comment"># äº¤æ˜“ç®¡ç†</span><br>â”œâ”€â”€ middleware<span class="hljs-symbol">/</span>                <span class="hljs-comment"># ä¸­é—´ä»¶</span><br>â”‚   â”œâ”€â”€ auth_middleware.go     <span class="hljs-comment"># è®¤è¯ä¸­é—´ä»¶</span><br>â”‚   â”œâ”€â”€ role_middleware.go     <span class="hljs-comment"># è§’è‰²ä¸­é—´ä»¶</span><br>â”‚   â”œâ”€â”€ rate_limit.go          <span class="hljs-comment"># é™æµä¸­é—´ä»¶</span><br>â”‚   â””â”€â”€ cors_middleware.go     <span class="hljs-comment"># CORSä¸­é—´ä»¶</span><br>â”œâ”€â”€ routes<span class="hljs-symbol">/</span>                    <span class="hljs-comment"># è·¯ç”±å®šä¹‰</span><br>â”‚   â”œâ”€â”€ reader_routes.go       <span class="hljs-comment"># è¯»è€…è·¯ç”±</span><br>â”‚   â”œâ”€â”€ author_routes.go       <span class="hljs-comment"># ä½œè€…è·¯ç”±</span><br>â”‚   â”œâ”€â”€ publisher_routes.go    <span class="hljs-comment"># å‡ºç‰ˆç¤¾è·¯ç”±</span><br>â”‚   â””â”€â”€ api_routes.go          <span class="hljs-comment"># APIè·¯ç”±</span><br>â”œâ”€â”€ utils<span class="hljs-symbol">/</span>                     <span class="hljs-comment"># å·¥å…·å‡½æ•°</span><br>â”‚   â”œâ”€â”€ validator.go           <span class="hljs-comment"># éªŒè¯å·¥å…·</span><br>â”‚   â”œâ”€â”€ crypto.go              <span class="hljs-comment"># åŠ å¯†å·¥å…·</span><br>â”‚   â”œâ”€â”€ logger.go              <span class="hljs-comment"># æ—¥å¿—å·¥å…·</span><br>â”‚   â””â”€â”€ helpers.go             <span class="hljs-comment"># è¾…åŠ©å‡½æ•°</span><br>â””â”€â”€ pkg<span class="hljs-symbol">/</span>                       <span class="hljs-comment"># å†…éƒ¨åŒ…</span><br>    â”œâ”€â”€ concurrency<span class="hljs-symbol">/</span>           <span class="hljs-comment"># å¹¶å‘æ§åˆ¶</span><br>    â””â”€â”€ monitor<span class="hljs-symbol">/</span>               <span class="hljs-comment"># ç›‘æ§å·¥å…·</span><br></code></pre></div></td></tr></table></figure>

<h2 id="ğŸ”§-é‡æ„åçš„ä»£ç "><a href="#ğŸ”§-é‡æ„åçš„ä»£ç " class="headerlink" title="ğŸ”§ é‡æ„åçš„ä»£ç "></a>ğŸ”§ <strong>é‡æ„åçš„ä»£ç </strong></h2><h3 id="1-main-go-ä¸»å…¥å£æ–‡ä»¶"><a href="#1-main-go-ä¸»å…¥å£æ–‡ä»¶" class="headerlink" title="1. main.go (ä¸»å…¥å£æ–‡ä»¶)"></a><strong>1. main.go (ä¸»å…¥å£æ–‡ä»¶)</strong></h3><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;whale-vault-backend/config&quot;</span><br>    <span class="hljs-string">&quot;whale-vault-backend/routes&quot;</span><br>    <span class="hljs-string">&quot;whale-vault-backend/middleware&quot;</span><br>    <span class="hljs-string">&quot;whale-vault-backend/utils&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// 1. åŠ è½½é…ç½®</span><br>    cfg := config.LoadConfig()<br>    <br>    <span class="hljs-comment">// 2. åˆå§‹åŒ–æ—¥å¿—</span><br>    utils.InitLogger(cfg.LogLevel)<br>    <br>    <span class="hljs-comment">// 3. åˆå§‹åŒ–æœåŠ¡ä¾èµ–</span><br>    services := InitializeServices(cfg)<br>    <br>    <span class="hljs-comment">// 4. è®¾ç½®è·¯ç”±</span><br>    router := routes.SetupRouter(services)<br>    <br>    <span class="hljs-comment">// 5. æ·»åŠ ä¸­é—´ä»¶</span><br>    app := middleware.WithCORS(router)<br>    app = middleware.WithRateLimit(app, cfg.RateLimit)<br>    <br>    <span class="hljs-comment">// 6. å¯åŠ¨æœåŠ¡å™¨</span><br>    log.Printf(<span class="hljs-string">&quot;ğŸš€ Whale Vault åç«¯å¯åŠ¨æˆåŠŸï¼Œç«¯å£: %s&quot;</span>, cfg.Port)<br>    log.Printf(<span class="hljs-string">&quot;ğŸ“Š å·²å¯ç”¨æ¨¡å—: è¯»è€… | ä½œè€… | å‡ºç‰ˆç¤¾&quot;</span>)<br>    log.Fatal(app.Listen(<span class="hljs-string">&quot;:&quot;</span> + cfg.Port))<br>&#125;<br><br><span class="hljs-comment">// InitializeServices åˆå§‹åŒ–æ‰€æœ‰æœåŠ¡ä¾èµ–</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitializeServices</span><span class="hljs-params">(cfg *config.Config)</span></span> *Services &#123;<br>    <span class="hljs-keyword">return</span> &amp;Services&#123;<br>        Redis:        initRedis(cfg),<br>        Blockchain:   initBlockchain(cfg),<br>        NFT:          initNFTService(cfg),<br>        Staking:      initStakingService(cfg),<br>        Marketplace:  initMarketplaceService(cfg),<br>        Analytics:    initAnalyticsService(cfg),<br>        Matrix:       initMatrixService(cfg),<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h3 id="2-config-config-go-é…ç½®ç®¡ç†"><a href="#2-config-config-go-é…ç½®ç®¡ç†" class="headerlink" title="2. config&#x2F;config.go (é…ç½®ç®¡ç†)"></a><strong>2. config&#x2F;config.go (é…ç½®ç®¡ç†)</strong></h3><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> config<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;os&quot;</span><br><br><span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> &#123;<br>    Port         <span class="hljs-type">string</span><br>    RedisAddr    <span class="hljs-type">string</span><br>    RPCURL       <span class="hljs-type">string</span><br>    ChainID      <span class="hljs-type">int64</span><br>    PrivateKeys  []<span class="hljs-type">string</span><br>    MatrixURL    <span class="hljs-type">string</span><br>    MatrixRoomID <span class="hljs-type">string</span><br>    LogLevel     <span class="hljs-type">string</span><br>    RateLimit    RateLimitConfig<br>&#125;<br><br><span class="hljs-keyword">type</span> RateLimitConfig <span class="hljs-keyword">struct</span> &#123;<br>    RequestsPerMinute <span class="hljs-type">int</span><br>    Burst             <span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LoadConfig</span><span class="hljs-params">()</span></span> *Config &#123;<br>    <span class="hljs-keyword">return</span> &amp;Config&#123;<br>        Port:         getEnv(<span class="hljs-string">&quot;PORT&quot;</span>, <span class="hljs-string">&quot;8080&quot;</span>),<br>        RedisAddr:    getEnv(<span class="hljs-string">&quot;REDIS_ADDR&quot;</span>, <span class="hljs-string">&quot;localhost:6379&quot;</span>),<br>        RPCURL:       getEnv(<span class="hljs-string">&quot;RPC_URL&quot;</span>, <span class="hljs-string">&quot;&quot;</span>),<br>        ChainID:      getEnvAsInt64(<span class="hljs-string">&quot;CHAIN_ID&quot;</span>, <span class="hljs-number">1234</span>),<br>        PrivateKeys:  getEnvSlice(<span class="hljs-string">&quot;PRIVATE_KEYS&quot;</span>, <span class="hljs-string">&quot;,&quot;</span>),<br>        MatrixURL:    getEnv(<span class="hljs-string">&quot;MATRIX_URL&quot;</span>, <span class="hljs-string">&quot;&quot;</span>),<br>        MatrixRoomID: getEnv(<span class="hljs-string">&quot;MATRIX_ROOM_ID&quot;</span>, <span class="hljs-string">&quot;&quot;</span>),<br>        LogLevel:     getEnv(<span class="hljs-string">&quot;LOG_LEVEL&quot;</span>, <span class="hljs-string">&quot;info&quot;</span>),<br>        RateLimit: RateLimitConfig&#123;<br>            RequestsPerMinute: getEnvAsInt(<span class="hljs-string">&quot;RATE_LIMIT_PER_MINUTE&quot;</span>, <span class="hljs-number">100</span>),<br>            Burst:             getEnvAsInt(<span class="hljs-string">&quot;RATE_LIMIT_BURST&quot;</span>, <span class="hljs-number">20</span>),<br>        &#125;,<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h3 id="3-handlers-reader-handler-go-è¯»è€…æ¨¡å—å¤„ç†å™¨"><a href="#3-handlers-reader-handler-go-è¯»è€…æ¨¡å—å¤„ç†å™¨" class="headerlink" title="3. handlers&#x2F;reader_handler.go (è¯»è€…æ¨¡å—å¤„ç†å™¨)"></a><strong>3. handlers&#x2F;reader_handler.go (è¯»è€…æ¨¡å—å¤„ç†å™¨)</strong></h3><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> handlers<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;encoding/json&quot;</span><br>    <span class="hljs-string">&quot;whale-vault-backend/services&quot;</span><br>    <span class="hljs-string">&quot;whale-vault-backend/models&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> ReaderHandler <span class="hljs-keyword">struct</span> &#123;<br>    service *services.ReaderService<br>    nftService *services.NFTService<br>    stakingService *services.StakingService<br>    marketplaceService *services.MarketplaceService<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewReaderHandler</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">    readerService *services.ReaderService,</span></span><br><span class="hljs-params"><span class="hljs-function">    nftService *services.NFTService,</span></span><br><span class="hljs-params"><span class="hljs-function">    stakingService *services.StakingService,</span></span><br><span class="hljs-params"><span class="hljs-function">    marketplaceService *services.MarketplaceService,</span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span> *ReaderHandler &#123;<br>    <span class="hljs-keyword">return</span> &amp;ReaderHandler&#123;<br>        service: readerService,<br>        nftService: nftService,<br>        stakingService: stakingService,<br>        marketplaceService: marketplaceService,<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// ClaimNFT - åŠŸèƒ½ä¸€ï¼šç‚¹å‡»å³å¯é¢†å–NFT</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *ReaderHandler)</span></span> ClaimNFT(w http.ResponseWriter, r *http.Request) &#123;<br>    <span class="hljs-keyword">var</span> req models.ClaimNFTRequest<br>    <span class="hljs-keyword">if</span> err := json.NewDecoder(r.Body).Decode(&amp;req); err != <span class="hljs-literal">nil</span> &#123;<br>        respondWithError(w, http.StatusBadRequest, <span class="hljs-string">&quot;æ— æ•ˆçš„è¯·æ±‚å‚æ•°&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// éªŒè¯æ¿€æ´»ç </span><br>    <span class="hljs-keyword">if</span> !h.service.ValidateActivationCode(req.CodeHash, req.WalletAddress) &#123;<br>        respondWithError(w, http.StatusForbidden, <span class="hljs-string">&quot;æ— æ•ˆçš„æ¿€æ´»ç &quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// å¹¶å‘å®‰å…¨çš„NFTé“¸é€ </span><br>    txHash, err := h.nftService.MintNFTConcurrent(req.WalletAddress, req.CodeHash)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        respondWithError(w, http.StatusInternalServerError, <span class="hljs-string">&quot;NFTé“¸é€ å¤±è´¥: &quot;</span>+err.Error())<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// è®°å½•æ¿€æ´»ç ä½¿ç”¨</span><br>    h.service.RecordCodeUsage(req.CodeHash, req.WalletAddress)<br>    <br>    respondWithSuccess(w, models.ClaimNFTResponse&#123;<br>        TxHash: txHash,<br>        Status: <span class="hljs-string">&quot;success&quot;</span>,<br>    &#125;)<br>&#125;<br><br><span class="hljs-comment">// GetExclusiveContent - åŠŸèƒ½äºŒï¼šè·å–ä¸“å±æ–°èµ„æ–™</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *ReaderHandler)</span></span> GetExclusiveContent(w http.ResponseWriter, r *http.Request) &#123;<br>    walletAddress := r.URL.Query().Get(<span class="hljs-string">&quot;address&quot;</span>)<br>    <br>    <span class="hljs-comment">// éªŒè¯è¯»è€…æƒé™</span><br>    <span class="hljs-keyword">if</span> !h.service.HasReaderAccess(walletAddress) &#123;<br>        respondWithError(w, http.StatusForbidden, <span class="hljs-string">&quot;æ— è®¿é—®æƒé™&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    content, err := h.service.GetDynamicContent(walletAddress)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        respondWithError(w, http.StatusInternalServerError, <span class="hljs-string">&quot;è·å–å†…å®¹å¤±è´¥&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    respondWithSuccess(w, content)<br>&#125;<br><br><span class="hljs-comment">// PromoteBooks - åŠŸèƒ½ä¸‰ï¼šæ¨å¹¿æ–°ä¹¦è·å–å¥–åŠ±</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *ReaderHandler)</span></span> PromoteBooks(w http.ResponseWriter, r *http.Request) &#123;<br>    <span class="hljs-keyword">var</span> req models.PromoteRequest<br>    <span class="hljs-keyword">if</span> err := json.NewDecoder(r.Body).Decode(&amp;req); err != <span class="hljs-literal">nil</span> &#123;<br>        respondWithError(w, http.StatusBadRequest, <span class="hljs-string">&quot;æ— æ•ˆçš„è¯·æ±‚å‚æ•°&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> å®ç°æ¨å¹¿é€»è¾‘</span><br>    <span class="hljs-comment">// 1. éªŒè¯è¯»è€…èº«ä»½</span><br>    <span class="hljs-comment">// 2. è®°å½•æ¨å¹¿è¡Œä¸º</span><br>    <span class="hljs-comment">// 3. è®¡ç®—å¹¶å‘æ”¾DOTå¥–åŠ±ï¼ˆåŒå€ä¹¦ä»·ï¼‰</span><br>    <br>    respondWithSuccess(w, models.PromoteResponse&#123;<br>        RewardDOT: <span class="hljs-string">&quot;100.0&quot;</span>,<br>        Status:    <span class="hljs-string">&quot;æ¨å¹¿è®°å½•æˆåŠŸ&quot;</span>,<br>    &#125;)<br>&#125;<br><br><span class="hljs-comment">// StakeDOT - åŠŸèƒ½å››ï¼šè´¨æŠ¼DOTé¢„æµ‹é”€é‡</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *ReaderHandler)</span></span> StakeDOT(w http.ResponseWriter, r *http.Request) &#123;<br>    <span class="hljs-keyword">var</span> req models.StakeRequest<br>    <span class="hljs-keyword">if</span> err := json.NewDecoder(r.Body).Decode(&amp;req); err != <span class="hljs-literal">nil</span> &#123;<br>        respondWithError(w, http.StatusBadRequest, <span class="hljs-string">&quot;æ— æ•ˆçš„è¯·æ±‚å‚æ•°&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> å®ç°è´¨æŠ¼é€»è¾‘</span><br>    <span class="hljs-comment">// 1. éªŒè¯è´¨æŠ¼é‡‘é¢</span><br>    <span class="hljs-comment">// 2. è®°å½•è´¨æŠ¼é¢„æµ‹</span><br>    <span class="hljs-comment">// 3. 10å¤©åæ ¹æ®ç»“æœåˆ†é…å¥–é‡‘æ± </span><br>    <br>    respondWithSuccess(w, models.StakeResponse&#123;<br>        StakeID:   <span class="hljs-string">&quot;stake_123&quot;</span>,<br>        Amount:    req.Amount,<br>        EndTime:   <span class="hljs-string">&quot;10å¤©å&quot;</span>,<br>        Status:    <span class="hljs-string">&quot;è´¨æŠ¼æˆåŠŸ&quot;</span>,<br>    &#125;)<br>&#125;<br><br><span class="hljs-comment">// SellUsedBook - åŠŸèƒ½äº”ï¼šäºŒæ‰‹ä¹¦äº¤æ˜“</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *ReaderHandler)</span></span> SellUsedBook(w http.ResponseWriter, r *http.Request) &#123;<br>    <span class="hljs-keyword">var</span> req models.SellBookRequest<br>    <span class="hljs-keyword">if</span> err := json.NewDecoder(r.Body).Decode(&amp;req); err != <span class="hljs-literal">nil</span> &#123;<br>        respondWithError(w, http.StatusBadRequest, <span class="hljs-string">&quot;æ— æ•ˆçš„è¯·æ±‚å‚æ•°&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> å®ç°äºŒæ‰‹ä¹¦äº¤æ˜“é€»è¾‘</span><br>    <span class="hljs-comment">// 1. éªŒè¯NFTæ‰€æœ‰æƒ</span><br>    <span class="hljs-comment">// 2. å¤„ç†DOTæ”¯ä»˜</span><br>    <span class="hljs-comment">// 3. è½¬ç§»NFTæ‰€æœ‰æƒ</span><br>    <span class="hljs-comment">// 4. åˆ†é…åˆ©æ¶¦ï¼ˆä½œè€…ã€å‡ºç‰ˆç¤¾ã€ç³»ç»Ÿå¥–åŠ±ï¼‰</span><br>    <br>    respondWithSuccess(w, models.SellBookResponse&#123;<br>        TransactionID: <span class="hljs-string">&quot;tx_456&quot;</span>,<br>        SellerReward:  req.Price * <span class="hljs-number">0.8</span>,    <span class="hljs-comment">// å–å®¶è·å¾—80%</span><br>        AuthorShare:   req.Price * <span class="hljs-number">0.1</span>,    <span class="hljs-comment">// ä½œè€…è·å¾—10%</span><br>        PublisherShare: req.Price * <span class="hljs-number">0.05</span>,  <span class="hljs-comment">// å‡ºç‰ˆç¤¾è·å¾—5%</span><br>        SystemReward:  req.Price * <span class="hljs-number">0.05</span>,   <span class="hljs-comment">// ç³»ç»Ÿå¥–åŠ±5%</span><br>        Status:        <span class="hljs-string">&quot;äº¤æ˜“æˆåŠŸ&quot;</span>,<br>    &#125;)<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h3 id="4-handlers-author-handler-go-ä½œè€…æ¨¡å—å¤„ç†å™¨"><a href="#4-handlers-author-handler-go-ä½œè€…æ¨¡å—å¤„ç†å™¨" class="headerlink" title="4. handlers&#x2F;author_handler.go (ä½œè€…æ¨¡å—å¤„ç†å™¨)"></a><strong>4. handlers&#x2F;author_handler.go (ä½œè€…æ¨¡å—å¤„ç†å™¨)</strong></h3><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> handlers<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;encoding/json&quot;</span><br>    <span class="hljs-string">&quot;whale-vault-backend/services&quot;</span><br>    <span class="hljs-string">&quot;whale-vault-backend/models&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> AuthorHandler <span class="hljs-keyword">struct</span> &#123;<br>    service *services.AuthorService<br>    nftService *services.NFTService<br>    analyticsService *services.AnalyticsService<br>    matrixService *services.MatrixService<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewAuthorHandler</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">    authorService *services.AuthorService,</span></span><br><span class="hljs-params"><span class="hljs-function">    nftService *services.NFTService,</span></span><br><span class="hljs-params"><span class="hljs-function">    analyticsService *services.AnalyticsService,</span></span><br><span class="hljs-params"><span class="hljs-function">    matrixService *services.MatrixService,</span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span> *AuthorHandler &#123;<br>    <span class="hljs-keyword">return</span> &amp;AuthorHandler&#123;<br>        service: authorService,<br>        nftService: nftService,<br>        analyticsService: analyticsService,<br>        matrixService: matrixService,<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// UploadNFTImage - åŠŸèƒ½1ï¼šä¸Šä¼ NFTå›¾ç‰‡</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *AuthorHandler)</span></span> UploadNFTImage(w http.ResponseWriter, r *http.Request) &#123;<br>    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> å®ç°å›¾ç‰‡ä¸Šä¼ é€»è¾‘</span><br>    <span class="hljs-comment">// 1. éªŒè¯ä½œè€…èº«ä»½</span><br>    <span class="hljs-comment">// 2. å¤„ç†å›¾ç‰‡æ–‡ä»¶</span><br>    <span class="hljs-comment">// 3. å­˜å‚¨åˆ°IPFS/Arweave</span><br>    <span class="hljs-comment">// 4. æ›´æ–°NFTå…ƒæ•°æ®</span><br>    <br>    respondWithSuccess(w, models.UploadResponse&#123;<br>        ImageURL: <span class="hljs-string">&quot;ipfs://Qm...&quot;</span>,<br>        Status:   <span class="hljs-string">&quot;å›¾ç‰‡ä¸Šä¼ æˆåŠŸ&quot;</span>,<br>    &#125;)<br>&#125;<br><br><span class="hljs-comment">// UploadDynamicContent - åŠŸèƒ½2ï¼šä¸Šä¼ åŠ¨æ€æ›´æ–°çš„ä¹¦ç±èµ„æ–™</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *AuthorHandler)</span></span> UploadDynamicContent(w http.ResponseWriter, r *http.Request) &#123;<br>    <span class="hljs-keyword">var</span> req models.UploadContentRequest<br>    <span class="hljs-keyword">if</span> err := json.NewDecoder(r.Body).Decode(&amp;req); err != <span class="hljs-literal">nil</span> &#123;<br>        respondWithError(w, http.StatusBadRequest, <span class="hljs-string">&quot;æ— æ•ˆçš„è¯·æ±‚å‚æ•°&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// éªŒè¯ä½œè€…æƒé™</span><br>    <span class="hljs-keyword">if</span> !h.service.VerifyAuthorOwnership(req.AuthorAddress, req.BookID) &#123;<br>        respondWithError(w, http.StatusForbidden, <span class="hljs-string">&quot;æ— æ“ä½œæƒé™&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    contentID, err := h.service.UploadContent(req.AuthorAddress, req.BookID, req.Content)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        respondWithError(w, http.StatusInternalServerError, <span class="hljs-string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    respondWithSuccess(w, models.UploadContentResponse&#123;<br>        ContentID: contentID,<br>        Status:    <span class="hljs-string">&quot;å†…å®¹ä¸Šä¼ æˆåŠŸ&quot;</span>,<br>    &#125;)<br>&#125;<br><br><span class="hljs-comment">// ChatWithReaders - åŠŸèƒ½3ï¼šåœ¨Matrixå’Œç²‰ä¸èŠå¤©</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *AuthorHandler)</span></span> ChatWithReaders(w http.ResponseWriter, r *http.Request) &#123;<br>    authorAddress := r.URL.Query().Get(<span class="hljs-string">&quot;author&quot;</span>)<br>    <br>    <span class="hljs-comment">// è·å–ä½œè€…çš„MatrixèŠå¤©å®¤</span><br>    chatRooms, err := h.matrixService.GetAuthorChatRooms(authorAddress)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        respondWithError(w, http.StatusInternalServerError, <span class="hljs-string">&quot;è·å–èŠå¤©å®¤å¤±è´¥&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    respondWithSuccess(w, models.ChatRoomsResponse&#123;<br>        Rooms: chatRooms,<br>    &#125;)<br>&#125;<br><br><span class="hljs-comment">// GetFanAnalytics - åŠŸèƒ½4ï¼šæŸ¥çœ‹ç²‰ä¸åˆ†å¸ƒå’Œç‰ˆç¨ä¿¡æ¯</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *AuthorHandler)</span></span> GetFanAnalytics(w http.ResponseWriter, r *http.Request) &#123;<br>    authorAddress := r.URL.Query().Get(<span class="hljs-string">&quot;author&quot;</span>)<br>    period := r.URL.Query().Get(<span class="hljs-string">&quot;period&quot;</span>) <span class="hljs-comment">// daily, weekly, monthly</span><br>    <br>    analytics, err := h.analyticsService.GetAuthorAnalytics(authorAddress, period)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        respondWithError(w, http.StatusInternalServerError, <span class="hljs-string">&quot;è·å–åˆ†ææ•°æ®å¤±è´¥&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    respondWithSuccess(w, analytics)<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h3 id="5-handlers-publisher-handler-go-å‡ºç‰ˆç¤¾æ¨¡å—å¤„ç†å™¨"><a href="#5-handlers-publisher-handler-go-å‡ºç‰ˆç¤¾æ¨¡å—å¤„ç†å™¨" class="headerlink" title="5. handlers&#x2F;publisher_handler.go (å‡ºç‰ˆç¤¾æ¨¡å—å¤„ç†å™¨)"></a><strong>5. handlers&#x2F;publisher_handler.go (å‡ºç‰ˆç¤¾æ¨¡å—å¤„ç†å™¨)</strong></h3><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> handlers<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;whale-vault-backend/services&quot;</span><br>    <span class="hljs-string">&quot;whale-vault-backend/models&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> PublisherHandler <span class="hljs-keyword">struct</span> &#123;<br>    service *services.PublisherService<br>    analyticsService *services.AnalyticsService<br>    matrixService *services.MatrixService<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewPublisherHandler</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">    publisherService *services.PublisherService,</span></span><br><span class="hljs-params"><span class="hljs-function">    analyticsService *services.AnalyticsService,</span></span><br><span class="hljs-params"><span class="hljs-function">    matrixService *services.MatrixService,</span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span> *PublisherHandler &#123;<br>    <span class="hljs-keyword">return</span> &amp;PublisherHandler&#123;<br>        service: publisherService,<br>        analyticsService: analyticsService,<br>        matrixService: matrixService,<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// GetRegionalSales - åŠŸèƒ½1ï¼šæŸ¥çœ‹åœ°åŒºé”€é‡æ’è¡Œ</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *PublisherHandler)</span></span> GetRegionalSales(w http.ResponseWriter, r *http.Request) &#123;<br>    publisherAddress := r.URL.Query().Get(<span class="hljs-string">&quot;publisher&quot;</span>)<br>    <br>    salesData, err := h.analyticsService.GetRegionalSales(publisherAddress)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        respondWithError(w, http.StatusInternalServerError, <span class="hljs-string">&quot;è·å–é”€é‡æ•°æ®å¤±è´¥&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    respondWithSuccess(w, salesData)<br>&#125;<br><br><span class="hljs-comment">// GetReaderHeatmap - åŠŸèƒ½2ï¼šæŸ¥çœ‹è¯»è€…åˆ†å¸ƒçƒ­åŠ›å›¾</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *PublisherHandler)</span></span> GetReaderHeatmap(w http.ResponseWriter, r *http.Request) &#123;<br>    publisherAddress := r.URL.Query().Get(<span class="hljs-string">&quot;publisher&quot;</span>)<br>    <br>    heatmapData, err := h.analyticsService.GetReaderHeatmap(publisherAddress)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        respondWithError(w, http.StatusInternalServerError, <span class="hljs-string">&quot;è·å–çƒ­åŠ›å›¾æ•°æ®å¤±è´¥&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    respondWithSuccess(w, heatmapData)<br>&#125;<br><br><span class="hljs-comment">// GetRealSales - åŠŸèƒ½3ï¼šæŸ¥çœ‹ä¹¦ç±çœŸå®é”€é‡</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *PublisherHandler)</span></span> GetRealSales(w http.ResponseWriter, r *http.Request) &#123;<br>    publisherAddress := r.URL.Query().Get(<span class="hljs-string">&quot;publisher&quot;</span>)<br>    bookID := r.URL.Query().Get(<span class="hljs-string">&quot;book_id&quot;</span>)<br>    <br>    sales, err := h.analyticsService.GetRealSales(publisherAddress, bookID)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        respondWithError(w, http.StatusInternalServerError, <span class="hljs-string">&quot;è·å–é”€é‡æ•°æ®å¤±è´¥&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    respondWithSuccess(w, sales)<br>&#125;<br><br><span class="hljs-comment">// BroadcastNewBook - åŠŸèƒ½4ï¼šMatrix Botä¸€é”®æ¨é€æ–°ä¹¦</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *PublisherHandler)</span></span> BroadcastNewBook(w http.ResponseWriter, r *http.Request) &#123;<br>    publisherAddress := r.URL.Query().Get(<span class="hljs-string">&quot;publisher&quot;</span>)<br>    bookID := r.URL.Query().Get(<span class="hljs-string">&quot;book_id&quot;</span>)<br>    <br>    <span class="hljs-comment">// éªŒè¯å‡ºç‰ˆç¤¾æƒé™</span><br>    <span class="hljs-keyword">if</span> !h.service.VerifyPublisherOwnership(publisherAddress, bookID) &#123;<br>        respondWithError(w, http.StatusForbidden, <span class="hljs-string">&quot;æ— æ“ä½œæƒé™&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// è·å–å­˜é‡è¯»è€…åˆ—è¡¨</span><br>    readers, err := h.service.GetPublisherReaders(publisherAddress)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        respondWithError(w, http.StatusInternalServerError, <span class="hljs-string">&quot;è·å–è¯»è€…åˆ—è¡¨å¤±è´¥&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// é€šè¿‡Matrix Botæ¨é€</span><br>    successCount, err := h.matrixService.BroadcastToReaders(readers, bookID)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        respondWithError(w, http.StatusInternalServerError, <span class="hljs-string">&quot;æ¨é€å¤±è´¥&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    respondWithSuccess(w, models.BroadcastResponse&#123;<br>        TotalReaders: <span class="hljs-built_in">len</span>(readers),<br>        SuccessCount: successCount,<br>        Status:       <span class="hljs-string">&quot;æ¨é€å®Œæˆ&quot;</span>,<br>    &#125;)<br>&#125;<br><br><span class="hljs-comment">// GetSalesLeaderboard - åŠŸèƒ½5ï¼šè·å–å›¾ä¹¦é”€é‡æ’åçœ‹æ¿</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *PublisherHandler)</span></span> GetSalesLeaderboard(w http.ResponseWriter, r *http.Request) &#123;<br>    publisherAddress := r.URL.Query().Get(<span class="hljs-string">&quot;publisher&quot;</span>)<br>    timeRange := r.URL.Query().Get(<span class="hljs-string">&quot;time_range&quot;</span>) <span class="hljs-comment">// today, week, month, year</span><br>    <br>    leaderboard, err := h.analyticsService.GetSalesLeaderboard(publisherAddress, timeRange)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        respondWithError(w, http.StatusInternalServerError, <span class="hljs-string">&quot;è·å–æ’è¡Œæ¦œå¤±è´¥&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <br>    respondWithSuccess(w, leaderboard)<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h3 id="6-services-nft-service-go-NFTæœåŠ¡-æ”¯æŒé«˜å¹¶å‘"><a href="#6-services-nft-service-go-NFTæœåŠ¡-æ”¯æŒé«˜å¹¶å‘" class="headerlink" title="6. services&#x2F;nft_service.go (NFTæœåŠ¡ - æ”¯æŒé«˜å¹¶å‘)"></a><strong>6. services&#x2F;nft_service.go (NFTæœåŠ¡ - æ”¯æŒé«˜å¹¶å‘)</strong></h3><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> services<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;sync&quot;</span><br>    <span class="hljs-string">&quot;context&quot;</span><br>    <span class="hljs-string">&quot;whale-vault-backend/blockchain&quot;</span><br>    <span class="hljs-string">&quot;whale-vault-backend/utils&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> NFTService <span class="hljs-keyword">struct</span> &#123;<br>    blockchainClient *blockchain.MonadClient<br>    relayerPool      []*Relayer<br>    relayerIndex     <span class="hljs-type">uint64</span><br>    mu               sync.RWMutex<br>    batchMutex       sync.Mutex<br>&#125;<br><br><span class="hljs-keyword">type</span> Relayer <span class="hljs-keyword">struct</span> &#123;<br>    PrivateKey <span class="hljs-type">string</span><br>    Address    <span class="hljs-type">string</span><br>    Nonce      <span class="hljs-type">uint64</span><br>    mu         sync.Mutex<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewNFTService</span><span class="hljs-params">(client *blockchain.MonadClient)</span></span> *NFTService &#123;<br>    <span class="hljs-keyword">return</span> &amp;NFTService&#123;<br>        blockchainClient: client,<br>        relayerPool:      initializeRelayerPool(),<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// MintNFTConcurrent - å¹¶å‘å®‰å…¨çš„NFTé“¸é€ ï¼ˆæ”¯æŒä¸‡çº§å¹¶å‘ï¼‰</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *NFTService)</span></span> MintNFTConcurrent(walletAddress, codeHash <span class="hljs-type">string</span>) (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) &#123;<br>    <span class="hljs-comment">// ä½¿ç”¨è½®è¯¢ç­–ç•¥é€‰æ‹©ä¸­ç»§å™¨</span><br>    relayer := s.selectRelayer()<br>    <br>    relayer.mu.Lock()<br>    <span class="hljs-keyword">defer</span> relayer.mu.Unlock()<br>    <br>    <span class="hljs-comment">// å‡†å¤‡äº¤æ˜“</span><br>    tx, err := s.blockchainClient.PrepareMintTransaction(<br>        relayer.Address,<br>        walletAddress,<br>        relayer.Nonce,<br>    )<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>, err<br>    &#125;<br>    <br>    <span class="hljs-comment">// ç­¾åäº¤æ˜“</span><br>    signedTx, err := s.blockchainClient.SignTransaction(tx, relayer.PrivateKey)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>, err<br>    &#125;<br>    <br>    <span class="hljs-comment">// å‘é€äº¤æ˜“ï¼ˆMonadæ”¯æŒé«˜å¹¶å‘ï¼‰</span><br>    txHash, err := s.blockchainClient.SendTransaction(context.Background(), signedTx)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>, err<br>    &#125;<br>    <br>    <span class="hljs-comment">// æ›´æ–°Nonce</span><br>    relayer.Nonce++<br>    <br>    <span class="hljs-comment">// è®°å½•äº¤æ˜“æ—¥å¿—</span><br>    utils.LogMintEvent(walletAddress, codeHash, txHash)<br>    <br>    <span class="hljs-keyword">return</span> txHash, <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-comment">// BatchMintNFT - æ‰¹é‡é“¸é€ ï¼ˆç”¨äºå‡ºç‰ˆç¤¾å‘æ”¾ï¼‰</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *NFTService)</span></span> BatchMintNFT(addresses []<span class="hljs-type">string</span>) ([]<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) &#123;<br>    <span class="hljs-keyword">var</span> wg sync.WaitGroup<br>    results := <span class="hljs-built_in">make</span>([]<span class="hljs-type">string</span>, <span class="hljs-built_in">len</span>(addresses))<br>    errors := <span class="hljs-built_in">make</span>([]<span class="hljs-type">error</span>, <span class="hljs-built_in">len</span>(addresses))<br>    <br>    <span class="hljs-comment">// ä½¿ç”¨å·¥ä½œæ± æ§åˆ¶å¹¶å‘</span><br>    semaphore := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;, <span class="hljs-number">100</span>) <span class="hljs-comment">// é™åˆ¶å¹¶å‘æ•°ä¸º100</span><br>    <br>    <span class="hljs-keyword">for</span> i, addr := <span class="hljs-keyword">range</span> addresses &#123;<br>        wg.Add(<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(index <span class="hljs-type">int</span>, address <span class="hljs-type">string</span>)</span></span> &#123;<br>            <span class="hljs-keyword">defer</span> wg.Done()<br>            <br>            semaphore &lt;- <span class="hljs-keyword">struct</span>&#123;&#125;&#123;&#125;<br>            <span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; &lt;-semaphore &#125;()<br>            <br>            txHash, err := s.MintNFTConcurrent(address, <span class="hljs-string">&quot;batch_mint&quot;</span>)<br>            results[index] = txHash<br>            errors[index] = err<br>        &#125;(i, addr)<br>    &#125;<br>    <br>    wg.Wait()<br>    <br>    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯</span><br>    <span class="hljs-keyword">for</span> _, err := <span class="hljs-keyword">range</span> errors &#123;<br>        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> results, <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *NFTService)</span></span> selectRelayer() *Relayer &#123;<br>    s.mu.Lock()<br>    <span class="hljs-keyword">defer</span> s.mu.Unlock()<br>    <br>    index := s.relayerIndex % <span class="hljs-type">uint64</span>(<span class="hljs-built_in">len</span>(s.relayerPool))<br>    s.relayerIndex++<br>    <span class="hljs-keyword">return</span> s.relayerPool[index]<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h3 id="7-routes-api-routes-go-è·¯ç”±å®šä¹‰"><a href="#7-routes-api-routes-go-è·¯ç”±å®šä¹‰" class="headerlink" title="7. routes&#x2F;api_routes.go (è·¯ç”±å®šä¹‰)"></a><strong>7. routes&#x2F;api_routes.go (è·¯ç”±å®šä¹‰)</strong></h3><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> routes<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;github.com/gorilla/mux&quot;</span><br>    <span class="hljs-string">&quot;whale-vault-backend/handlers&quot;</span><br>    <span class="hljs-string">&quot;whale-vault-backend/middleware&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SetupRouter</span><span class="hljs-params">(services *Services)</span></span> *mux.Router &#123;<br>    router := mux.NewRouter()<br>    <br>    <span class="hljs-comment">// åˆå§‹åŒ–å¤„ç†å™¨</span><br>    readerHandler := handlers.NewReaderHandler(<br>        services.Reader,<br>        services.NFT,<br>        services.Staking,<br>        services.Marketplace,<br>    )<br>    <br>    authorHandler := handlers.NewAuthorHandler(<br>        services.Author,<br>        services.NFT,<br>        services.Analytics,<br>        services.Matrix,<br>    )<br>    <br>    publisherHandler := handlers.NewPublisherHandler(<br>        services.Publisher,<br>        services.Analytics,<br>        services.Matrix,<br>    )<br>    <br>    <span class="hljs-comment">// è¯»è€…æ¨¡å—è·¯ç”±</span><br>    readerRouter := router.PathPrefix(<span class="hljs-string">&quot;/api/reader&quot;</span>).Subrouter()<br>    readerRouter.Use(middleware.ReaderAuth)<br>    &#123;<br>        readerRouter.HandleFunc(<span class="hljs-string">&quot;/claim-nft&quot;</span>, readerHandler.ClaimNFT).Methods(<span class="hljs-string">&quot;POST&quot;</span>)<br>        readerRouter.HandleFunc(<span class="hljs-string">&quot;/exclusive-content&quot;</span>, readerHandler.GetExclusiveContent).Methods(<span class="hljs-string">&quot;GET&quot;</span>)<br>        readerRouter.HandleFunc(<span class="hljs-string">&quot;/promote-books&quot;</span>, readerHandler.PromoteBooks).Methods(<span class="hljs-string">&quot;POST&quot;</span>)<br>        readerRouter.HandleFunc(<span class="hljs-string">&quot;/stake-dot&quot;</span>, readerHandler.StakeDOT).Methods(<span class="hljs-string">&quot;POST&quot;</span>)<br>        readerRouter.HandleFunc(<span class="hljs-string">&quot;/sell-book&quot;</span>, readerHandler.SellUsedBook).Methods(<span class="hljs-string">&quot;POST&quot;</span>)<br>    &#125;<br>    <br>    <span class="hljs-comment">// ä½œè€…æ¨¡å—è·¯ç”±</span><br>    authorRouter := router.PathPrefix(<span class="hljs-string">&quot;/api/author&quot;</span>).Subrouter()<br>    authorRouter.Use(middleware.AuthorAuth)<br>    &#123;<br>        authorRouter.HandleFunc(<span class="hljs-string">&quot;/upload-image&quot;</span>, authorHandler.UploadNFTImage).Methods(<span class="hljs-string">&quot;POST&quot;</span>)<br>        authorRouter.HandleFunc(<span class="hljs-string">&quot;/upload-content&quot;</span>, authorHandler.UploadDynamicContent).Methods(<span class="hljs-string">&quot;POST&quot;</span>)<br>        authorRouter.HandleFunc(<span class="hljs-string">&quot;/chat-rooms&quot;</span>, authorHandler.ChatWithReaders).Methods(<span class="hljs-string">&quot;GET&quot;</span>)<br>        authorRouter.HandleFunc(<span class="hljs-string">&quot;/analytics&quot;</span>, authorHandler.GetFanAnalytics).Methods(<span class="hljs-string">&quot;GET&quot;</span>)<br>    &#125;<br>    <br>    <span class="hljs-comment">// å‡ºç‰ˆç¤¾æ¨¡å—è·¯ç”±</span><br>    publisherRouter := router.PathPrefix(<span class="hljs-string">&quot;/api/publisher&quot;</span>).Subrouter()<br>    publisherRouter.Use(middleware.PublisherAuth)<br>    &#123;<br>        publisherRouter.HandleFunc(<span class="hljs-string">&quot;/regional-sales&quot;</span>, publisherHandler.GetRegionalSales).Methods(<span class="hljs-string">&quot;GET&quot;</span>)<br>        publisherRouter.HandleFunc(<span class="hljs-string">&quot;/reader-heatmap&quot;</span>, publisherHandler.GetReaderHeatmap).Methods(<span class="hljs-string">&quot;GET&quot;</span>)<br>        publisherRouter.HandleFunc(<span class="hljs-string">&quot;/real-sales&quot;</span>, publisherHandler.GetRealSales).Methods(<span class="hljs-string">&quot;GET&quot;</span>)<br>        publisherRouter.HandleFunc(<span class="hljs-string">&quot;/broadcast-book&quot;</span>, publisherHandler.BroadcastNewBook).Methods(<span class="hljs-string">&quot;POST&quot;</span>)<br>        publisherRouter.HandleFunc(<span class="hljs-string">&quot;/sales-leaderboard&quot;</span>, publisherHandler.GetSalesLeaderboard).Methods(<span class="hljs-string">&quot;GET&quot;</span>)<br>    &#125;<br>    <br>    <span class="hljs-comment">// å…¬å…±APIè·¯ç”±ï¼ˆå…¼å®¹è€ç‰ˆæœ¬ï¼‰</span><br>    router.HandleFunc(<span class="hljs-string">&quot;/secret/verify&quot;</span>, handlers.VerifyActivationCode).Methods(<span class="hljs-string">&quot;GET&quot;</span>)<br>    router.HandleFunc(<span class="hljs-string">&quot;/relay/mint&quot;</span>, handlers.MintNFTLegacy).Methods(<span class="hljs-string">&quot;POST&quot;</span>)<br>    <br>    <span class="hljs-keyword">return</span> router<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h2 id="ğŸ“-go-mod-æ–‡ä»¶"><a href="#ğŸ“-go-mod-æ–‡ä»¶" class="headerlink" title="ğŸ“ go.mod æ–‡ä»¶"></a>ğŸ“ <strong>go.mod æ–‡ä»¶</strong></h2><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">module whale-vault-backend<br><br><span class="hljs-keyword">go</span> <span class="hljs-number">1.21</span><br><br>require (<br>    github.com/ethereum/<span class="hljs-keyword">go</span>-ethereum v1<span class="hljs-number">.13</span><span class="hljs-number">.5</span><br>    github.com/gorilla/mux v1<span class="hljs-number">.8</span><span class="hljs-number">.0</span><br>    github.com/redis/<span class="hljs-keyword">go</span>-redis/v9 v9<span class="hljs-number">.3</span><span class="hljs-number">.0</span><br>    github.com/joho/godotenv v1<span class="hljs-number">.5</span><span class="hljs-number">.1</span><br>    github.com/sirupsen/logrus v1<span class="hljs-number">.9</span><span class="hljs-number">.3</span><br>    golang.org/x/time v0<span class="hljs-number">.3</span><span class="hljs-number">.0</span> <span class="hljs-comment">// é™æµä½¿ç”¨</span><br>)<br></code></pre></div></td></tr></table></figure>

<h2 id="ğŸš€-éƒ¨ç½²å’Œè¿è¡Œ"><a href="#ğŸš€-éƒ¨ç½²å’Œè¿è¡Œ" class="headerlink" title="ğŸš€ éƒ¨ç½²å’Œè¿è¡Œ"></a>ğŸš€ <strong>éƒ¨ç½²å’Œè¿è¡Œ</strong></h2><h3 id="å¯åŠ¨å‘½ä»¤"><a href="#å¯åŠ¨å‘½ä»¤" class="headerlink" title="å¯åŠ¨å‘½ä»¤"></a><strong>å¯åŠ¨å‘½ä»¤</strong></h3><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># 1. åˆå§‹åŒ–æ¨¡å—</span><br>go mod init whale-vault-backend<br>go mod tidy<br><br><span class="hljs-comment"># 2. ç¼–è¯‘é¡¹ç›®</span><br>go build -o whale-vault main.go<br><br><span class="hljs-comment"># 3. è¿è¡ŒæœåŠ¡</span><br>./whale-vault<br><br><span class="hljs-comment"># æˆ–ç›´æ¥è¿è¡Œ</span><br>go run main.go<br></code></pre></div></td></tr></table></figure>

<h3 id="ç¯å¢ƒå˜é‡é…ç½®-env"><a href="#ç¯å¢ƒå˜é‡é…ç½®-env" class="headerlink" title="ç¯å¢ƒå˜é‡é…ç½® (.env)"></a><strong>ç¯å¢ƒå˜é‡é…ç½® (.env)</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs env">PORT=8080<br>REDIS_ADDR=localhost:6379<br>RPC_URL=https://rpc.monad.xyz<br>CHAIN_ID=1234<br>PRIVATE_KEYS=key1,key2,key3<br>MATRIX_URL=https://matrix.org<br>MATRIX_ROOM_ID=!room:matrix.org<br>MATRIX_ACCESS_TOKEN=your_token<br>LOG_LEVEL=debug<br></code></pre></div></td></tr></table></figure>

<h2 id="ğŸ¯-é‡æ„ä¼˜åŠ¿"><a href="#ğŸ¯-é‡æ„ä¼˜åŠ¿" class="headerlink" title="ğŸ¯ é‡æ„ä¼˜åŠ¿"></a>ğŸ¯ <strong>é‡æ„ä¼˜åŠ¿</strong></h2><ol>
<li><strong>æ¨¡å—æ¸…æ™°</strong>ï¼šä¸‰å¤§åŠŸèƒ½æ¨¡å—åˆ†ç¦»ï¼Œæ˜“äºç»´æŠ¤</li>
<li><strong>æ‰©å±•æ€§å¼º</strong>ï¼šæ–°å¢åŠŸèƒ½åªéœ€åœ¨å¯¹åº”æ¨¡å—æ·»åŠ </li>
<li><strong>å¹¶å‘æ”¯æŒ</strong>ï¼šMonadé«˜å¹¶å‘ä¼˜åŒ–ï¼Œæ”¯æŒä¸‡çº§è¯·æ±‚</li>
<li><strong>ä»£ç å¤ç”¨</strong>ï¼šé€šç”¨åŠŸèƒ½æŠ½ç¦»ä¸ºå·¥å…·å‡½æ•°</li>
<li><strong>æ˜“äºæµ‹è¯•</strong>ï¼šæ¯ä¸ªæ¨¡å—å¯ç‹¬ç«‹æµ‹è¯•</li>
<li><strong>å›¢é˜Ÿåä½œ</strong>ï¼šä¸åŒå¼€å‘è€…å¯è´Ÿè´£ä¸åŒæ¨¡å—</li>
</ol>
<h2 id="ğŸ“ˆ-ä¸‹ä¸€æ­¥å¼€å‘å»ºè®®"><a href="#ğŸ“ˆ-ä¸‹ä¸€æ­¥å¼€å‘å»ºè®®" class="headerlink" title="ğŸ“ˆ ä¸‹ä¸€æ­¥å¼€å‘å»ºè®®"></a>ğŸ“ˆ <strong>ä¸‹ä¸€æ­¥å¼€å‘å»ºè®®</strong></h2><ol>
<li><p><strong>ä¼˜å…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½</strong>ï¼š</p>
<ul>
<li>NFTé“¸é€ ï¼ˆMonadé›†æˆï¼‰</li>
<li>Redisæ¿€æ´»ç ç®¡ç†</li>
<li>åŸºæœ¬èº«ä»½éªŒè¯</li>
</ul>
</li>
<li><p><strong>é€æ­¥æ·»åŠ é«˜çº§åŠŸèƒ½</strong>ï¼š</p>
<ul>
<li>DOTè´¨æŠ¼ç³»ç»Ÿ</li>
<li>äºŒæ‰‹ä¹¦äº¤æ˜“å¸‚åœº</li>
<li>Matrixé›†æˆ</li>
</ul>
</li>
<li><p><strong>ä¼˜åŒ–å’Œç›‘æ§</strong>ï¼š</p>
<ul>
<li>æ·»åŠ Prometheusç›‘æ§</li>
<li>å®ç°é“¾è·¯è¿½è¸ª</li>
<li>æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–</li>
</ul>
</li>
</ol>
<p>è¿™ä¸ªé‡æ„æ–¹æ¡ˆä¸ºä½ çš„é‡‘åº“åè®®æä¾›äº†è‰¯å¥½çš„æ¶æ„åŸºç¡€ï¼Œæœªæ¥å¯ä»¥è½»æ¾æ‰©å±•æ–°åŠŸèƒ½è€Œä¸ä¼šè®©ä»£ç å˜å¾—æ··ä¹±ã€‚</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Web3/">Web3</a>
                    
                  </div>
                
              </div>
              
                
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2026/01/18/27590.html">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Polkadot Solidityå¼€å‘-è¯¾ç¨‹ç¬”è®°12</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2026/01/18/55831.html">
                        <span class="hidden-mobile">Starknet è®­ç»ƒè¥-è¯¾ç¨‹ç¬”è®°4</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


            

                
                  <a id="scroll-top-button" href="#" role="button">
                    <i class="iconfont icon-arrowup" aria-hidden="true"></i>
                  </a>
                  

                    

                          
      </main>

      <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://whale3070.github.io/" target="_blank" rel="nofollow noopener"><span>Whale3070</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->




  



  <script  src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js" ></script>





  <script  src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




















<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>


<link href="/pagefind/pagefind-ui.css" rel="stylesheet">
  <script src="/pagefind/pagefind-ui.js"></script>
  <style>
    /* æœç´¢æ¡†é…è‰²é€‚é… */
    #search { margin-top: 2rem; }
    [data-user-color-scheme='dark'] .pagefind-ui {
      --pagefind-ui-primary: #eeeeee;
      --pagefind-ui-text: #eeeeee;
      --pagefind-ui-background: #151515;
      --pagefind-ui-border: #333;
    }
  </style>
    </body>

  </html>